angular.module("spicyTaste",["ngRoute","angular-md5","ngMaterial","ngAnimate","ngMessages"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD",LOCAL_STORAGE_KEY:"spicyTasteUser",LATEST_COUNT:10}),angular.module("spicyTaste").config(["$mdThemingProvider","$mdIconProvider",function(e,n){var t=e.extendPalette("deep-orange",{500:"f27242"}),i=e.extendPalette("blue",{500:"6984b4",600:"6984b4"});e.definePalette("primaryOrange",t),e.definePalette("primaryBlue",i),e.theme("default").primaryPalette("primaryOrange").accentPalette("light-green"),e.theme("blue").primaryPalette("primaryBlue"),n.icon("menu","assets/svg/ic_menu_24px.svg").icon("share","assets/svg/ic_share_24px.svg").icon("login","assets/svg/ic_account_circle_24px.svg").icon("recipes","assets/svg/ic_event_note_48px.svg").icon("restaurants","assets/svg/ic_restaurant_menu_48px.svg").icon("ingredients","assets/svg/ic_receipt_48px.svg").icon("arrow","assets/svg/ic_arrow_drop_up_48px.svg").icon("more","assets/svg/ic_more_24px.svg").icon("time1","assets/svg/ic_av_timer_24px.svg").icon("time2","assets/svg/ic_access_time_24px.svg").icon("difficulty","assets/svg/ic_track_changes_24px.svg")}]),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,i){e.user=null,n.fbAsyncInit=function(){FB.init({appId:i.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var i,o=e.getElementsByTagName(n)[0];e.getElementById(t)||(i=e.createElement(n),i.id=t,i.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(i,o))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/all.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/list",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"}).when("/me",{templateUrl:"ng/views/pages/user/me.html",controller:"ProfileController",controllerAs:"me"})}]),angular.module("spicyTaste").controller("DishListController",["DishService","SocialService","$location",function(e,n,t){var i=this;i.processing=!0,e.all().success(function(e){i.processing=!1,i.dishes=e}),i.deleteDish=function(n){i.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){i.processing=!1,i.dishes=e})})},i.addDish=function(){i.processing=!0,e.create({name:"new dish"}).success(function(e){t.path("/admin/dish/"+e.dish._id)})},i.fbShare=function(e){var i=t.absUrl()+"/"+e._id;n.fbShare(i)}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","DishService","UserService",function(e,n,t,i,o,s){function r(){e.focusOnComment=!1,a.newComment={content:"",replyTo:null},a.commentTitle="Comment"}var a=this;a.dish={},r(),o.get(i.dish_id).success(function(e){a.dish=e,a.dish.isCollected=t.user&&t.user.favouriteDishes.indexOf(a.dish._id)>=0?!0:!1}),a.addComment=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}o.addComment(a.dish._id,a.newComment).success(function(e){a.dish.comments.push(e)}),r()},a.reply=function(n){a.newComment.replyTo=n._id,a.commentTitle="@"+n.userName,e.focusOnComment=!0},a.collect=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}s.collect(a.dish._id).then(function(e){console.log("UserService.collect:",e),e.success&&(a.dish.isCollected=!0)})}}]).controller("DishCreateController",["$location","DishService",function(e,n){var t=this;t.dish={name:"new dish"},t.save=function(){t.processing=!0,n.create(t.dish).success(function(n){e.path("/admin/dish/"+n.dish._id)})}}]).controller("DishEditController",["$routeParams","DishService","$location",function(e,n,t){function i(){o.newPhoto="",o.newInstruction="",o.message="",o.processing=!1}var o=this;i(),n.get(e.dish_id).success(function(e){o.dish=e}),o.addInstruction=function(){o.dish.instructions.push(o.newInstruction),o.newInstruction=""},o.removeInstruction=function(e){o.dish.instructions.splice(e,1)},o.addPhoto=function(){console.log("newPhoto: ",o.newPhoto),o.dish.photos.push(o.newPhoto),console.log("dish:",o.dish),o.newPhoto=""},o.removePhoto=function(e){o.dish.photos.splice(e,1)},o.save=function(){o.processing=!0,n.update(e.dish_id,o.dish).success(function(e){i(),o.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",["DishService","CONSTANTS",function(e,n){function t(){o.recipeTiles=[],i()}function i(){e.limit(n.LATEST_COUNT).success(function(e){angular.forEach(e,function(e,n){var t={image:e.imageUrl,title:e.name,id:e._id,prepTime:e.prepTime,totalTime:e.totalTime,difficulty:e.difficulty,ingredients:e.ingredients,span:{row:1,col:1}};switch(n+1){case 1:t.span.row=t.span.col=2;break;case 2:case 3:break;case 4:t.span.col=2;case 5:case 6:break;case 7:t.span.row=t.span.col=2;case 8:case 9:break;case 10:t.span.col=2}o.recipeTiles.push(t)})})}var o=this;t()}]),angular.module("spicyTaste").controller("MainController",["$location","$mdDialog","$http","SessionService","UserService","CONSTANTS",function(e,n,t,i,o,s){function r(e){var o=t.defaults.headers.common["X-Auth"];i.setLocal(s.LOCAL_STORAGE_KEY,o),n.hide(e)}function a(){c.showMobileMenu=!1,c.email="",c.password="",c.userName="";var e=i.getLocal(s.LOCAL_STORAGE_KEY);e&&(t.defaults.headers.common["X-Auth"]=e,o.get().then(function(e){c.currentUser=e}))}var c=this;a(),c.toggleMobileMenu=function(){c.showMobileMenu=!c.showMobileMenu},c.logout=function(){c.currentUser.loginType==s.FACEBOOK&&FB.logout(function(e){}),c.currentUser=null,o.logout()},c.showLoginDialog=function(e){n.show({clickOutsideToClose:!0,templateUrl:"ng/views/dialogs/login.html",targetEvent:e,controller:"MainController",controllerAs:"main"}).then(function(e){c.currentUser=e})},c.fbLogin=function(){FB.login(function(e){"connected"===e.status?FB.api("/me",function(e){var n={userName:e.name,email:e.email,password:s.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+e.id+"/picture?type=large",linkedSocial:s.FACEBOOK};o.socialLogin(n).then(function(e){e.loginType=s.FACEBOOK,r(e)})}):"not_authorized"===e.status},{scope:"public_profile,email"})},c.login=function(){o.login(c.email,c.password).then(function(e){e.loginType=s.EMAIL,r(e)})},c.signUp=function(){var e={userName:c.userName,email:c.email,password:c.password,photoUrl:"http://www.gravatar.com/avatar/"+md5.createHash(c.email),linkedSocial:s.EMAIL};o.create(e).then(function(e){e.loginType=s.EMAIL,r(e)})}}]),angular.module("spicyTaste").controller("ProfileController",["UserService",function(e){var n=this;n.user={},e.get().then(function(e){n.user=e})}]),angular.module("spicyTaste").directive("contenteditable",function(){return{require:"ngModel",restrict:"A",link:function(e,n,t,i){i.$render=function(){n.html(i.$viewValue||"")},n.bind("blur",function(){e.$apply(function(){i.$setViewValue(n.html())})})}}}),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,n){e.$watch("focusValue",function(e,t){e&&!t&&n[0].focus()})}}}),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.limit=function(n){return e.get("/api/dishes?limit="+n)},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n.getDifficulties=function(){return["初学","容易","一般","较难","专业"]},n}]),angular.module("spicyTaste").factory("SessionService",["$window",function(e){var n={};return n.getLocal=function(n){if(e.localStorage){var t=e.localStorage.getItem(n);return angular.fromJson(t)}return!1},n.setLocal=function(n,t){return e.localStorage&&e.localStorage.setItem(n,angular.toJson(t))},n}]),angular.module("spicyTaste").factory("SocialService",function(){var e={};return e.fbShare=function(e){FB.ui({method:"share",href:e},function(e){})},e}),angular.module("spicyTaste").factory("UserService",["$http","$rootScope","$window","CONSTANTS",function(e,n,t,i){var o={};return o.socialLogin=function(e){return console.log("socialUser: ",e),o.searchBy("email="+e.email).then(function(n){if(n.success){var t=n.users[0];return t.linkedSocial.indexOf(e.linkedSocial)<0?(t.linkedSocial.push(e.linkedSocial),t.userName=e.userName,t.photoUrl=e.photoUrl,o.update(t).then(function(){return o.login(t.email,i.SOCIAL_PASS)})):o.login(t.email,i.SOCIAL_PASS)}return o.create(e)})},o.login=function(n,t){return e.post("/api/auth",{email:n,password:t}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,o.get()})},o.logout=function(){delete e.defaults.headers.common["X-Auth"],t.localStorage.removeItem(i.LOCAL_STORAGE_KEY)},o.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},o.searchBy=function(n){return e.get("/api/users?"+n).then(function(e){return e.data})},o.getById=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},o.create=function(n){return e.post("/api/users/",n).then(function(){return o.login(n.email,n.password)})},o.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},o.collect=function(t){return e.put("/api/users/"+n.user._id+"/dishes/"+t).then(function(e){return e.data})},o}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImRlc2lnbi5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvcHJvZmlsZUNvbnRyb2xsZXIuanMiLCJkaXJlY3RpdmVzL2NvbnRlbnRlZGl0YWJsZURpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZm9jdXNPbkRpcmVjdGl2ZS5qcyIsInNlcnZpY2VzL2Rpc2hTZXJ2aWNlLmpzIiwic2VydmljZXMvc2Vzc2lvblNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NpYWxTZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlclNlcnZpY2UuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiRkJfQVBQX0lEIiwiRkFDRUJPT0siLCJFTUFJTCIsIlNPQ0lBTF9QQVNTIiwiTE9DQUxfU1RPUkFHRV9LRVkiLCJMQVRFU1RfQ09VTlQiLCJjb25maWciLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkbWRJY29uUHJvdmlkZXIiLCJwcmltYXJ5T3JhbmdlIiwiZXh0ZW5kUGFsZXR0ZSIsIjUwMCIsInByaW1hcnlCbHVlIiwiNjAwIiwiZGVmaW5lUGFsZXR0ZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiaWNvbiIsInJ1biIsIiRyb290U2NvcGUiLCIkd2luZG93IiwiVXNlclNlcnZpY2UiLCJDT05TVEFOVFMiLCJ1c2VyIiwiZmJBc3luY0luaXQiLCJGQiIsImluaXQiLCJhcHBJZCIsImNvb2tpZSIsInhmYm1sIiwidmVyc2lvbiIsImQiLCJzIiwiaWQiLCJqcyIsImZqcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImRvY3VtZW50IiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJEaXNoU2VydmljZSIsIlNvY2lhbFNlcnZpY2UiLCIkbG9jYXRpb24iLCJ2bSIsInRoaXMiLCJwcm9jZXNzaW5nIiwiYWxsIiwic3VjY2VzcyIsImRhdGEiLCJkaXNoZXMiLCJkZWxldGVEaXNoIiwiYWRkRGlzaCIsImNyZWF0ZSIsIm5hbWUiLCJwYXRoIiwiZGlzaCIsIl9pZCIsImZiU2hhcmUiLCJkaXNoTGluayIsImFic1VybCIsIiRzY29wZSIsIiRyb3V0ZVBhcmFtcyIsImZvY3VzT25Db21tZW50IiwibmV3Q29tbWVudCIsImNvbnRlbnQiLCJyZXBseVRvIiwiY29tbWVudFRpdGxlIiwiZ2V0IiwiZGlzaF9pZCIsImlzQ29sbGVjdGVkIiwiZmF2b3VyaXRlRGlzaGVzIiwiaW5kZXhPZiIsImFkZENvbW1lbnQiLCJyZXR1cm5VcmwiLCJ1cmwiLCJzZWFyY2giLCJjb21tZW50IiwiY29tbWVudHMiLCJwdXNoIiwicmVwbHkiLCJ1c2VyTmFtZSIsImNvbGxlY3QiLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsInNhdmUiLCJuZXdQaG90byIsIm5ld0luc3RydWN0aW9uIiwibWVzc2FnZSIsImFkZEluc3RydWN0aW9uIiwiaW5zdHJ1Y3Rpb25zIiwicmVtb3ZlSW5zdHJ1Y3Rpb24iLCJpbmRleCIsInNwbGljZSIsImFkZFBob3RvIiwicGhvdG9zIiwicmVtb3ZlUGhvdG8iLCJ1cGRhdGUiLCJyZWNpcGVUaWxlcyIsImJ1aWxkR3JpZCIsImxpbWl0IiwiZm9yRWFjaCIsInRpbGUiLCJpbWFnZSIsImltYWdlVXJsIiwidGl0bGUiLCJwcmVwVGltZSIsInRvdGFsVGltZSIsImRpZmZpY3VsdHkiLCJpbmdyZWRpZW50cyIsInNwYW4iLCJyb3ciLCJjb2wiLCIkbWREaWFsb2ciLCIkaHR0cCIsIlNlc3Npb25TZXJ2aWNlIiwiYWZ0ZXJBdXRoIiwidG9rZW4iLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJzZXRMb2NhbCIsImhpZGUiLCJzaG93TW9iaWxlTWVudSIsImVtYWlsIiwicGFzc3dvcmQiLCJsb2dpbmVkVG9rZW4iLCJnZXRMb2NhbCIsImN1cnJlbnRVc2VyIiwidG9nZ2xlTW9iaWxlTWVudSIsImxvZ291dCIsImxvZ2luVHlwZSIsInJlc3BvbnNlIiwic2hvd0xvZ2luRGlhbG9nIiwiZXYiLCJzaG93IiwiY2xpY2tPdXRzaWRlVG9DbG9zZSIsInRhcmdldEV2ZW50IiwiZmJMb2dpbiIsImxvZ2luIiwic3RhdHVzIiwiYXBpIiwiZmJVc2VyIiwicGhvdG9VcmwiLCJsaW5rZWRTb2NpYWwiLCJzb2NpYWxMb2dpbiIsInNjb3BlIiwic2lnblVwIiwibmV3VXNlciIsIm1kNSIsImNyZWF0ZUhhc2giLCJkaXJlY3RpdmUiLCJyZXF1aXJlIiwicmVzdHJpY3QiLCJsaW5rIiwiZWxlbWVudCIsImF0dHJpYnV0cyIsIm5nTW9kZWwiLCIkcmVuZGVyIiwiaHRtbCIsIiR2aWV3VmFsdWUiLCJiaW5kIiwiJGFwcGx5IiwiJHNldFZpZXdWYWx1ZSIsImZvY3VzVmFsdWUiLCIkZWxlbWVudCIsIiR3YXRjaCIsImN1cnJlbnRWYWx1ZSIsInByZXZpb3VzVmFsdWUiLCJmb2N1cyIsImZhY3RvcnkiLCJkaXNoRmFjdG9yeSIsIm51bSIsInBvc3QiLCJwdXQiLCJnZXREaWZmaWN1bHRpZXMiLCJzZXNzaW9uRmFjdG9yeSIsImtleSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJmcm9tSnNvbiIsInNldEl0ZW0iLCJ0b0pzb24iLCJzb2NpYWxGYWN0b3J5IiwidWkiLCJtZXRob2QiLCJocmVmIiwidXNlckZhY3RvcnkiLCJzb2NpYWxVc2VyIiwic2VhcmNoQnkiLCJ1c2VycyIsInJlbW92ZUl0ZW0iLCJxdWVyeSIsImdldEJ5SWQiLCJ1c2VyX2lkIl0sIm1hcHBpbmdzIjoiQUFBQUEsUUFB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QUFBLGlCQUFBZSxLQUFBLFNBQUFrRCxHQUNBLE1BQUFBLEdBQUFwRixRQUtBMkksRUFBQUUsU0FBQSxTQUFBRyxHQUNBLE1BQUE5RSxHQUFBL0MsSUFBQSxjQUFBNkgsR0FBQTlHLEtBQUEsU0FBQWtELEdBQ0EsTUFBQUEsR0FBQXBGLFFBS0EySSxFQUFBTSxRQUFBLFNBQUFDLEdBQ0EsTUFBQWhGLEdBQUEvQyxJQUFBLGNBQUErSCxHQUFBaEgsS0FBQSxTQUFBa0QsR0FDQSxNQUFBQSxHQUFBcEYsUUFLQTJJLEVBQUF2SSxPQUFBLFNBQUF2QyxHQUNBLE1BQUFxRyxHQUFBMkQsS0FBQSxjQUFBaEssR0FBQXFFLEtBQUEsV0FDQSxNQUFBeUcsR0FBQWhELE1BQUE5SCxFQUFBK0csTUFBQS9HLEVBQUFnSCxhQUtBOEQsRUFBQTFGLE9BQUEsU0FBQWlHLEVBQUFyTCxHQUNBLE1BQUFxRyxHQUFBNEQsSUFBQSxjQUFBb0IsRUFBQXJMLEdBQUFxRSxLQUFBLFNBQUFrRCxHQUNBLE1BQUFBLEdBQUFwRixRQUtBMkksRUFBQTFHLFFBQUEsU0FBQWIsR0FDQSxNQUFBOEMsR0FBQTRELElBQUEsY0FBQXJLLEVBQUFJLEtBQUEyQyxJQUFBLFdBQUFZLEdBQUFjLEtBQUEsU0FBQWtELEdBQ0EsTUFBQUEsR0FBQXBGLFFBSUEySSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScsIFsnbmdSb3V0ZScsICdhbmd1bGFyLW1kNScsICduZ01hdGVyaWFsJywgJ25nQW5pbWF0ZScsICduZ01lc3NhZ2VzJ10pXG4gICAgLmNvbnN0YW50KCdDT05TVEFOVFMnLCB7XG4gICAgICAgIFwiRkJfQVBQX0lEXCI6IDE1NjM1NjczODcyNTM0NjgsXG4gICAgICAgIFwiRkFDRUJPT0tcIjogXCJGQlwiLFxuICAgICAgICBcIkVNQUlMXCI6IFwiRU1BSUxcIixcbiAgICAgICAgXCJTT0NJQUxfUEFTU1wiOiBcIlBBU1NXT1JEXCIsXG4gICAgICAgIFwiTE9DQUxfU1RPUkFHRV9LRVlcIjogXCJzcGljeVRhc3RlVXNlclwiLFxuICAgICAgICBcIkxBVEVTVF9DT1VOVFwiOiAxMFxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJG1kVGhlbWluZ1Byb3ZpZGVyLCAkbWRJY29uUHJvdmlkZXIpIHtcblxuICAgICAgICB2YXIgcHJpbWFyeU9yYW5nZSA9ICRtZFRoZW1pbmdQcm92aWRlci5leHRlbmRQYWxldHRlKCdkZWVwLW9yYW5nZScsIHtcbiAgICAgICAgICAgICc1MDAnOiAnZjI3MjQyJ1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgcHJpbWFyeUJsdWUgPSAkbWRUaGVtaW5nUHJvdmlkZXIuZXh0ZW5kUGFsZXR0ZSgnYmx1ZScsIHtcbiAgICAgICAgICAgICc1MDAnOiAnNjk4NGI0JyxcbiAgICAgICAgICAgICc2MDAnOiAnNjk4NGI0J1xuICAgICAgICB9KTtcblxuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIuZGVmaW5lUGFsZXR0ZSgncHJpbWFyeU9yYW5nZScsIHByaW1hcnlPcmFuZ2UpO1xuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIuZGVmaW5lUGFsZXR0ZSgncHJpbWFyeUJsdWUnLCBwcmltYXJ5Qmx1ZSk7XG5cbiAgICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgICAgICAgIC5wcmltYXJ5UGFsZXR0ZSgncHJpbWFyeU9yYW5nZScpXG4gICAgICAgICAgICAuYWNjZW50UGFsZXR0ZSgnbGlnaHQtZ3JlZW4nKTtcblxuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2JsdWUnKVxuICAgICAgICAgICAgLnByaW1hcnlQYWxldHRlKCdwcmltYXJ5Qmx1ZScpO1xuXG4gICAgICAgICRtZEljb25Qcm92aWRlci5pY29uKCdtZW51JywgJ2Fzc2V0cy9zdmcvaWNfbWVudV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignc2hhcmUnLCAnYXNzZXRzL3N2Zy9pY19zaGFyZV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignbG9naW4nLCAnYXNzZXRzL3N2Zy9pY19hY2NvdW50X2NpcmNsZV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbigncmVjaXBlcycsICdhc3NldHMvc3ZnL2ljX2V2ZW50X25vdGVfNDhweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ3Jlc3RhdXJhbnRzJywgJ2Fzc2V0cy9zdmcvaWNfcmVzdGF1cmFudF9tZW51XzQ4cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdpbmdyZWRpZW50cycsICdhc3NldHMvc3ZnL2ljX3JlY2VpcHRfNDhweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2Fycm93JywgJ2Fzc2V0cy9zdmcvaWNfYXJyb3dfZHJvcF91cF80OHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignbW9yZScsICdhc3NldHMvc3ZnL2ljX21vcmVfMjRweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ3RpbWUxJywgJ2Fzc2V0cy9zdmcvaWNfYXZfdGltZXJfMjRweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ3RpbWUyJywgJ2Fzc2V0cy9zdmcvaWNfYWNjZXNzX3RpbWVfMjRweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2RpZmZpY3VsdHknLCAnYXNzZXRzL3N2Zy9pY190cmFja19jaGFuZ2VzXzI0cHguc3ZnJyk7XG5cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUsICR3aW5kb3csIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0gbnVsbDtcblxuICAgICAgICAkd2luZG93LmZiQXN5bmNJbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBGQi5pbml0KHtcbiAgICAgICAgICAgICAgICBhcHBJZDogQ09OU1RBTlRTLkZCX0FQUF9JRCxcbiAgICAgICAgICAgICAgICBjb29raWU6IHRydWUsIC8vIGVuYWJsZSBjb29raWVzIHRvIGFsbG93IHRoZSBzZXJ2ZXIgdG8gYWNjZXNzIHRoZSBzZXNzaW9uXG4gICAgICAgICAgICAgICAgeGZibWw6IHRydWUsIC8vIHBhcnNlIHNvY2lhbCBwbHVnaW5zIG9uIHRoaXMgcGFnZVxuICAgICAgICAgICAgICAgIHZlcnNpb246ICd2Mi4yJyAvLyB1c2UgdmVyc2lvbiAyLjJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIExvYWQgdGhlIFNESyBhc3luY2hyb25vdXNseVxuICAgICAgICAoZnVuY3Rpb24oZCwgcywgaWQpIHtcbiAgICAgICAgICAgIHZhciBqcywgZmpzID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZShzKVswXTtcbiAgICAgICAgICAgIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkgcmV0dXJuO1xuICAgICAgICAgICAganMgPSBkLmNyZWF0ZUVsZW1lbnQocyk7XG4gICAgICAgICAgICBqcy5pZCA9IGlkO1xuICAgICAgICAgICAganMuc3JjID0gXCIvL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL3Nkay5qc1wiO1xuICAgICAgICAgICAgZmpzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGpzLCBmanMpO1xuICAgICAgICB9KGRvY3VtZW50LCAnc2NyaXB0JywgJ2ZhY2Vib29rLWpzc2RrJykpO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAvL2hvbWUgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy8nLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9ob21lLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnaG9tZSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3Nob3cgYWxsIGRpc2hlcyBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvYWxsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vc2hvdyBkaXNoIGRldGFpbCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvZGV0YWlsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGV0YWlsJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbGlzdCBhZG1pbiBkaXNoIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vZGlzaGVzL2xpc3QnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL2xpc3QuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hMaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaExpc3QnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9jcmVhdGUgYSBuZXcgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy9jcmVhdGUnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaENyZWF0ZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9lZGl0IGEgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2FkbWluL2Rpc2gvc2luZ2xlLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRWRpdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9sb2dpbiB1c2VyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvdXNlci9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdsb2dpbidcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3VzZXIgcHJvZmlsZVxuICAgICAgICAgICAgLndoZW4oJy9tZScsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvbWUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdtZSdcbiAgICAgICAgICAgIH0pXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBsaXN0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaExpc3RDb250cm9sbGVyJywgZnVuY3Rpb24oRGlzaFNlcnZpY2UsIFNvY2lhbFNlcnZpY2UsICRsb2NhdGlvbikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vc2V0IGEgcHJvY2Vzc2luZyB2YXJpYWJsZSB0byBzaG93IGxvYWRpbmdcbiAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgLy9ncmFiIGFsbCB0aGUgZGlzaGVzIGF0IHBhZ2UgbG9hZFxuICAgICAgICBEaXNoU2VydmljZS5hbGwoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIC8vd2hlbiBhbGwgZGlzaGVzIGZldGNoZWQsIHJlbW92ZSBwcm9jZXNzaW5nIHZhcmlhYmxlXG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vYmluZCB0aGUgZGlzaGVzXG4gICAgICAgICAgICB2bS5kaXNoZXMgPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL2Z1bmN0aW9uIHRvIGRlbGV0ZSBhIGRpc2hcbiAgICAgICAgdm0uZGVsZXRlRGlzaCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UuZGVsZXRlKGlkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBEaXNoU2VydmljZS5hbGwoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2bS5kaXNoZXMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkRGlzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogJ25ldyBkaXNoJ1xuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9hZG1pbi9kaXNoLycgKyBkYXRhLmRpc2guX2lkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uZmJTaGFyZSA9IGZ1bmN0aW9uKGRpc2gpIHtcbiAgICAgICAgICAgIHZhciBkaXNoTGluayA9ICRsb2NhdGlvbi5hYnNVcmwoKSArICcvJyArIGRpc2guX2lkO1xuICAgICAgICAgICAgU29jaWFsU2VydmljZS5mYlNoYXJlKGRpc2hMaW5rKTtcbiAgICAgICAgfVxuXG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGRldGFpbCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hEZXRhaWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgRGlzaFNlcnZpY2UsIFVzZXJTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmRpc2ggPSB7fTtcbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIC8vZ2V0IHRoZSBkaXNoIGJ5IGlkXG4gICAgICAgIERpc2hTZXJ2aWNlLmdldCgkcm91dGVQYXJhbXMuZGlzaF9pZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB2bS5kaXNoID0gZGF0YTtcbiAgICAgICAgICAgIGlmICgkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLmZhdm91cml0ZURpc2hlcy5pbmRleE9mKHZtLmRpc2guX2lkKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgdm0uZGlzaC5pc0NvbGxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLmRpc2guaXNDb2xsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICB2bS5hZGRDb21tZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUudXNlcikge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24udXJsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKS5zZWFyY2goe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5Vcmw6IHJldHVyblVybFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5hZGRDb21tZW50KHZtLmRpc2guX2lkLCB2bS5uZXdDb21tZW50KS5zdWNjZXNzKGZ1bmN0aW9uKGNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNoLmNvbW1lbnRzLnB1c2goY29tbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlcGx5ID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgdm0ubmV3Q29tbWVudC5yZXBseVRvID0gdXNlci5faWQ7XG4gICAgICAgICAgICB2bS5jb21tZW50VGl0bGUgPSAnQCcgKyB1c2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jb2xsZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUudXNlcikge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24udXJsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKS5zZWFyY2goe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5Vcmw6IHJldHVyblVybFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5jb2xsZWN0KHZtLmRpc2guX2lkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXJTZXJ2aWNlLmNvbGxlY3Q6XCIsIGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2bS5kaXNoLmlzQ29sbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICAkc2NvcGUuZm9jdXNPbkNvbW1lbnQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLm5ld0NvbW1lbnQgPSB7XG4gICAgICAgICAgICAgICAgY29udGVudDogJycsXG4gICAgICAgICAgICAgICAgcmVwbHlUbzogbnVsbCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2bS5jb21tZW50VGl0bGUgPSAnQ29tbWVudCc7XG4gICAgICAgIH1cbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggY3JlYXRpb24gcGFnZVxuICAgIC8vbm90IHVzZSBhbnltb3JlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hDcmVhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCBEaXNoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmRpc2ggPSB7XG4gICAgICAgICAgICBuYW1lOiAnbmV3IGRpc2gnXG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmNyZWF0ZSh2bS5kaXNoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2FkbWluL2Rpc2gvJyArIGRhdGEuZGlzaC5faWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cblxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICB2bS50eXBlID0gJ2NyZWF0ZSc7XG4gICAgICAgICAgICB2bS5kaXNoID0ge1xuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICAgICAgICAgICAgcGhvdG86IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdm0ubmV3SW5zdHJ1Y3Rpb24gPSAnJztcbiAgICAgICAgICAgIHZtLm5ld1Bob3RvID0gJyc7XG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5kaXNoLmluc3RydWN0aW9ucy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgdm0uZGlzaC5waG90b3MubGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBlZGl0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSwgJGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICAvL2dldCB0aGUgZGlzaCBieSBpZFxuICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLmFkZEluc3RydWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5kaXNoLmluc3RydWN0aW9ucy5wdXNoKHZtLm5ld0luc3RydWN0aW9uKTtcbiAgICAgICAgICAgIHZtLm5ld0luc3RydWN0aW9uID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5yZW1vdmVJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICB2bS5kaXNoLmluc3RydWN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uYWRkUGhvdG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibmV3UGhvdG86IFwiLCB2bS5uZXdQaG90byk7XG4gICAgICAgICAgICB2bS5kaXNoLnBob3Rvcy5wdXNoKHZtLm5ld1Bob3RvKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzaDpcIiwgdm0uZGlzaCk7XG4gICAgICAgICAgICB2bS5uZXdQaG90byA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVtb3ZlUGhvdG8gPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAgICAgdm0uZGlzaC5waG90b3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS51cGRhdGUoJHJvdXRlUGFyYW1zLmRpc2hfaWQsIHZtLmRpc2gpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICB2bS5uZXdQaG90byA9ICcnO1xuICAgICAgICAgICAgdm0ubmV3SW5zdHJ1Y3Rpb24gPSAnJztcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICB2bS5yZWNpcGVUaWxlcyA9IFtdO1xuICAgICAgICAgICAgYnVpbGRHcmlkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBidWlsZEdyaWQoKSB7XG4gICAgICAgICAgICBEaXNoU2VydmljZS5saW1pdChDT05TVEFOVFMuTEFURVNUX0NPVU5UKS5zdWNjZXNzKGZ1bmN0aW9uKGRpc2hlcykge1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkaXNoZXMsIGZ1bmN0aW9uKGRpc2gsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aWxlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IGRpc2guaW1hZ2VVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZGlzaC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRpc2guX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJlcFRpbWU6IGRpc2gucHJlcFRpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFRpbWU6IGRpc2gudG90YWxUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogZGlzaC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5ncmVkaWVudHM6IGRpc2guaW5ncmVkaWVudHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGFuOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogMVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXggKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5zcGFuLnJvdyA9IHRpbGUuc3Bhbi5jb2wgPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbGUuc3Bhbi5jb2wgPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbGUuc3Bhbi5yb3cgPSB0aWxlLnNwYW4uY29sID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5zcGFuLmNvbCA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2bS5yZWNpcGVUaWxlcy5wdXNoKHRpbGUpO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkbWREaWFsb2csICRodHRwLCBTZXNzaW9uU2VydmljZSwgVXNlclNlcnZpY2UsIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgdm0udG9nZ2xlTW9iaWxlTWVudSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0uc2hvd01vYmlsZU1lbnUgPSAhdm0uc2hvd01vYmlsZU1lbnU7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh2bS5jdXJyZW50VXNlci5sb2dpblR5cGUgPT0gQ09OU1RBTlRTLkZBQ0VCT09LKSB7XG4gICAgICAgICAgICAgICAgRkIubG9nb3V0KGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNob3dMb2dpbkRpYWxvZyA9IGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL2RpYWxvZ3MvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6IGV2LFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNYWluQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbWFpbidcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIHZtLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZiTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmxvZ2luKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nZ2VkIGludG8geW91ciBhcHAgYW5kIEZhY2Vib29rLlxuICAgICAgICAgICAgICAgICAgICBGQi5hcGkoJy9tZScsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmJVc2VyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiByZXNwb25zZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiByZXNwb25zZS5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogQ09OU1RBTlRTLlNPQ0lBTF9QQVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvVXJsOiAnaHR0cDovL2dyYXBoLmZhY2Vib29rLmNvbS8nICsgcmVzcG9uc2UuaWQgKyAnL3BpY3R1cmU/dHlwZT1sYXJnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua2VkU29jaWFsOiBDT05TVEFOVFMuRkFDRUJPT0tcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLnNvY2lhbExvZ2luKGZiVXNlcikudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRkFDRUJPT0s7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJBdXRoKHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ25vdF9hdXRob3JpemVkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIGxvZ2dlZCBpbnRvIEZhY2Vib29rLCBidXQgbm90IHlvdXIgYXBwLlxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwZXJzb24gaXMgbm90IGxvZ2dlZCBpbnRvIEZhY2Vib29rLCBzbyB3ZSdyZSBub3Qgc3VyZSBpZlxuICAgICAgICAgICAgICAgICAgICAvLyB0aGV5IGFyZSBsb2dnZWQgaW50byB0aGlzIGFwcCBvciBub3QuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNjb3BlOiAncHVibGljX3Byb2ZpbGUsZW1haWwnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBVc2VyU2VydmljZS5sb2dpbih2bS5lbWFpbCwgdm0ucGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkVNQUlMO1xuICAgICAgICAgICAgICAgIGFmdGVyQXV0aCh1c2VyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uc2lnblVwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbmV3VXNlciA9IHtcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogdm0udXNlck5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IHZtLmVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB2bS5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICBwaG90b1VybDogJ2h0dHA6Ly93d3cuZ3JhdmF0YXIuY29tL2F2YXRhci8nICsgbWQ1LmNyZWF0ZUhhc2godm0uZW1haWwpLFxuICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkVNQUlMXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5jcmVhdGUobmV3VXNlcikudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRU1BSUw7XG4gICAgICAgICAgICAgICAgYWZ0ZXJBdXRoKHVzZXIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFmdGVyQXV0aCh1c2VyKSB7XG4gICAgICAgICAgICB2YXIgdG9rZW4gPSAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ107XG4gICAgICAgICAgICBTZXNzaW9uU2VydmljZS5zZXRMb2NhbChDT05TVEFOVFMuTE9DQUxfU1RPUkFHRV9LRVksIHRva2VuKTtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKHVzZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHZtLnNob3dNb2JpbGVNZW51ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5lbWFpbCA9IFwiXCI7XG4gICAgICAgICAgICB2bS5wYXNzd29yZCA9IFwiXCI7XG4gICAgICAgICAgICB2bS51c2VyTmFtZSA9IFwiXCI7XG5cbiAgICAgICAgICAgIHZhciBsb2dpbmVkVG9rZW4gPSBTZXNzaW9uU2VydmljZS5nZXRMb2NhbChDT05TVEFOVFMuTE9DQUxfU1RPUkFHRV9LRVkpO1xuICAgICAgICAgICAgaWYgKGxvZ2luZWRUb2tlbikge1xuICAgICAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IGxvZ2luZWRUb2tlbjtcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5nZXQoKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignUHJvZmlsZUNvbnRyb2xsZXInLCBmdW5jdGlvbihVc2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS51c2VyID0ge307XG5cbiAgICAgICAgVXNlclNlcnZpY2UuZ2V0KCkudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICB2bS51c2VyID0gdXNlcjtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmRpcmVjdGl2ZSgnY29udGVudGVkaXRhYmxlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0cywgbmdNb2RlbCkge1xuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwobmdNb2RlbC4kdmlld1ZhbHVlIHx8ICcnKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdibHVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShlbGVtZW50Lmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ2ZvY3VzT24nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGZvY3VzVmFsdWU6IFwiPWZvY3VzT25cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdmb2N1c1ZhbHVlJywgZnVuY3Rpb24oY3VycmVudFZhbHVlLCBwcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgJiYgIXByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50WzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnRGlzaFNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCkge1xuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IG9iamVjdFxuICAgICAgICB2YXIgZGlzaEZhY3RvcnkgPSB7fTtcblxuICAgICAgICAvL2dldCBhbGwgZGlzaGVzXG4gICAgICAgIGRpc2hGYWN0b3J5LmFsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2dldCBsaW1pdGVkIGxhdGVzdCBkaXNoZXNcbiAgICAgICAgZGlzaEZhY3RvcnkubGltaXQgPSBmdW5jdGlvbihudW0pIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzP2xpbWl0PScgKyBudW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9jcmVhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcycsIGRpc2gpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vZ2V0IGEgc2luZ2xlIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZ2V0ID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy91cGRhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQsIGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkLCBkaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZGVsZXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5kZWxldGUgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2FkZCBhIGNvbW1lbnRcbiAgICAgICAgZGlzaEZhY3RvcnkuYWRkQ29tbWVudCA9IGZ1bmN0aW9uKGRpc2hfaWQsIGNvbW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCArICcvY29tbWVudHMnLCBjb21tZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZ2V0IGRpZmZpY3VsdHlcbiAgICAgICAgZGlzaEZhY3RvcnkuZ2V0RGlmZmljdWx0aWVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gWyfliJ3lraYnLCAn5a655piTJywgJ+S4gOiIrCcsICfovoPpmr4nLCAn5LiT5LiaJ107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRpc2hGYWN0b3J5O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5mYWN0b3J5KCdTZXNzaW9uU2VydmljZScsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcbiAgICAgICAgdmFyIHNlc3Npb25GYWN0b3J5ID0ge307XG5cbiAgICAgICAgc2Vzc2lvbkZhY3RvcnkuZ2V0TG9jYWwgPSBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICAgIGlmICgkd2luZG93LmxvY2FsU3RvcmFnZSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuZnJvbUpzb24oZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBzZXNzaW9uRmFjdG9yeS5zZXRMb2NhbCA9IGZ1bmN0aW9uKGtleSwgZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlICYmICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBhbmd1bGFyLnRvSnNvbihkYXRhKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2Vzc2lvbkZhY3Rvcnk7XG5cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnU29jaWFsU2VydmljZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc29jaWFsRmFjdG9yeSA9IHt9O1xuXG4gICAgICAgIHNvY2lhbEZhY3RvcnkuZmJTaGFyZSA9IGZ1bmN0aW9uKGxpbmspIHtcbiAgICAgICAgICAgIEZCLnVpKHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdzaGFyZScsXG4gICAgICAgICAgICAgICAgaHJlZjogbGluayxcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7fSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc29jaWFsRmFjdG9yeTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgJHJvb3RTY29wZSwgJHdpbmRvdywgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB1c2VyRmFjdG9yeSA9IHt9O1xuICAgICAgICAvL3NvY2lhbCBsb2dpblxuICAgICAgICB1c2VyRmFjdG9yeS5zb2NpYWxMb2dpbiA9IGZ1bmN0aW9uKHNvY2lhbFVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic29jaWFsVXNlcjogXCIsIHNvY2lhbFVzZXIpO1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnkuc2VhcmNoQnkoJ2VtYWlsPScgKyBzb2NpYWxVc2VyLmVtYWlsKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90IGZvdW5kLCB0aGVuIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuY3JlYXRlKHNvY2lhbFVzZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZm91bmQgdGhlIHVzZXIgd2l0aCBlbWFpbFxuICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSB0aGUgbGlua2VkIHNvY2lhbCBpZiBub3QgYWRkZWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBkYXRhLnVzZXJzWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5saW5rZWRTb2NpYWwuaW5kZXhPZihzb2NpYWxVc2VyLmxpbmtlZFNvY2lhbCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxpbmtlZFNvY2lhbC5wdXNoKHNvY2lhbFVzZXIubGlua2VkU29jaWFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIudXNlck5hbWUgPSBzb2NpYWxVc2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5waG90b1VybCA9IHNvY2lhbFVzZXIucGhvdG9Vcmw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS51cGRhdGUodXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgQ09OU1RBTlRTLlNPQ0lBTF9QQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dpbiA9IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9hdXRoJywge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5nZXQoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICAvL2xvZ291dCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXTtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oQ09OU1RBTlRTLkxPQ0FMX1NUT1JBR0VfS0VZKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZ2V0IGN1cnJlbnQgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5nZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvbWUnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vc2VhcmNoIHVzZXIgYnkgZmllbGRcbiAgICAgICAgdXNlckZhY3Rvcnkuc2VhcmNoQnkgPSBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycz8nICsgcXVlcnkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgdXNlciBieSBpZFxuICAgICAgICB1c2VyRmFjdG9yeS5nZXRCeUlkID0gZnVuY3Rpb24odXNlcl9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzLycsIHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIHVzZXIucGFzc3dvcmQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3VwZGF0ZSB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKHVzZXJfaWQsIHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvdXNlcnMvJyArIHVzZXJfaWQsIHVzZXIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9jb2xsZWN0IGRpc2ggYXMgZmF2b3VyaXRlXG4gICAgICAgIHVzZXJGYWN0b3J5LmNvbGxlY3QgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL3VzZXJzLycgKyAkcm9vdFNjb3BlLnVzZXIuX2lkICsgJy9kaXNoZXMvJyArIGRpc2hfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5O1xuICAgIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9