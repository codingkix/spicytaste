angular.module("spicyTaste",["ngRoute","angular-md5"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/list",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"})}]),angular.module("spicyTaste").controller("DishListController",["DishService",function(e){var n=this;n.processing=!0,e.all().success(function(e){n.processing=!1,n.dishes=e}),n.deleteDish=function(t){n.processing=!0,e["delete"](t).success(function(){e.all().success(function(e){n.processing=!1,n.dishes=e})})}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","DishService","UserService",function(e,n,t,o,i){function r(){e.focusOnComment=!1,s.newComment={content:"",replyTo:null},s.commentTitle="Comment"}var s=this;s.dish=null,r(),i.get(o.dish_id).success(function(e){s.dish=e}),s.addComment=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}i.addComment(s.dish._id,s.newComment).success(function(e){s.dish.comments.push(e)}),r()},s.reply=function(n){s.newComment.replyTo=n._id,s.commentTitle="@"+n.userName,e.focusOnComment=!0}}]).controller("DishCreateController",["DishService",function(e){function n(){t.type="create",t.dish={instructions:[]},t.newInstruction="",t.message="",t.processing=!1,t.dish.instructions.length=0}var t=this;n(),t.save=function(){t.processing=!0,e.create(t.dish).success(function(e){n(),t.message=e.message})},t.addInstruction=function(){t.dish.instructions.push(t.newInstruction),t.newInstruction=""},t.removeInstruction=function(e){t.dish.instructions.splice(e,1)}}]).controller("DishEditController",["$routeParams","DishService","$location",function(e,n){var t=this;t.type="edit",n.get(e.dish_id).success(function(e){t.dish=e}),t.save=function(){t.processing=!0,t.message="",n.update(e.dish_id,t.dish).success(function(e){t.processing=!1,t.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS","md5",function(e,n,t,o,i){var r=this;r.email="",r.password="",r.userName="",r.showSignUpForm=!1,r.fbLogin=function(){FB.login(function(t){"connected"===t.status?FB.api("/me",function(t){console.log("fb user: ",t);var i={userName:t.name,email:t.email,password:o.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+t.id+"/picture?type=large",linkedSocial:o.FACEBOOK};n.socialLogin(i).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n)})}):"not_authorized"===t.status},{scope:"public_profile,email"})},r.login=function(){n.login(r.email,r.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n)})},r.signUp=function(){var t={userName:r.userName,email:r.email,password:r.password,photoUrl:"http://www.gravatar.com/avatar/"+i.createHash(r.email),linkedSocial:o.EMAIL};n.create(t).then(function(n){e.$emit("login",n)})}}]),angular.module("spicyTaste").controller("MainController",["$scope","$rootScope","$location","UserService","CONSTANTS",function(e,n,t,o,i){var r=this;e.$on("login",function(e,o){n.user=r.currentUser=o;var i=t.search().returnUrl;i?t.path(i).search({returnUrl:null}):t.path("/")}),r.logout=function(){r.currentUser.loginType==i.FACEBOOK&&FB.logout(function(){}),r.currentUser=null,n.user=null,o.logout()}}]),angular.module("spicyTaste").directive("contenteditable",function(){return{require:"ngModel",restrict:"A",link:function(e,n,t,o){o.$render=function(){n.html(o.$viewValue||"")},n.bind("blur",function(){e.$apply(function(){o.$setViewValue(n.html())})})}}}),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,n){e.$watch("focusValue",function(e,t){e&&!t&&n[0].focus()})}}}),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n}]),angular.module("spicyTaste").factory("UserService",["$http","CONSTANTS",function(e,n){var t={};return t.socialLogin=function(e){return console.log("socialUser: ",e),t.searchBy("email="+e.email).then(function(o){if(o.success){var i=o.users[0];return i.linkedSocial.indexOf(e.linkedSocial)<0?(i.linkedSocial.push(e.linkedSocial),i.userName=e.userName,i.photoUrl=e.photoUrl,t.update(i).then(function(){return t.login(i.email,n.SOCIAL_PASS)})):t.login(i.email,n.SOCIAL_PASS)}return t.create(e)})},t.login=function(n,o){return e.post("/api/auth",{email:n,password:o}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,t.get()})},t.logout=function(){delete e.defaults.headers.common["X-Auth"]},t.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},t.searchBy=function(n){return e.get("/api/users?"+n).then(function(e){return e.data})},t.getById=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},t.create=function(n){return e.post("/api/users/",n).then(function(){return t.login(n.email,n.password)})},t.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwiZGlyZWN0aXZlcy9jb250ZW50ZWRpdGFibGVEaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL2ZvY3VzT25EaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNoU2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXJTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIkZCX0FQUF9JRCIsIkZBQ0VCT09LIiwiRU1BSUwiLCJTT0NJQUxfUEFTUyIsInJ1biIsIiRyb290U2NvcGUiLCIkd2luZG93IiwiVXNlclNlcnZpY2UiLCJDT05TVEFOVFMiLCJ1c2VyIiwiZmJBc3luY0luaXQiLCJGQiIsImluaXQiLCJhcHBJZCIsImNvb2tpZSIsInhmYm1sIiwidmVyc2lvbiIsImQiLCJzIiwiaWQiLCJqcyIsImZqcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImRvY3VtZW50IiwiY29uZmlnIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJEaXNoU2VydmljZSIsInZtIiwidGhpcyIsInByb2Nlc3NpbmciLCJhbGwiLCJzdWNjZXNzIiwiZGF0YSIsImRpc2hlcyIsImRlbGV0ZURpc2giLCIkc2NvcGUiLCIkbG9jYXRpb24iLCIkcm91dGVQYXJhbXMiLCJmb2N1c09uQ29tbWVudCIsIm5ld0NvbW1lbnQiLCJjb250ZW50IiwicmVwbHlUbyIsImNvbW1lbnRUaXRsZSIsImRpc2giLCJnZXQiLCJkaXNoX2lkIiwiYWRkQ29tbWVudCIsInJldHVyblVybCIsInVybCIsInBhdGgiLCJzZWFyY2giLCJfaWQiLCJjb21tZW50IiwiY29tbWVudHMiLCJwdXNoIiwicmVwbHkiLCJ1c2VyTmFtZSIsInR5cGUiLCJpbnN0cnVjdGlvbnMiLCJuZXdJbnN0cnVjdGlvbiIsIm1lc3NhZ2UiLCJsZW5ndGgiLCJzYXZlIiwiY3JlYXRlIiwiYWRkSW5zdHJ1Y3Rpb24iLCJyZW1vdmVJbnN0cnVjdGlvbiIsImluZGV4Iiwic3BsaWNlIiwidXBkYXRlIiwibWQ1IiwiZW1haWwiLCJwYXNzd29yZCIsInNob3dTaWduVXBGb3JtIiwiZmJMb2dpbiIsImxvZ2luIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJhcGkiLCJjb25zb2xlIiwibG9nIiwiZmJVc2VyIiwibmFtZSIsInBob3RvVXJsIiwibGlua2VkU29jaWFsIiwic29jaWFsTG9naW4iLCJ0aGVuIiwibG9naW5UeXBlIiwiJGVtaXQiLCJzY29wZSIsInNpZ25VcCIsIm5ld1VzZXIiLCJjcmVhdGVIYXNoIiwiJG9uIiwiXyIsImN1cnJlbnRVc2VyIiwibG9nb3V0IiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInJlc3RyaWN0IiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dHMiLCJuZ01vZGVsIiwiJHJlbmRlciIsImh0bWwiLCIkdmlld1ZhbHVlIiwiYmluZCIsIiRhcHBseSIsIiRzZXRWaWV3VmFsdWUiLCJmb2N1c1ZhbHVlIiwiJGVsZW1lbnQiLCIkd2F0Y2giLCJjdXJyZW50VmFsdWUiLCJwcmV2aW91c1ZhbHVlIiwiZm9jdXMiLCJmYWN0b3J5IiwiJGh0dHAiLCJkaXNoRmFjdG9yeSIsInBvc3QiLCJwdXQiLCJ1c2VyRmFjdG9yeSIsInNvY2lhbFVzZXIiLCJzZWFyY2hCeSIsInVzZXJzIiwiaW5kZXhPZiIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsInF1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QSxHQUFBM0MsUUFLQXdGLEVBQUFFLFNBQUEsU0FBQU0sR0FDQSxNQUFBWixHQUFBeEUsSUFBQSxjQUFBb0YsR0FBQTNDLEtBQUEsU0FBQVYsR0FDQSxNQUFBQSxHQUFBM0MsUUFLQXdGLEVBQUFTLFFBQUEsU0FBQUMsR0FDQSxNQUFBZCxHQUFBeEUsSUFBQSxjQUFBc0YsR0FBQTdDLEtBQUEsU0FBQVYsR0FDQSxNQUFBQSxHQUFBM0MsUUFLQXdGLEVBQUF6RCxPQUFBLFNBQUFqRSxHQUNBLE1BQUFzSCxHQUFBRSxLQUFBLGNBQUF4SCxHQUFBdUYsS0FBQSxXQUNBLE1BQUFtQyxHQUFBOUMsTUFBQTVFLEVBQUF3RSxNQUFBeEUsRUFBQXlFLGFBS0FpRCxFQUFBcEQsT0FBQSxTQUFBOEQsRUFBQXBJLEdBQ0EsTUFBQXNILEdBQUFHLElBQUEsY0FBQVcsRUFBQXBJLEdBQUF1RixLQUFBLFNBQUFWLEdBQ0EsTUFBQUEsR0FBQTNDLFFBSUF3RiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScsIFsnbmdSb3V0ZScsICdhbmd1bGFyLW1kNSddKVxuICAgIC5jb25zdGFudCgnQ09OU1RBTlRTJywge1xuICAgICAgICBcIkZCX0FQUF9JRFwiOiAxNTYzNTY3Mzg3MjUzNDY4LFxuICAgICAgICBcIkZBQ0VCT09LXCI6IFwiRkJcIixcbiAgICAgICAgXCJFTUFJTFwiOiBcIkVNQUlMXCIsXG4gICAgICAgIFwiU09DSUFMX1BBU1NcIjogXCJQQVNTV09SRFwiXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCBVc2VyU2VydmljZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IG51bGw7XG5cbiAgICAgICAgJHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRkIuaW5pdCh7XG4gICAgICAgICAgICAgICAgYXBwSWQ6IENPTlNUQU5UUy5GQl9BUFBfSUQsXG4gICAgICAgICAgICAgICAgY29va2llOiB0cnVlLCAvLyBlbmFibGUgY29va2llcyB0byBhbGxvdyB0aGUgc2VydmVyIHRvIGFjY2VzcyB0aGUgc2Vzc2lvblxuICAgICAgICAgICAgICAgIHhmYm1sOiB0cnVlLCAvLyBwYXJzZSBzb2NpYWwgcGx1Z2lucyBvbiB0aGlzIHBhZ2VcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAndjIuMicgLy8gdXNlIHZlcnNpb24gMi4yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBMb2FkIHRoZSBTREsgYXN5bmNocm9ub3VzbHlcbiAgICAgICAgKGZ1bmN0aW9uKGQsIHMsIGlkKSB7XG4gICAgICAgICAgICB2YXIganMsIGZqcyA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUocylbMF07XG4gICAgICAgICAgICBpZiAoZC5nZXRFbGVtZW50QnlJZChpZCkpIHJldHVybjtcbiAgICAgICAgICAgIGpzID0gZC5jcmVhdGVFbGVtZW50KHMpO1xuICAgICAgICAgICAganMuaWQgPSBpZDtcbiAgICAgICAgICAgIGpzLnNyYyA9IFwiLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9zZGsuanNcIjtcbiAgICAgICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcbiAgICAgICAgfShkb2N1bWVudCwgJ3NjcmlwdCcsICdmYWNlYm9vay1qc3NkaycpKTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkcm91dGVQcm92aWRlcikge1xuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgLy9ob21lIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvaG9tZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2hvbWUnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9zaG93IGFsbCBkaXNoZXMgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2xpc3QuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hMaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaExpc3QnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9zaG93IGRpc2ggZGV0YWlsIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvZGlzaGVzLzpkaXNoX2lkJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvZGlzaC9kZXRhaWwuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hEZXRhaWxDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkZXRhaWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9saXN0IGFkbWluIGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvbGlzdCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2FkbWluL2Rpc2gvbGlzdC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaExpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTGlzdCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL2NyZWF0ZSBhIG5ldyBkaXNoIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vZGlzaGVzL2NyZWF0ZScsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2FkbWluL2Rpc2gvc2luZ2xlLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoQ3JlYXRlQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaE1hbmFnZSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL2VkaXQgYSBkaXNoIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vZGlzaGVzLzpkaXNoX2lkJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hFZGl0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaE1hbmFnZSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL2xvZ2luIHVzZXJcbiAgICAgICAgICAgIC53aGVuKCcvbG9naW4nLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy91c2VyL2xvZ2luLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2xvZ2luJ1xuICAgICAgICAgICAgfSlcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGxpc3QgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoTGlzdENvbnRyb2xsZXInLCBmdW5jdGlvbihEaXNoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vc2V0IGEgcHJvY2Vzc2luZyB2YXJpYWJsZSB0byBzaG93IGxvYWRpbmdcbiAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgLy9ncmFiIGFsbCB0aGUgZGlzaGVzIGF0IHBhZ2UgbG9hZFxuICAgICAgICBEaXNoU2VydmljZS5hbGwoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIC8vd2hlbiBhbGwgZGlzaGVzIGZldGNoZWQsIHJlbW92ZSBwcm9jZXNzaW5nIHZhcmlhYmxlXG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vYmluZCB0aGUgZGlzaGVzXG4gICAgICAgICAgICB2bS5kaXNoZXMgPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL2Z1bmN0aW9uIHRvIGRlbGV0ZSBhIGRpc2hcbiAgICAgICAgdm0uZGVsZXRlRGlzaCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UuZGVsZXRlKGlkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBEaXNoU2VydmljZS5hbGwoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2bS5kaXNoZXMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggZGV0YWlsIHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaERldGFpbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSwgVXNlclNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0uZGlzaCA9IG51bGw7XG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICAvL2dldCB0aGUgZGlzaCBieSBpZFxuICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLmFkZENvbW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICghJHJvb3RTY29wZS51c2VyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldHVyblVybCA9ICRsb2NhdGlvbi51cmwoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpLnNlYXJjaCh7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblVybDogcmV0dXJuVXJsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmFkZENvbW1lbnQodm0uZGlzaC5faWQsIHZtLm5ld0NvbW1lbnQpLnN1Y2Nlc3MoZnVuY3Rpb24oY29tbWVudCkge1xuICAgICAgICAgICAgICAgIHZtLmRpc2guY29tbWVudHMucHVzaChjb21tZW50KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbml0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVwbHkgPSBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICB2bS5uZXdDb21tZW50LnJlcGx5VG8gPSB1c2VyLl9pZDtcbiAgICAgICAgICAgIHZtLmNvbW1lbnRUaXRsZSA9ICdAJyArIHVzZXIudXNlck5hbWU7XG4gICAgICAgICAgICAkc2NvcGUuZm9jdXNPbkNvbW1lbnQgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICAkc2NvcGUuZm9jdXNPbkNvbW1lbnQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLm5ld0NvbW1lbnQgPSB7XG4gICAgICAgICAgICAgICAgY29udGVudDogJycsXG4gICAgICAgICAgICAgICAgcmVwbHlUbzogbnVsbCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2bS5jb21tZW50VGl0bGUgPSAnQ29tbWVudCc7XG4gICAgICAgIH1cbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggY3JlYXRpb24gcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoQ3JlYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUodm0uZGlzaCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5hZGRJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMucHVzaCh2bS5uZXdJbnN0cnVjdGlvbik7XG4gICAgICAgICAgICB2bS5uZXdJbnN0cnVjdGlvbiA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVtb3ZlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICB2bS50eXBlID0gJ2NyZWF0ZSc7XG4gICAgICAgICAgICB2bS5kaXNoID0ge1xuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uczogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2bS5uZXdJbnN0cnVjdGlvbiA9ICcnO1xuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMubGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBlZGl0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSwgJGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0udHlwZSA9IFwiZWRpdFwiO1xuXG4gICAgICAgIC8vZ2V0IHRoZSBkaXNoIGJ5IGlkXG4gICAgICAgIERpc2hTZXJ2aWNlLmdldCgkcm91dGVQYXJhbXMuZGlzaF9pZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB2bS5kaXNoID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLnVwZGF0ZSgkcm91dGVQYXJhbXMuZGlzaF9pZCwgdm0uZGlzaCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSwgJGxvY2F0aW9uLCBDT05TVEFOVFMsIG1kNSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5lbWFpbCA9IFwiXCI7XG4gICAgICAgIHZtLnBhc3N3b3JkID0gXCJcIjtcbiAgICAgICAgdm0udXNlck5hbWUgPSBcIlwiO1xuICAgICAgICB2bS5zaG93U2lnblVwRm9ybSA9IGZhbHNlO1xuXG4gICAgICAgIHZtLmZiTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmxvZ2luKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nZ2VkIGludG8geW91ciBhcHAgYW5kIEZhY2Vib29rLlxuICAgICAgICAgICAgICAgICAgICBGQi5hcGkoJy9tZScsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmIgdXNlcjogJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZiVXNlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogcmVzcG9uc2UubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogcmVzcG9uc2UuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IENPTlNUQU5UUy5TT0NJQUxfUEFTUyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG90b1VybDogJ2h0dHA6Ly9ncmFwaC5mYWNlYm9vay5jb20vJyArIHJlc3BvbnNlLmlkICsgJy9waWN0dXJlP3R5cGU9bGFyZ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkZBQ0VCT09LXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5zb2NpYWxMb2dpbihmYlVzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkZBQ0VCT09LO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdub3RfYXV0aG9yaXplZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBsb2dnZWQgaW50byBGYWNlYm9vaywgYnV0IG5vdCB5b3VyIGFwcC5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIG5vdCBsb2dnZWQgaW50byBGYWNlYm9vaywgc28gd2UncmUgbm90IHN1cmUgaWZcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhleSBhcmUgbG9nZ2VkIGludG8gdGhpcyBhcHAgb3Igbm90LlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzY29wZTogJ3B1YmxpY19wcm9maWxlLGVtYWlsJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgVXNlclNlcnZpY2UubG9naW4odm0uZW1haWwsIHZtLnBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICB1c2VyLmxvZ2luVHlwZSA9IENPTlNUQU5UUy5FTUFJTDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNpZ25VcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgICAgICAgdXNlck5hbWU6IHZtLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5lbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdm0ucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcGhvdG9Vcmw6ICdodHRwOi8vd3d3LmdyYXZhdGFyLmNvbS9hdmF0YXIvJyArIG1kNS5jcmVhdGVIYXNoKHZtLmVtYWlsKSxcbiAgICAgICAgICAgICAgICBsaW5rZWRTb2NpYWw6IENPTlNUQU5UUy5FTUFJTFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuY3JlYXRlKG5ld1VzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKF8sIHVzZXIpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHZtLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24uc2VhcmNoKCkucmV0dXJuVXJsO1xuICAgICAgICAgICAgaWYgKHJldHVyblVybCkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKHJldHVyblVybCkuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVXJsOiBudWxsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgdm0ubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodm0uY3VycmVudFVzZXIubG9naW5UeXBlID09IENPTlNUQU5UUy5GQUNFQk9PSykge1xuICAgICAgICAgICAgICAgIEZCLmxvZ291dChmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5sb2dvdXQoKTtcbiAgICAgICAgfTtcblxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ2NvbnRlbnRlZGl0YWJsZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRyaWJ1dHMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiRyZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKG5nTW9kZWwuJHZpZXdWYWx1ZSB8fCAnJyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoZWxlbWVudC5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZGlyZWN0aXZlKCdmb2N1c09uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBmb2N1c1ZhbHVlOiBcIj1mb2N1c09uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZm9jdXNWYWx1ZScsIGZ1bmN0aW9uKGN1cnJlbnRWYWx1ZSwgcHJldmlvdXNWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlICYmICFwcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkZWxlbWVudFswXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ0Rpc2hTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHApIHtcblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyBvYmplY3RcbiAgICAgICAgdmFyIGRpc2hGYWN0b3J5ID0ge307XG5cbiAgICAgICAgLy9nZXQgYWxsIGRpc2hlc1xuICAgICAgICBkaXNoRmFjdG9yeS5hbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9jcmVhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcycsIGRpc2gpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vZ2V0IGEgc2luZ2xlIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZ2V0ID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy91cGRhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQsIGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkLCBkaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZGVsZXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5kZWxldGUgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2FkZCBhIGNvbW1lbnRcbiAgICAgICAgZGlzaEZhY3RvcnkuYWRkQ29tbWVudCA9IGZ1bmN0aW9uKGRpc2hfaWQsIGNvbW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCArICcvY29tbWVudHMnLCBjb21tZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaXNoRmFjdG9yeTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB1c2VyRmFjdG9yeSA9IHt9O1xuICAgICAgICAvL3NvY2lhbCBsb2dpblxuICAgICAgICB1c2VyRmFjdG9yeS5zb2NpYWxMb2dpbiA9IGZ1bmN0aW9uKHNvY2lhbFVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic29jaWFsVXNlcjogXCIsIHNvY2lhbFVzZXIpO1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnkuc2VhcmNoQnkoJ2VtYWlsPScgKyBzb2NpYWxVc2VyLmVtYWlsKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90IGZvdW5kLCB0aGVuIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuY3JlYXRlKHNvY2lhbFVzZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZm91bmQgdGhlIHVzZXIgd2l0aCBlbWFpbFxuICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSB0aGUgbGlua2VkIHNvY2lhbCBpZiBub3QgYWRkZWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBkYXRhLnVzZXJzWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5saW5rZWRTb2NpYWwuaW5kZXhPZihzb2NpYWxVc2VyLmxpbmtlZFNvY2lhbCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxpbmtlZFNvY2lhbC5wdXNoKHNvY2lhbFVzZXIubGlua2VkU29jaWFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIudXNlck5hbWUgPSBzb2NpYWxVc2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5waG90b1VybCA9IHNvY2lhbFVzZXIucGhvdG9Vcmw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS51cGRhdGUodXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgQ09OU1RBTlRTLlNPQ0lBTF9QQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dpbiA9IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9hdXRoJywge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9nb3V0IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgY3VycmVudCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9tZScpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9zZWFyY2ggdXNlciBieSBmaWVsZFxuICAgICAgICB1c2VyRmFjdG9yeS5zZWFyY2hCeSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzPycgKyBxdWVyeSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCB1c2VyIGJ5IGlkXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldEJ5SWQgPSBmdW5jdGlvbih1c2VyX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzLycgKyB1c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkuY3JlYXRlID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMvJywgdXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgdXNlci5wYXNzd29yZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkudXBkYXRlID0gZnVuY3Rpb24odXNlcl9pZCwgdXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCwgdXNlcikudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnk7XG4gICAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=