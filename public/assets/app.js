angular.module("spicyTaste",["ngRoute"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"})}]),angular.module("spicyTaste").controller("DishListController",["DishService",function(e){var n=this;n.processing=!0,e.all().success(function(e){n.processing=!1,n.dishes=e}),n.deleteDish=function(t){n.processing=!0,e["delete"](t).success(function(){e.all().success(function(e){n.processing=!1,n.dishes=e})})}}]).controller("DishDetailController",["$location","$rootScope","$routeParams","DishService",function(e,n,t,o){var i=this;i.dish=null,i.content="",o.get(t.dish_id).success(function(e){i.dish=e}),i.addComment=function(){return n.user?(o.addComment(i.dish._id,{content:i.content}).success(function(e){i.dish.comments.push(e)}),void(i.content="")):e.path("/login")}}]).controller("DishCreateController",["DishService",function(e){var n=this;n.type="create",n.save=function(){n.processing=!0,n.message="",e.create(n.dish).success(function(e){n.processing=!1,n.dish={},n.message=e.message})}}]).controller("DishEditController",["$routeParams","DishService",function(e,n){var t=this;t.type="edit",n.get(e.dish_id).success(function(e){t.dish=e}),t.save=function(){t.processing=!0,t.message="",n.update(e.dish_id,t.dish).success(function(e){t.processing=!1,t.dish={},t.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS",function(e,n,t,o){var i=this;i.email="",i.password="",i.showSignUpForm=!1,i.fbLogin=function(){FB.login(function(i){"connected"===i.status?FB.api("/me",function(i){n.socialLogin(i.email,o.FACEBOOK).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n),t.path("/")})}):"not_authorized"===i.status},{scope:"public_profile,email"})},i.login=function(){n.login(i.email,i.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n),t.path("/")})},i.signUp=function(){var s={email:i.email,password:i.password,social:o.EMAIL};n.create(s).then(function(n){e.$emit("login",n),t.path("/")})}}]),angular.module("spicyTaste").controller("MainController",["$scope","$rootScope","UserService","CONSTANTS",function(e,n,t,o){var i=this;e.$on("login",function(e,t){n.user=i.currentUser=t}),i.logout=function(){i.currentUser.loginType==o.FACEBOOK&&FB.logout(function(){}),i.currentUser=null,n.user=null,t.logout()}}]),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n}]),angular.module("spicyTaste").factory("UserService",["$http","CONSTANTS",function(e,n){var t={};return t.socialLogin=function(e,o){return t.getByEmail(e).then(function(i){if(console.log("getByEmail: ",i),i.success){var s=i.user;return s.linkedSocial.indexOf(o)<0?(s.linkedSocial.push(o),t.update(s).then(function(){return t.login(s.email,n.SOCIAL_PASS)})):t.login(s.email,n.SOCIAL_PASS)}var r={email:e,password:n.SOCIAL_PASS,social:o};return t.create(r)})},t.login=function(n,o){return e.post("/api/auth",{email:n,password:o}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,t.get()})},t.logout=function(){delete e.defaults.headers.common["X-Auth"]},t.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},t.getByEmail=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},t.create=function(n){return e.post("/api/users/",n).then(function(){return t.login(n.email,n.password)})},t.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwic2VydmljZXMvZGlzaFNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJGQl9BUFBfSUQiLCJGQUNFQk9PSyIsIkVNQUlMIiwiU09DSUFMX1BBU1MiLCJydW4iLCIkcm9vdFNjb3BlIiwiJHdpbmRvdyIsIlVzZXJTZXJ2aWNlIiwiQ09OU1RBTlRTIiwidXNlciIsImZiQXN5bmNJbml0IiwiRkIiLCJpbml0IiwiYXBwSWQiLCJjb29raWUiLCJ4ZmJtbCIsInZlcnNpb24iLCJkIiwicyIsImlkIiwianMiLCJmanMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEVsZW1lbnRCeUlkIiwiY3JlYXRlRWxlbWVudCIsInNyYyIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJkb2N1bWVudCIsImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHJvdXRlUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiRGlzaFNlcnZpY2UiLCJ2bSIsInRoaXMiLCJwcm9jZXNzaW5nIiwiYWxsIiwic3VjY2VzcyIsImRhdGEiLCJkaXNoZXMiLCJkZWxldGVEaXNoIiwiJGxvY2F0aW9uIiwiJHJvdXRlUGFyYW1zIiwiZGlzaCIsImNvbnRlbnQiLCJnZXQiLCJkaXNoX2lkIiwiYWRkQ29tbWVudCIsIl9pZCIsImNvbW1lbnQiLCJjb21tZW50cyIsInB1c2giLCJwYXRoIiwidHlwZSIsInNhdmUiLCJtZXNzYWdlIiwiY3JlYXRlIiwidXBkYXRlIiwiJHNjb3BlIiwiZW1haWwiLCJwYXNzd29yZCIsInNob3dTaWduVXBGb3JtIiwiZmJMb2dpbiIsImxvZ2luIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJhcGkiLCJzb2NpYWxMb2dpbiIsInRoZW4iLCJsb2dpblR5cGUiLCIkZW1pdCIsInNjb3BlIiwic2lnblVwIiwibmV3VXNlciIsInNvY2lhbCIsIiRvbiIsIl8iLCJjdXJyZW50VXNlciIsImxvZ291dCIsImZhY3RvcnkiLCIkaHR0cCIsImRpc2hGYWN0b3J5IiwicG9zdCIsInB1dCIsInVzZXJGYWN0b3J5Iiwib3JpZ2luIiwiZ2V0QnlFbWFpbCIsImNvbnNvbGUiLCJsb2ciLCJsaW5rZWRTb2NpYWwiLCJpbmRleE9mIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwidXNlcl9pZCJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQUFDLE9BQUEsY0FBQSxZQUNBQyxTQUFBLGFBQ0FDLFVBQUEsZ0JBQ0FDLFNBQUEsS0FDQUMsTUFBQSxRQUNBQyxZQUFBLGFDTEFOLFFBQUFDLE9BQUEsY0FDQU0sS0FBQSxhQUFBLFVBQUEsY0FBQSxZQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FILEVBQUFJLEtBQUEsS0FFQUgsRUFBQUksWUFBQSxXQUNBQyxHQUFBQyxNQUNBQyxNQUFBTCxFQUFBUixVQUNBYyxRQUFBLEVBQ0FDLE9BQUEsRUFDQUMsUUFBQSxVQUtBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsRUFBQUosRUFBQUsscUJBQUFKLEdBQUEsRUFDQUQsR0FBQU0sZUFBQUosS0FDQUMsRUFBQUgsRUFBQU8sY0FBQU4sR0FDQUUsRUFBQUQsR0FBQUEsRUFDQUMsRUFBQUssSUFBQSxzQ0FDQUosRUFBQUssV0FBQUMsYUFBQVAsRUFBQUMsS0FDQU8sU0FBQSxTQUFBLHFCQ3JCQS9CLFFBQUFDLE9BQUEsY0FDQStCLFFBQUEsb0JBQUEsaUJBQUEsU0FBQUMsRUFBQUMsR0FDQUQsRUFBQUUs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V0FJQVQsRUFBQXZDLElBQUEsV0FDQSxNQUFBbUMsR0FBQW5DLElBQUEsaUJBQUF1QixLQUFBLFNBQUFKLEdBQ0EsTUFBQUEsR0FBQTFCLFFBS0E4QyxFQUFBRSxXQUFBLFNBQUEzQixHQUNBLE1BQUFxQixHQUFBbkMsSUFBQSxjQUFBYyxHQUFBUyxLQUFBLFNBQUFKLEdBQ0EsTUFBQUEsR0FBQTFCLFFBS0E4QyxFQUFBNUIsT0FBQSxTQUFBcEQsR0FDQSxNQUFBNEUsR0FBQUUsS0FBQSxjQUFBOUUsR0FBQWdFLEtBQUEsV0FDQSxNQUFBZ0IsR0FBQXJCLE1BQUEzRCxFQUFBdUQsTUFBQXZELEVBQUF3RCxhQUtBd0IsRUFBQTNCLE9BQUEsU0FBQXFDLEVBQUExRixHQUNBLE1BQUE0RSxHQUFBRyxJQUFBLGNBQUFXLEVBQUExRixHQUFBZ0UsS0FBQSxTQUFBSixHQUNBLE1BQUFBLEdBQUExQixRQUlBOEMiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnLCBbJ25nUm91dGUnXSlcbiAgICAuY29uc3RhbnQoJ0NPTlNUQU5UUycsIHtcbiAgICAgICAgXCJGQl9BUFBfSURcIjogMTU2MzU2NzM4NzI1MzQ2OCxcbiAgICAgICAgXCJGQUNFQk9PS1wiOiBcIkZCXCIsXG4gICAgICAgIFwiRU1BSUxcIjogXCJFTUFJTFwiLFxuICAgICAgICBcIlNPQ0lBTF9QQVNTXCI6IFwiUEFTU1dPUkRcIlxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHdpbmRvdywgVXNlclNlcnZpY2UsIENPTlNUQU5UUykge1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuXG4gICAgICAgICR3aW5kb3cuZmJBc3luY0luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmluaXQoe1xuICAgICAgICAgICAgICAgIGFwcElkOiBDT05TVEFOVFMuRkJfQVBQX0lELFxuICAgICAgICAgICAgICAgIGNvb2tpZTogdHJ1ZSwgLy8gZW5hYmxlIGNvb2tpZXMgdG8gYWxsb3cgdGhlIHNlcnZlciB0byBhY2Nlc3MgdGhlIHNlc3Npb25cbiAgICAgICAgICAgICAgICB4ZmJtbDogdHJ1ZSwgLy8gcGFyc2Ugc29jaWFsIHBsdWdpbnMgb24gdGhpcyBwYWdlXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogJ3YyLjInIC8vIHVzZSB2ZXJzaW9uIDIuMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTG9hZCB0aGUgU0RLIGFzeW5jaHJvbm91c2x5XG4gICAgICAgIChmdW5jdGlvbihkLCBzLCBpZCkge1xuICAgICAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xuICAgICAgICAgICAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSByZXR1cm47XG4gICAgICAgICAgICBqcyA9IGQuY3JlYXRlRWxlbWVudChzKTtcbiAgICAgICAgICAgIGpzLmlkID0gaWQ7XG4gICAgICAgICAgICBqcy5zcmMgPSBcIi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvc2RrLmpzXCI7XG4gICAgICAgICAgICBmanMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoanMsIGZqcyk7XG4gICAgICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnKSk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgIC8vaG9tZSBwYWdlXG4gICAgICAgICAgICAud2hlbignLycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2hvbWUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdob21lJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vc2hvdyBhbGwgZGlzaGVzIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvZGlzaGVzJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvZGlzaC9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vc2hvdyBkaXNoIGRldGFpbCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvZGV0YWlsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGV0YWlsJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vY3JlYXRlIGEgbmV3IGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvY3JlYXRlJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hDcmVhdGVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vZWRpdCBhIGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaEVkaXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbG9naW4nXG4gICAgICAgICAgICB9KVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggbGlzdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hMaXN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgLy9zZXQgYSBwcm9jZXNzaW5nIHZhcmlhYmxlIHRvIHNob3cgbG9hZGluZ1xuICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAvL2dyYWIgYWxsIHRoZSBkaXNoZXMgYXQgcGFnZSBsb2FkXG4gICAgICAgIERpc2hTZXJ2aWNlLmFsbCgpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgLy93aGVuIGFsbCBkaXNoZXMgZmV0Y2hlZCwgcmVtb3ZlIHByb2Nlc3NpbmcgdmFyaWFibGVcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy9iaW5kIHRoZSBkaXNoZXNcbiAgICAgICAgICAgIHZtLmRpc2hlcyA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vZnVuY3Rpb24gdG8gZGVsZXRlIGEgZGlzaFxuICAgICAgICB2bS5kZWxldGVEaXNoID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5kZWxldGUoaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIERpc2hTZXJ2aWNlLmFsbCgpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZtLmRpc2hlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBkZXRhaWwgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoRGV0YWlsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5kaXNoID0gbnVsbDtcbiAgICAgICAgdm0uY29udGVudCA9IFwiXCI7XG5cbiAgICAgICAgLy9nZXQgdGhlIGRpc2ggYnkgaWRcbiAgICAgICAgRGlzaFNlcnZpY2UuZ2V0KCRyb3V0ZVBhcmFtcy5kaXNoX2lkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHZtLmRpc2ggPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5hZGRDb21tZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUudXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBEaXNoU2VydmljZS5hZGRDb21tZW50KHZtLmRpc2guX2lkLCB7XG4gICAgICAgICAgICAgICAgY29udGVudDogdm0uY29udGVudFxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihjb21tZW50KSB7XG4gICAgICAgICAgICAgICAgdm0uZGlzaC5jb21tZW50cy5wdXNoKGNvbW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZtLmNvbnRlbnQgPSBcIlwiO1xuICAgICAgICB9O1xuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBjcmVhdGlvbiBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hDcmVhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS50eXBlID0gXCJjcmVhdGVcIjtcblxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UuY3JlYXRlKHZtLmRpc2gpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2bS5kaXNoID0ge307XG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBlZGl0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnR5cGUgPSBcImVkaXRcIjtcblxuICAgICAgICAvL2dldCB0aGUgZGlzaCBieSBpZFxuICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS51cGRhdGUoJHJvdXRlUGFyYW1zLmRpc2hfaWQsIHZtLmRpc2gpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHZtLmRpc2ggPSB7fTtcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlLCAkbG9jYXRpb24sIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5lbWFpbCA9IFwiXCI7XG4gICAgICAgIHZtLnBhc3N3b3JkID0gXCJcIjtcbiAgICAgICAgdm0uc2hvd1NpZ25VcEZvcm0gPSBmYWxzZTtcblxuICAgICAgICB2bS5mYkxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBGQi5sb2dpbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdjb25uZWN0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIExvZ2dlZCBpbnRvIHlvdXIgYXBwIGFuZCBGYWNlYm9vay5cbiAgICAgICAgICAgICAgICAgICAgRkIuYXBpKCcvbWUnLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVXNlclNlcnZpY2Uuc29jaWFsTG9naW4ocmVzcG9uc2UuZW1haWwsIENPTlNUQU5UUy5GQUNFQk9PSykudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRkFDRUJPT0s7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnbm90X2F1dGhvcml6ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwZXJzb24gaXMgbG9nZ2VkIGludG8gRmFjZWJvb2ssIGJ1dCBub3QgeW91ciBhcHAuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBub3QgbG9nZ2VkIGludG8gRmFjZWJvb2ssIHNvIHdlJ3JlIG5vdCBzdXJlIGlmXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZXkgYXJlIGxvZ2dlZCBpbnRvIHRoaXMgYXBwIG9yIG5vdC5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2NvcGU6ICdwdWJsaWNfcHJvZmlsZSxlbWFpbCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ2luKHZtLmVtYWlsLCB2bS5wYXNzd29yZCkudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRU1BSUw7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNpZ25VcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgICAgICAgZW1haWw6IHZtLmVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB2bS5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICBzb2NpYWw6IENPTlNUQU5UUy5FTUFJTFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuY3JlYXRlKG5ld1VzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTWFpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKF8sIHVzZXIpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHZtLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgfSlcblxuICAgICAgICB2bS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh2bS5jdXJyZW50VXNlci5sb2dpblR5cGUgPT0gQ09OU1RBTlRTLkZBQ0VCT09LKSB7XG4gICAgICAgICAgICAgICAgRkIubG9nb3V0KGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IG51bGw7XG5cbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICB9O1xuXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ0Rpc2hTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHApIHtcblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyBvYmplY3RcbiAgICAgICAgdmFyIGRpc2hGYWN0b3J5ID0ge307XG5cbiAgICAgICAgLy9nZXQgYWxsIGRpc2hlc1xuICAgICAgICBkaXNoRmFjdG9yeS5hbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9jcmVhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcycsIGRpc2gpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vZ2V0IGEgc2luZ2xlIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZ2V0ID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy91cGRhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQsIGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkLCBkaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZGVsZXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5kZWxldGUgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2FkZCBhIGNvbW1lbnRcbiAgICAgICAgZGlzaEZhY3RvcnkuYWRkQ29tbWVudCA9IGZ1bmN0aW9uKGRpc2hfaWQsIGNvbW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCArICcvY29tbWVudHMnLCBjb21tZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaXNoRmFjdG9yeTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB1c2VyRmFjdG9yeSA9IHt9O1xuICAgICAgICAvL3NvY2lhbCBsb2dpblxuICAgICAgICB1c2VyRmFjdG9yeS5zb2NpYWxMb2dpbiA9IGZ1bmN0aW9uKGVtYWlsLCBvcmlnaW4pIHtcblxuICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldEJ5RW1haWwoZW1haWwpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0QnlFbWFpbDogXCIsIGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9ub3QgZm91bmQsIHRoZW4gY3JlYXRlXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdVc2VyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IENPTlNUQU5UUy5TT0NJQUxfUEFTUyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvY2lhbDogb3JpZ2luXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5jcmVhdGUobmV3VXNlcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9mb3VuZCBvbmUgd2l0aCBlbWFpbFxuICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSB0aGUgbGlua2VkIHNvY2lhbCBpZiBub3QgYWRkZWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBkYXRhLnVzZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VyLmxpbmtlZFNvY2lhbC5pbmRleE9mKG9yaWdpbikgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxpbmtlZFNvY2lhbC5wdXNoKG9yaWdpbik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkudXBkYXRlKHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5sb2dpbih1c2VyLmVtYWlsLCBDT05TVEFOVFMuU09DSUFMX1BBU1MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2xvZ2luIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9naW4gPSBmdW5jdGlvbihlbWFpbCwgcGFzc3dvcmQpIHtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvYXV0aCcsIHtcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5nZXQoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICAvL2xvZ291dCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZ2V0IGN1cnJlbnQgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5nZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvbWUnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZ2V0IHVzZXIgYnkgZW1haWxcbiAgICAgICAgdXNlckZhY3RvcnkuZ2V0QnlFbWFpbCA9IGZ1bmN0aW9uKGVtYWlsKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzLycgKyBlbWFpbCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzLycsIHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIHVzZXIucGFzc3dvcmQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3VwZGF0ZSB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKHVzZXJfaWQsIHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvdXNlcnMvJyArIHVzZXJfaWQsIHVzZXIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5O1xuICAgIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9