angular.module("spicyTaste",["ngRoute"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/create",{templateUrl:"ng/views/pages/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"})}]),angular.module("spicyTaste").controller("DishListController",["DishService",function(e){var n=this;n.processing=!0,e.all().success(function(e){n.processing=!1,n.dishes=e}),n.deleteDish=function(t){n.processing=!0,e["delete"](t).success(function(){e.all().success(function(e){n.processing=!1,n.dishes=e})})}}]).controller("DishCreateController",["DishService",function(e){var n=this;n.type="create",n.save=function(){n.processing=!0,n.message="",e.create(n.dish).success(function(e){n.processing=!1,n.dish={},n.message=e.message})}}]).controller("DishEditController",["$routeParams","DishService",function(e,n){var t=this;t.type="edit",n.get(e.dish_id).success(function(e){t.dish=e}),t.save=function(){t.processing=!0,t.message="",n.update(e.dish_id,t.dish).success(function(e){t.processing=!1,t.dish={},t.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS",function(e,n,t,o){var i=this;i.fbLogin=function(){FB.login(function(i){"connected"===i.status?FB.api("/me",function(i){n.socialLogin(i.email,o.FACEBOOK).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n),t.path("/")})}):"not_authorized"===i.status},{scope:"public_profile,email"})}}]),angular.module("spicyTaste").controller("MainController",["$scope","UserService","CONSTANTS",function(e,n,t){var o=this;e.$on("login",function(e,n){o.currentUser=n}),o.logout=function(){o.currentUser.loginType==t.FACEBOOK&&FB.logout(function(){}),o.currentUser=null,n.logout()}}]),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n}]),angular.module("spicyTaste").factory("UserService",["$http","CONSTANTS",function(e,n){var t={};return t.socialLogin=function(e,o){return t.getByEmail(e).then(function(i){if(console.log("getByEmail: ",i),i.success){var s=i.user;return s.linkedSocial.indexOf(o)<0?(s.linkedSocial.push(o),t.update(s).then(function(){return t.login(s.email,n.SOCIAL_PASS)})):t.login(s.email,n.SOCIAL_PASS)}var r={email:e,password:n.SOCIAL_PASS,social:o};return t.create(r)})},t.login=function(n,o){return e.post("/api/auth",{email:n,password:o}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,t.get()})},t.logout=function(){delete e.defaults.headers.common["X-Auth"]},t.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},t.getByEmail=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},t.create=function(n){return e.post("/api/users/",n).then(function(){return t.login(n.email,n.password)})},t.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwic2VydmljZXMvZGlzaFNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJGQl9BUFBfSUQiLCJGQUNFQk9PSyIsIlNPQ0lBTF9QQVNTIiwicnVuIiwiJHJvb3RTY29wZSIsIiR3aW5kb3ciLCJVc2VyU2VydmljZSIsIkNPTlNUQU5UUyIsInVzZXIiLCJmYkFzeW5jSW5pdCIsIkZCIiwiaW5pdCIsImFwcElkIiwiY29va2llIiwieGZibWwiLCJ2ZXJzaW9uIiwiZCIsInMiLCJpZCIsImpzIiwiZmpzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJnZXRFbGVtZW50QnlJZCIsImNyZWF0ZUVsZW1lbnQiLCJzcmMiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwiZG9jdW1lbnQiLCJjb25maWciLCIkbG9jYXRpb25Qcm92aWRlciIsIiRyb3V0ZVByb3ZpZGVyIiwiaHRtbDVNb2RlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsIkRpc2hTZXJ2aWNlIiwidm0iLCJ0aGlzIiwicHJvY2Vzc2luZyIsImFsbCIsInN1Y2Nlc3MiLCJkYXRhIiwiZGlzaGVzIiwiZGVsZXRlRGlzaCIsInR5cGUiLCJzYXZlIiwibWVzc2FnZSIsImNyZWF0ZSIsImRpc2giLCIkcm91dGVQYXJhbXMiLCJnZXQiLCJkaXNoX2lkIiwidXBkYXRlIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiZmJMb2dpbiIsImxvZ2luIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJhcGkiLCJzb2NpYWxMb2dpbiIsImVtYWlsIiwidGhlbiIsImxvZ2luVHlwZSIsIiRlbWl0IiwicGF0aCIsInNjb3BlIiwiJG9uIiwiXyIsImN1cnJlbnRVc2VyIiwibG9nb3V0IiwiZmFjdG9yeSIsIiRodHRwIiwiZGlzaEZhY3RvcnkiLCJwb3N0IiwicHV0IiwidXNlckZhY3RvcnkiLCJvcmlnaW4iLCJnZXRCeUVtYWlsIiwiY29uc29sZSIsImxvZyIsImxpbmtlZFNvY2lhbCIsImluZGV4T2YiLCJwdXNoIiwibmV3VXNlciIsInBhc3N3b3JkIiwic29jaWFsIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwidXNlcl9pZCJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQUFDLE9BQUEsY0FBQSxZQUNBQyxTQUFBLGFBQ0FDLFVBQUEsZ0JBQ0FDLFNBQUEsS0FDQUMsWUFBQSxhQ0pBTCxRQUFBQyxPQUFBLGNBQ0FLLEtBQUEsYUFBQSxVQUFBLGNBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxLQUFBLEtBRUFILEVBQUFJLFlBQUEsV0FDQUMsR0FBQUMsTUFDQUMsTUFBQUwsRUFBQVAsVUFDQWEsUUFBQSxFQUNBQyxPQUFBLEVBQ0FDLFFBQUEsVUFLQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEdBQUFDLEVBQUFKLEVBQUFLLHFCQUFBSixHQUFBLEVBQ0FELEdBQUFNLGVBQUFKLEtBQ0FDLEVBQUFILEVBQUFPLGNBQUFOLEdBQ0FFLEVBQUFELEdBQUFBLEVBQ0FDLEVBQUFLLElBQUEsc0NBQ0FKLEVBQUFLLFdBQUFDLGFBQUFQLEVBQUFDLEtBQ0FPLFNBQUEsU0FBQSxxQkNyQkE5QixRQUFBQyxPQUFBLGNBQ0E4QixRQUFBLG9CQUFBLGlCQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEVBQUFFLFdBQUEsR0FFQUQsRUFFQUUsS0FBQSxLQUNBQyxZQUFBLDJCQUNBQyxXQUFBLGlCQUNBQyxhQUFBLFNBR0FILEtBQUEsV0FDQUMsWUFBQSxnQ0FDQUMsV0FBQSxxQkFD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QSxTQUFBakIsR0FDQSxNQUFBVyxHQUFBdEIsSUFBQSxjQUFBVyxHQUFBQyxLQUFBLFNBQUFMLEdBQ0EsTUFBQUEsR0FBQWhCLFFBS0FtQyxFQUFBN0IsT0FBQSxTQUFBeEMsR0FDQSxNQUFBaUUsR0FBQUUsS0FBQSxjQUFBbkUsR0FBQXVELEtBQUEsV0FDQSxNQUFBYyxHQUFBcEIsTUFBQWpELEVBQUFzRCxNQUFBdEQsRUFBQThFLGFBS0FULEVBQUF4QixPQUFBLFNBQUFzQyxFQUFBbkYsR0FDQSxNQUFBaUUsR0FBQUcsSUFBQSxjQUFBZSxFQUFBbkYsR0FBQXVELEtBQUEsU0FBQUwsR0FDQSxNQUFBQSxHQUFBaEIsUUFJQW1DIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJywgWyduZ1JvdXRlJ10pXG4gICAgLmNvbnN0YW50KCdDT05TVEFOVFMnLCB7XG4gICAgICAgIFwiRkJfQVBQX0lEXCI6IDE1NjM1NjczODcyNTM0NjgsXG4gICAgICAgIFwiRkFDRUJPT0tcIjogXCJGQlwiLFxuICAgICAgICBcIlNPQ0lBTF9QQVNTXCI6IFwiUEFTU1dPUkRcIlxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHdpbmRvdywgVXNlclNlcnZpY2UsIENPTlNUQU5UUykge1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuXG4gICAgICAgICR3aW5kb3cuZmJBc3luY0luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmluaXQoe1xuICAgICAgICAgICAgICAgIGFwcElkOiBDT05TVEFOVFMuRkJfQVBQX0lELFxuICAgICAgICAgICAgICAgIGNvb2tpZTogdHJ1ZSwgLy8gZW5hYmxlIGNvb2tpZXMgdG8gYWxsb3cgdGhlIHNlcnZlciB0byBhY2Nlc3MgdGhlIHNlc3Npb25cbiAgICAgICAgICAgICAgICB4ZmJtbDogdHJ1ZSwgLy8gcGFyc2Ugc29jaWFsIHBsdWdpbnMgb24gdGhpcyBwYWdlXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogJ3YyLjInIC8vIHVzZSB2ZXJzaW9uIDIuMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTG9hZCB0aGUgU0RLIGFzeW5jaHJvbm91c2x5XG4gICAgICAgIChmdW5jdGlvbihkLCBzLCBpZCkge1xuICAgICAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xuICAgICAgICAgICAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSByZXR1cm47XG4gICAgICAgICAgICBqcyA9IGQuY3JlYXRlRWxlbWVudChzKTtcbiAgICAgICAgICAgIGpzLmlkID0gaWQ7XG4gICAgICAgICAgICBqcy5zcmMgPSBcIi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvc2RrLmpzXCI7XG4gICAgICAgICAgICBmanMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoanMsIGZqcyk7XG4gICAgICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnKSk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgIC8vaG9tZSBwYWdlXG4gICAgICAgICAgICAud2hlbignLycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2hvbWUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdob21lJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vc2hvdyBhbGwgZGlzaGVzIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvZGlzaGVzJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvZGlzaC9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vY3JlYXRlIGEgbmV3IGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMvY3JlYXRlJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvZGlzaC9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hDcmVhdGVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vZWRpdCBhIGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaEVkaXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbG9naW4nXG4gICAgICAgICAgICB9KVxuXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBsaXN0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaExpc3RDb250cm9sbGVyJywgZnVuY3Rpb24oRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvL3NldCBhIHByb2Nlc3NpbmcgdmFyaWFibGUgdG8gc2hvdyBsb2FkaW5nXG4gICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgIC8vZ3JhYiBhbGwgdGhlIGRpc2hlcyBhdCBwYWdlIGxvYWRcbiAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAvL3doZW4gYWxsIGRpc2hlcyBmZXRjaGVkLCByZW1vdmUgcHJvY2Vzc2luZyB2YXJpYWJsZVxuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvL2JpbmQgdGhlIGRpc2hlc1xuICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9mdW5jdGlvbiB0byBkZWxldGUgYSBkaXNoXG4gICAgICAgIHZtLmRlbGV0ZURpc2ggPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmRlbGV0ZShpZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBjcmVhdGlvbiBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hDcmVhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS50eXBlID0gXCJjcmVhdGVcIjtcblxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UuY3JlYXRlKHZtLmRpc2gpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2bS5kaXNoID0ge307XG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBlZGl0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnR5cGUgPSBcImVkaXRcIjtcblxuICAgICAgICAvL2dldCB0aGUgZGlzaCBieSBpZFxuICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS51cGRhdGUoJHJvdXRlUGFyYW1zLmRpc2hfaWQsIHZtLmRpc2gpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHZtLmRpc2ggPSB7fTtcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlLCAkbG9jYXRpb24sIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmZiTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmxvZ2luKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nZ2VkIGludG8geW91ciBhcHAgYW5kIEZhY2Vib29rLlxuICAgICAgICAgICAgICAgICAgICBGQi5hcGkoJy9tZScsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5zb2NpYWxMb2dpbihyZXNwb25zZS5lbWFpbCwgQ09OU1RBTlRTLkZBQ0VCT09LKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxvZ2luVHlwZSA9IENPTlNUQU5UUy5GQUNFQk9PSztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdub3RfYXV0aG9yaXplZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBsb2dnZWQgaW50byBGYWNlYm9vaywgYnV0IG5vdCB5b3VyIGFwcC5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIG5vdCBsb2dnZWQgaW50byBGYWNlYm9vaywgc28gd2UncmUgbm90IHN1cmUgaWZcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhleSBhcmUgbG9nZ2VkIGludG8gdGhpcyBhcHAgb3Igbm90LlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzY29wZTogJ3B1YmxpY19wcm9maWxlLGVtYWlsJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTWFpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKF8sIHVzZXIpIHtcbiAgICAgICAgICAgIHZtLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgfSlcblxuICAgICAgICB2bS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh2bS5jdXJyZW50VXNlci5sb2dpblR5cGUgPT0gQ09OU1RBTlRTLkZBQ0VCT09LKSB7XG4gICAgICAgICAgICAgICAgRkIubG9nb3V0KGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICB9O1xuXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ0Rpc2hTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHApIHtcblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyBvYmplY3RcbiAgICAgICAgdmFyIGRpc2hGYWN0b3J5ID0ge307XG5cbiAgICAgICAgLy9nZXQgYWxsIGRpc2hlc1xuICAgICAgICBkaXNoRmFjdG9yeS5hbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9jcmVhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcycsIGRpc2gpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vZ2V0IGEgc2luZ2xlIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZ2V0ID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy91cGRhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQsIGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkLCBkaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZGVsZXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5kZWxldGUgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGlzaEZhY3Rvcnk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdXNlckZhY3RvcnkgPSB7fTtcbiAgICAgICAgLy9zb2NpYWwgbG9naW5cbiAgICAgICAgdXNlckZhY3Rvcnkuc29jaWFsTG9naW4gPSBmdW5jdGlvbihlbWFpbCwgb3JpZ2luKSB7XG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5nZXRCeUVtYWlsKGVtYWlsKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldEJ5RW1haWw6IFwiLCBkYXRhKTtcblxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90IGZvdW5kLCB0aGVuIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3VXNlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBDT05TVEFOVFMuU09DSUFMX1BBU1MsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb2NpYWw6IG9yaWdpblxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuY3JlYXRlKG5ld1VzZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZm91bmQgb25lIHdpdGggZW1haWxcbiAgICAgICAgICAgICAgICAgICAgLy91cGRhdGUgdGhlIGxpbmtlZCBzb2NpYWwgaWYgbm90IGFkZGVkXG4gICAgICAgICAgICAgICAgICAgIHZhciB1c2VyID0gZGF0YS51c2VyO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5saW5rZWRTb2NpYWwuaW5kZXhPZihvcmlnaW4pIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5saW5rZWRTb2NpYWwucHVzaChvcmlnaW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LnVwZGF0ZSh1c2VyKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5sb2dpbih1c2VyLmVtYWlsLCBDT05TVEFOVFMuU09DSUFMX1BBU1MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgQ09OU1RBTlRTLlNPQ0lBTF9QQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9sb2dpbiB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmxvZ2luID0gZnVuY3Rpb24oZW1haWwsIHBhc3N3b3JkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2F1dGgnLCB7XG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuZ2V0KCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgLy9sb2dvdXQgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRlbGV0ZSAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ107XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCBjdXJyZW50IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkuZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzL21lJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCB1c2VyIGJ5IGVtYWlsXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldEJ5RW1haWwgPSBmdW5jdGlvbihlbWFpbCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy8nICsgZW1haWwpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9jcmVhdGUgYSBuZXcgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5jcmVhdGUgPSBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2Vycy8nLCB1c2VyKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5sb2dpbih1c2VyLmVtYWlsLCB1c2VyLnBhc3N3b3JkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy91cGRhdGUgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS51cGRhdGUgPSBmdW5jdGlvbih1c2VyX2lkLCB1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL3VzZXJzLycgKyB1c2VyX2lkLCB1c2VyKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB1c2VyRmFjdG9yeTtcbiAgICB9KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==