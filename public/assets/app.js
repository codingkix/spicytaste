angular.module("spicyTaste",["ngRoute","angular-md5","ngMaterial"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").config(["$mdThemingProvider","$mdIconProvider",function(e,n){var t=e.extendPalette("deep-orange",{500:"f27242"});e.definePalette("primaryOrange",t),e.theme("default").primaryPalette("primaryOrange").accentPalette("light-green"),n.icon("menu","assets/svg/ic_menu_24px.svg").icon("share","assets/svg/ic_share_24px.svg").icon("login","assets/svg/ic_account_circle_24px.svg")}]),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/all.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/list",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"}).when("/me",{templateUrl:"ng/views/pages/user/me.html",controller:"ProfileController",controllerAs:"me"})}]),angular.module("spicyTaste").controller("DishListController",["DishService","SocialService","$location",function(e,n,t){var o=this;o.processing=!0,e.all().success(function(e){o.processing=!1,o.dishes=e}),o.deleteDish=function(n){o.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){o.processing=!1,o.dishes=e})})},o.addDish=function(){o.processing=!0,e.create({name:"new dish"}).success(function(e){t.path("/admin/dish/"+e.dish._id)})},o.fbShare=function(e){var o=t.absUrl()+"/"+e._id;n.fbShare(o)}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","DishService","UserService",function(e,n,t,o,i,r){function s(){e.focusOnComment=!1,l.newComment={content:"",replyTo:null},l.commentTitle="Comment"}var l=this;l.dish={},s(),i.get(o.dish_id).success(function(e){l.dish=e,l.dish.isCollected=t.user&&t.user.favouriteDishes.indexOf(l.dish._id)>=0?!0:!1}),l.addComment=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}i.addComment(l.dish._id,l.newComment).success(function(e){l.dish.comments.push(e)}),s()},l.reply=function(n){l.newComment.replyTo=n._id,l.commentTitle="@"+n.userName,e.focusOnComment=!0},l.collect=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}r.collect(l.dish._id).then(function(e){console.log("UserService.collect:",e),e.success&&(l.dish.isCollected=!0)})}}]).controller("DishCreateController",["$location","DishService",function(e,n){var t=this;t.dish={name:"new dish"},t.save=function(){t.processing=!0,n.create(t.dish).success(function(n){e.path("/admin/dish/"+n.dish._id)})}}]).controller("DishEditController",["$routeParams","DishService","$location",function(e,n,t){function o(){i.newPhoto="",i.newInstruction="",i.message="",i.processing=!1}var i=this;o(),n.get(e.dish_id).success(function(e){i.dish=e}),i.addInstruction=function(){i.dish.instructions.push(i.newInstruction),i.newInstruction=""},i.removeInstruction=function(e){i.dish.instructions.splice(e,1)},i.addPhoto=function(){console.log("newPhoto: ",i.newPhoto),i.dish.photos.push(i.newPhoto),console.log("dish:",i.dish),i.newPhoto=""},i.removePhoto=function(e){i.dish.photos.splice(e,1)},i.save=function(){i.processing=!0,n.update(e.dish_id,i.dish).success(function(e){o(),i.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS","md5",function(e,n,t,o,i){var r=this;r.email="",r.password="",r.userName="",r.showSignUpForm=!1,r.fbLogin=function(){FB.login(function(t){"connected"===t.status?FB.api("/me",function(t){console.log("fb user: ",t);var i={userName:t.name,email:t.email,password:o.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+t.id+"/picture?type=large",linkedSocial:o.FACEBOOK};n.socialLogin(i).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n)})}):"not_authorized"===t.status},{scope:"public_profile,email"})},r.login=function(){n.login(r.email,r.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n)})},r.signUp=function(){var t={userName:r.userName,email:r.email,password:r.password,photoUrl:"http://www.gravatar.com/avatar/"+i.createHash(r.email),linkedSocial:o.EMAIL};n.create(t).then(function(n){e.$emit("login",n)})}}]),angular.module("spicyTaste").controller("MainController",["$scope","$rootScope","$location","UserService","CONSTANTS",function(e,n,t,o,i){var r=this;r.showMobileMenu=!1,r.toggleMobileMenu=function(){r.showMobileMenu=!r.showMobileMenu},e.$on("login",function(e,o){n.user=r.currentUser=o;var i=t.search().returnUrl;i?(console.log("return url: ",i),t.path(i).search({returnUrl:null})):t.path("/")}),r.logout=function(){r.currentUser.loginType==i.FACEBOOK&&FB.logout(function(e){}),r.currentUser=null,n.user=null,o.logout()}}]),angular.module("spicyTaste").controller("ProfileController",["UserService",function(e){var n=this;n.user={},e.get().then(function(e){n.user=e})}]),angular.module("spicyTaste").directive("contenteditable",function(){return{require:"ngModel",restrict:"A",link:function(e,n,t,o){o.$render=function(){n.html(o.$viewValue||"")},n.bind("blur",function(){e.$apply(function(){o.$setViewValue(n.html())})})}}}),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,n){e.$watch("focusValue",function(e,t){e&&!t&&n[0].focus()})}}}),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n}]),angular.module("spicyTaste").factory("SocialService",function(){var e={};return e.fbShare=function(e){FB.ui({method:"share",href:e},function(e){})},e}),angular.module("spicyTaste").factory("UserService",["$http","$rootScope","CONSTANTS",function(e,n,t){var o={};return o.socialLogin=function(e){return console.log("socialUser: ",e),o.searchBy("email="+e.email).then(function(n){if(n.success){var i=n.users[0];return i.linkedSocial.indexOf(e.linkedSocial)<0?(i.linkedSocial.push(e.linkedSocial),i.userName=e.userName,i.photoUrl=e.photoUrl,o.update(i).then(function(){return o.login(i.email,t.SOCIAL_PASS)})):o.login(i.email,t.SOCIAL_PASS)}return o.create(e)})},o.login=function(n,t){return e.post("/api/auth",{email:n,password:t}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,o.get()})},o.logout=function(){delete e.defaults.headers.common["X-Auth"]},o.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},o.searchBy=function(n){return e.get("/api/users?"+n).then(function(e){return e.data})},o.getById=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},o.create=function(n){return e.post("/api/users/",n).then(function(){return o.login(n.email,n.password)})},o.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},o.collect=function(t){return e.put("/api/users/"+n.user._id+"/dishes/"+t).then(function(e){return e.data})},o}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImRlc2lnbi5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvcHJvZmlsZUNvbnRyb2xsZXIuanMiLCJkaXJlY3RpdmVzL2NvbnRlbnRlZGl0YWJsZURpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZm9jdXNPbkRpcmVjdGl2ZS5qcyIsInNlcnZpY2VzL2Rpc2hTZXJ2aWNlLmpzIiwic2VydmljZXMvc29jaWFsU2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXJTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIkZCX0FQUF9JRCIsIkZBQ0VCT09LIiwiRU1BSUwiLCJTT0NJQUxfUEFTUyIsImNvbmZpZyIsIiRtZFRoZW1pbmdQcm92aWRlciIsIiRtZEljb25Qcm92aWRlciIsInByaW1hcnlPcmFuZ2UiLCJleHRlbmRQYWxldHRlIiwiNTAwIiwiZGVmaW5lUGFsZXR0ZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiaWNvbiIsInJ1biIsIiRyb290U2NvcGUiLCIkd2luZG93IiwiVXNlclNlcnZpY2UiLCJDT05TVEFOVFMiLCJ1c2VyIiwiZmJBc3luY0luaXQiLCJGQiIsImluaXQiLCJhcHBJZCIsImNvb2tpZSIsInhmYm1sIiwidmVyc2lvbiIsImQiLCJzIiwiaWQiLCJqcyIsImZqcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImRvY3VtZW50IiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJEaXNoU2VydmljZSIsIlNvY2lhbFNlcnZpY2UiLCIkbG9jYXRpb24iLCJ2bSIsInRoaXMiLCJwcm9jZXNzaW5nIiwiYWxsIiwic3VjY2VzcyIsImRhdGEiLCJkaXNoZXMiLCJkZWxldGVEaXNoIiwiYWRkRGlzaCIsImNyZWF0ZSIsIm5hbWUiLCJwYXRoIiwiZGlzaCIsIl9pZCIsImZiU2hhcmUiLCJkaXNoTGluayIsImFic1VybCIsIiRzY29wZSIsIiRyb3V0ZVBhcmFtcyIsImZvY3VzT25Db21tZW50IiwibmV3Q29tbWVudCIsImNvbnRlbnQiLCJyZXBseVRvIiwiY29tbWVudFRpdGxlIiwiZ2V0IiwiZGlzaF9pZCIsImlzQ29sbGVjdGVkIiwiZmF2b3VyaXRlRGlzaGVzIiwiaW5kZXhPZiIsImFkZENvbW1lbnQiLCJyZXR1cm5VcmwiLCJ1cmwiLCJzZWFyY2giLCJjb21tZW50IiwiY29tbWVudHMiLCJwdXNoIiwicmVwbHkiLCJ1c2VyTmFtZSIsImNvbGxlY3QiLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsInNhdmUiLCJuZXdQaG90byIsIm5ld0luc3RydWN0aW9uIiwibWVzc2FnZSIsImFkZEluc3RydWN0aW9uIiwiaW5zdHJ1Y3Rpb25zIiwicmVtb3ZlSW5zdHJ1Y3Rpb24iLCJpbmRleCIsInNwbGljZSIsImFkZFBob3RvIiwicGhvdG9zIiwicmVtb3ZlUGhvdG8iLCJ1cGRhdGUiLCJtZDUiLCJlbWFpbCIsInBhc3N3b3JkIiwic2hvd1NpZ25VcEZvcm0iLCJmYkxvZ2luIiwibG9naW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImFwaSIsImZiVXNlciIsInBob3RvVXJsIiwibGlua2VkU29jaWFsIiwic29jaWFsTG9naW4iLCJsb2dpblR5cGUiLCIkZW1pdCIsInNjb3BlIiwic2lnblVwIiwibmV3VXNlciIsImNyZWF0ZUhhc2giLCJzaG93TW9iaWxlTWVudSIsInRvZ2dsZU1vYmlsZU1lbnUiLCIkb24iLCJfIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJkaXJlY3RpdmUiLCJyZXF1aXJlIiwicmVzdHJpY3QiLCJsaW5rIiwiZWxlbWVudCIsImF0dHJpYnV0cyIsIm5nTW9kZWwiLCIkcmVuZGVyIiwiaHRtbCIsIiR2aWV3VmFsdWUiLCJiaW5kIiwiJGFwcGx5IiwiJHNldFZpZXdWYWx1ZSIsImZvY3VzVmFsdWUiLCIkZWxlbWVudCIsIiR3YXRjaCIsImN1cnJlbnRWYWx1ZSIsInByZXZpb3VzVmFsdWUiLCJmb2N1cyIsImZhY3RvcnkiLCIkaHR0cCIsImRpc2hGYWN0b3J5IiwicG9zdCIsInB1dCIsInNvY2lhbEZhY3RvcnkiLCJ1aSIsIm1ldGhvZCIsImhyZWYiLCJ1c2VyRmFjdG9yeSIsInNvY2lhbFVzZXIiLCJzZWFyY2hCeSIsInVzZXJzIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwicXVlcnkiLCJnZXRCeUlkIiwidXNlcl9pZCJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQUFDLE9BQUEsY0FBQSxVQUFBLGNBQUEsZUFDQUMsU0FBQSxhQUNBQyxVQUFBLGdCQUNBQyxTQUFBLEtBQ0FDLE1BQUEsUUFDQUMsWUFBQSxhQ0xBTixRQUFBQyxPQUFBLGNBQ0FNLFFBQUEscUJBQUEsa0JBQUEsU0FBQUMsRUFBQUMsR0FFQSxHQUFBQyxHQUFBRixFQUFBRyxjQUFBLGVBQ0FDLElBQUEsVUFHQUosR0FBQUssY0FBQSxnQkFBQUgsR0FFQUYsRUFBQU0sTUFBQSxXQUNBQyxlQUFBLGlCQUNBQyxjQUFBLGVBRUFQLEVBQUFRLEtBQUEsT0FBQSwrQkFDQUEsS0FBQSxRQUFBLGdDQUNBQSxLQUFBLFFBQUEsNENDZkFqQixRQUFBQyxPQUFBLGNBQ0FpQixLQUFBLGFBQUEsVUFBQSxjQUFBLFlBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUgsRUFBQUksS0FBQSxLQUVBSCxFQUFBSSxZQUFBLFdBQ0FDLEdBQUFDLE1BQ0FDLE1BQUFMLEVBQUFuQixVQUNBeUIs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LFNBQUEsU0FBQUssR0FDQSxNQUFBZixHQUFBNUUsSUFBQSxjQUFBMkYsR0FBQTVFLEtBQUEsU0FBQXNCLEdBQ0EsTUFBQUEsR0FBQXhELFFBS0F1RyxFQUFBUSxRQUFBLFNBQUFDLEdBQ0EsTUFBQWpCLEdBQUE1RSxJQUFBLGNBQUE2RixHQUFBOUUsS0FBQSxTQUFBc0IsR0FDQSxNQUFBQSxHQUFBeEQsUUFLQXVHLEVBQUFuRyxPQUFBLFNBQUF2QyxHQUNBLE1BQUFrSSxHQUFBRSxLQUFBLGNBQUFwSSxHQUFBcUUsS0FBQSxXQUNBLE1BQUFxRSxHQUFBaEQsTUFBQTFGLEVBQUFzRixNQUFBdEYsRUFBQXVGLGFBS0FtRCxFQUFBdEQsT0FBQSxTQUFBK0QsRUFBQW5KLEdBQ0EsTUFBQWtJLEdBQUFHLElBQUEsY0FBQWMsRUFBQW5KLEdBQUFxRSxLQUFBLFNBQUFzQixHQUNBLE1BQUFBLEdBQUF4RCxRQUtBdUcsRUFBQXRFLFFBQUEsU0FBQWIsR0FDQSxNQUFBMkUsR0FBQUcsSUFBQSxjQUFBekksRUFBQUksS0FBQTJDLElBQUEsV0FBQVksR0FBQWMsS0FBQSxTQUFBc0IsR0FDQSxNQUFBQSxHQUFBeEQsUUFJQXVHIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJywgWyduZ1JvdXRlJywgJ2FuZ3VsYXItbWQ1JywgJ25nTWF0ZXJpYWwnXSlcbiAgICAuY29uc3RhbnQoJ0NPTlNUQU5UUycsIHtcbiAgICAgICAgXCJGQl9BUFBfSURcIjogMTU2MzU2NzM4NzI1MzQ2OCxcbiAgICAgICAgXCJGQUNFQk9PS1wiOiBcIkZCXCIsXG4gICAgICAgIFwiRU1BSUxcIjogXCJFTUFJTFwiLFxuICAgICAgICBcIlNPQ0lBTF9QQVNTXCI6IFwiUEFTU1dPUkRcIlxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJG1kVGhlbWluZ1Byb3ZpZGVyLCAkbWRJY29uUHJvdmlkZXIpIHtcblxuICAgICAgICB2YXIgcHJpbWFyeU9yYW5nZSA9ICRtZFRoZW1pbmdQcm92aWRlci5leHRlbmRQYWxldHRlKCdkZWVwLW9yYW5nZScsIHtcbiAgICAgICAgICAgICc1MDAnOiAnZjI3MjQyJ1xuICAgICAgICB9KTtcblxuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIuZGVmaW5lUGFsZXR0ZSgncHJpbWFyeU9yYW5nZScsIHByaW1hcnlPcmFuZ2UpO1xuXG4gICAgICAgICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnZGVmYXVsdCcpXG4gICAgICAgICAgICAucHJpbWFyeVBhbGV0dGUoJ3ByaW1hcnlPcmFuZ2UnKVxuICAgICAgICAgICAgLmFjY2VudFBhbGV0dGUoJ2xpZ2h0LWdyZWVuJyk7XG5cbiAgICAgICAgJG1kSWNvblByb3ZpZGVyLmljb24oJ21lbnUnLCAnYXNzZXRzL3N2Zy9pY19tZW51XzI0cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdzaGFyZScsICdhc3NldHMvc3ZnL2ljX3NoYXJlXzI0cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdsb2dpbicsICdhc3NldHMvc3ZnL2ljX2FjY291bnRfY2lyY2xlXzI0cHguc3ZnJyk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCBVc2VyU2VydmljZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IG51bGw7XG5cbiAgICAgICAgJHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRkIuaW5pdCh7XG4gICAgICAgICAgICAgICAgYXBwSWQ6IENPTlNUQU5UUy5GQl9BUFBfSUQsXG4gICAgICAgICAgICAgICAgY29va2llOiB0cnVlLCAvLyBlbmFibGUgY29va2llcyB0byBhbGxvdyB0aGUgc2VydmVyIHRvIGFjY2VzcyB0aGUgc2Vzc2lvblxuICAgICAgICAgICAgICAgIHhmYm1sOiB0cnVlLCAvLyBwYXJzZSBzb2NpYWwgcGx1Z2lucyBvbiB0aGlzIHBhZ2VcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAndjIuMicgLy8gdXNlIHZlcnNpb24gMi4yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBMb2FkIHRoZSBTREsgYXN5bmNocm9ub3VzbHlcbiAgICAgICAgKGZ1bmN0aW9uKGQsIHMsIGlkKSB7XG4gICAgICAgICAgICB2YXIganMsIGZqcyA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUocylbMF07XG4gICAgICAgICAgICBpZiAoZC5nZXRFbGVtZW50QnlJZChpZCkpIHJldHVybjtcbiAgICAgICAgICAgIGpzID0gZC5jcmVhdGVFbGVtZW50KHMpO1xuICAgICAgICAgICAganMuaWQgPSBpZDtcbiAgICAgICAgICAgIGpzLnNyYyA9IFwiLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9zZGsuanNcIjtcbiAgICAgICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcbiAgICAgICAgfShkb2N1bWVudCwgJ3NjcmlwdCcsICdmYWNlYm9vay1qc3NkaycpKTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkcm91dGVQcm92aWRlcikge1xuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgLy9ob21lIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvaG9tZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2hvbWUnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9zaG93IGFsbCBkaXNoZXMgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2FsbC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaExpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTGlzdCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3Nob3cgZGlzaCBkZXRhaWwgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2RldGFpbC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaERldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2RldGFpbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL2xpc3QgYWRtaW4gZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy9saXN0Jywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vY3JlYXRlIGEgbmV3IGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvY3JlYXRlJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hDcmVhdGVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vZWRpdCBhIGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaEVkaXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbG9naW4nXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy91c2VyIHByb2ZpbGVcbiAgICAgICAgICAgIC53aGVuKCcvbWUnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy91c2VyL21lLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQcm9maWxlQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbWUnXG4gICAgICAgICAgICB9KVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggbGlzdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hMaXN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlLCBTb2NpYWxTZXJ2aWNlLCAkbG9jYXRpb24pIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvL3NldCBhIHByb2Nlc3NpbmcgdmFyaWFibGUgdG8gc2hvdyBsb2FkaW5nXG4gICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgIC8vZ3JhYiBhbGwgdGhlIGRpc2hlcyBhdCBwYWdlIGxvYWRcbiAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAvL3doZW4gYWxsIGRpc2hlcyBmZXRjaGVkLCByZW1vdmUgcHJvY2Vzc2luZyB2YXJpYWJsZVxuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvL2JpbmQgdGhlIGRpc2hlc1xuICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9mdW5jdGlvbiB0byBkZWxldGUgYSBkaXNoXG4gICAgICAgIHZtLmRlbGV0ZURpc2ggPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmRlbGV0ZShpZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFkZERpc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICduZXcgZGlzaCdcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4vZGlzaC8nICsgZGF0YS5kaXNoLl9pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmZiU2hhcmUgPSBmdW5jdGlvbihkaXNoKSB7XG4gICAgICAgICAgICB2YXIgZGlzaExpbmsgPSAkbG9jYXRpb24uYWJzVXJsKCkgKyAnLycgKyBkaXNoLl9pZDtcbiAgICAgICAgICAgIFNvY2lhbFNlcnZpY2UuZmJTaGFyZShkaXNoTGluayk7XG4gICAgICAgIH1cblxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBkZXRhaWwgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoRGV0YWlsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsIERpc2hTZXJ2aWNlLCBVc2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5kaXNoID0ge307XG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICAvL2dldCB0aGUgZGlzaCBieSBpZFxuICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgICAgICBpZiAoJHJvb3RTY29wZS51c2VyICYmICRyb290U2NvcGUudXNlci5mYXZvdXJpdGVEaXNoZXMuaW5kZXhPZih2bS5kaXNoLl9pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgIHZtLmRpc2guaXNDb2xsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNoLmlzQ29sbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0uYWRkQ29tbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuVXJsID0gJGxvY2F0aW9uLnVybCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJykuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVXJsOiByZXR1cm5VcmxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UuYWRkQ29tbWVudCh2bS5kaXNoLl9pZCwgdm0ubmV3Q29tbWVudCkuc3VjY2VzcyhmdW5jdGlvbihjb21tZW50KSB7XG4gICAgICAgICAgICAgICAgdm0uZGlzaC5jb21tZW50cy5wdXNoKGNvbW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZXBseSA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHZtLm5ld0NvbW1lbnQucmVwbHlUbyA9IHVzZXIuX2lkO1xuICAgICAgICAgICAgdm0uY29tbWVudFRpdGxlID0gJ0AnICsgdXNlci51c2VyTmFtZTtcbiAgICAgICAgICAgICRzY29wZS5mb2N1c09uQ29tbWVudCA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY29sbGVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuVXJsID0gJGxvY2F0aW9uLnVybCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJykuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVXJsOiByZXR1cm5VcmxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuY29sbGVjdCh2bS5kaXNoLl9pZCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVc2VyU2VydmljZS5jb2xsZWN0OlwiLCBkYXRhKTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaC5pc0NvbGxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5uZXdDb21tZW50ID0ge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICAgICAgICAgIHJlcGx5VG86IG51bGwsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdm0uY29tbWVudFRpdGxlID0gJ0NvbW1lbnQnO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGNyZWF0aW9uIHBhZ2VcbiAgICAvL25vdCB1c2UgYW55bW9yZVxuICAgIC5jb250cm9sbGVyKCdEaXNoQ3JlYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5kaXNoID0ge1xuICAgICAgICAgICAgbmFtZTogJ25ldyBkaXNoJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUodm0uZGlzaCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9hZG1pbi9kaXNoLycgKyBkYXRhLmRpc2guX2lkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG5cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgdm0udHlwZSA9ICdjcmVhdGUnO1xuICAgICAgICAgICAgdm0uZGlzaCA9IHtcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnM6IFtdLFxuICAgICAgICAgICAgICAgIHBob3RvOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZtLm5ld0luc3RydWN0aW9uID0gJyc7XG4gICAgICAgICAgICB2bS5uZXdQaG90byA9ICcnO1xuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMubGVuZ3RoID0gMDtcbiAgICAgICAgICAgIHZtLmRpc2gucGhvdG9zLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggZWRpdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hFZGl0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRyb3V0ZVBhcmFtcywgRGlzaFNlcnZpY2UsICRsb2NhdGlvbikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgLy9nZXQgdGhlIGRpc2ggYnkgaWRcbiAgICAgICAgRGlzaFNlcnZpY2UuZ2V0KCRyb3V0ZVBhcmFtcy5kaXNoX2lkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHZtLmRpc2ggPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5hZGRJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMucHVzaCh2bS5uZXdJbnN0cnVjdGlvbik7XG4gICAgICAgICAgICB2bS5uZXdJbnN0cnVjdGlvbiA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVtb3ZlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmFkZFBob3RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5ld1Bob3RvOiBcIiwgdm0ubmV3UGhvdG8pO1xuICAgICAgICAgICAgdm0uZGlzaC5waG90b3MucHVzaCh2bS5uZXdQaG90byk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImRpc2g6XCIsIHZtLmRpc2gpO1xuICAgICAgICAgICAgdm0ubmV3UGhvdG8gPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnJlbW92ZVBob3RvID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIHZtLmRpc2gucGhvdG9zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UudXBkYXRlKCRyb3V0ZVBhcmFtcy5kaXNoX2lkLCB2bS5kaXNoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpbml0KCk7XG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgdm0ubmV3UGhvdG8gPSAnJztcbiAgICAgICAgICAgIHZtLm5ld0luc3RydWN0aW9uID0gJyc7XG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSwgJGxvY2F0aW9uLCBDT05TVEFOVFMsIG1kNSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5lbWFpbCA9IFwiXCI7XG4gICAgICAgIHZtLnBhc3N3b3JkID0gXCJcIjtcbiAgICAgICAgdm0udXNlck5hbWUgPSBcIlwiO1xuICAgICAgICB2bS5zaG93U2lnblVwRm9ybSA9IGZhbHNlO1xuXG4gICAgICAgIHZtLmZiTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmxvZ2luKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nZ2VkIGludG8geW91ciBhcHAgYW5kIEZhY2Vib29rLlxuICAgICAgICAgICAgICAgICAgICBGQi5hcGkoJy9tZScsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmIgdXNlcjogJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZiVXNlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogcmVzcG9uc2UubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogcmVzcG9uc2UuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IENPTlNUQU5UUy5TT0NJQUxfUEFTUyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG90b1VybDogJ2h0dHA6Ly9ncmFwaC5mYWNlYm9vay5jb20vJyArIHJlc3BvbnNlLmlkICsgJy9waWN0dXJlP3R5cGU9bGFyZ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkZBQ0VCT09LXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5zb2NpYWxMb2dpbihmYlVzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkZBQ0VCT09LO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdub3RfYXV0aG9yaXplZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBsb2dnZWQgaW50byBGYWNlYm9vaywgYnV0IG5vdCB5b3VyIGFwcC5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIG5vdCBsb2dnZWQgaW50byBGYWNlYm9vaywgc28gd2UncmUgbm90IHN1cmUgaWZcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhleSBhcmUgbG9nZ2VkIGludG8gdGhpcyBhcHAgb3Igbm90LlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzY29wZTogJ3B1YmxpY19wcm9maWxlLGVtYWlsJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgVXNlclNlcnZpY2UubG9naW4odm0uZW1haWwsIHZtLnBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICB1c2VyLmxvZ2luVHlwZSA9IENPTlNUQU5UUy5FTUFJTDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNpZ25VcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgICAgICAgdXNlck5hbWU6IHZtLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5lbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdm0ucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcGhvdG9Vcmw6ICdodHRwOi8vd3d3LmdyYXZhdGFyLmNvbS9hdmF0YXIvJyArIG1kNS5jcmVhdGVIYXNoKHZtLmVtYWlsKSxcbiAgICAgICAgICAgICAgICBsaW5rZWRTb2NpYWw6IENPTlNUQU5UUy5FTUFJTFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuY3JlYXRlKG5ld1VzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0uc2hvd01vYmlsZU1lbnUgPSBmYWxzZTtcblxuICAgICAgICB2bS50b2dnbGVNb2JpbGVNZW51ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5zaG93TW9iaWxlTWVudSA9ICF2bS5zaG93TW9iaWxlTWVudTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oXywgdXNlcikge1xuICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gdm0uY3VycmVudFVzZXIgPSB1c2VyO1xuXG4gICAgICAgICAgICB2YXIgcmV0dXJuVXJsID0gJGxvY2F0aW9uLnNlYXJjaCgpLnJldHVyblVybDtcbiAgICAgICAgICAgIGlmIChyZXR1cm5VcmwpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmV0dXJuIHVybDogJywgcmV0dXJuVXJsKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChyZXR1cm5VcmwpLnNlYXJjaCh7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblVybDogbnVsbFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHZtLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHZtLmN1cnJlbnRVc2VyLmxvZ2luVHlwZSA9PSBDT05TVEFOVFMuRkFDRUJPT0spIHtcbiAgICAgICAgICAgICAgICBGQi5sb2dvdXQoZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gbnVsbDtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgIH07XG5cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignUHJvZmlsZUNvbnRyb2xsZXInLCBmdW5jdGlvbihVc2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS51c2VyID0ge307XG5cbiAgICAgICAgVXNlclNlcnZpY2UuZ2V0KCkudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICB2bS51c2VyID0gdXNlcjtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmRpcmVjdGl2ZSgnY29udGVudGVkaXRhYmxlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0cywgbmdNb2RlbCkge1xuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwobmdNb2RlbC4kdmlld1ZhbHVlIHx8ICcnKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdibHVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShlbGVtZW50Lmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ2ZvY3VzT24nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGZvY3VzVmFsdWU6IFwiPWZvY3VzT25cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdmb2N1c1ZhbHVlJywgZnVuY3Rpb24oY3VycmVudFZhbHVlLCBwcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgJiYgIXByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50WzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnRGlzaFNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCkge1xuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IG9iamVjdFxuICAgICAgICB2YXIgZGlzaEZhY3RvcnkgPSB7fTtcblxuICAgICAgICAvL2dldCBhbGwgZGlzaGVzXG4gICAgICAgIGRpc2hGYWN0b3J5LmFsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2NyZWF0ZSBhIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuY3JlYXRlID0gZnVuY3Rpb24oZGlzaCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvZGlzaGVzJywgZGlzaCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9nZXQgYSBzaW5nbGUgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5nZXQgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3VwZGF0ZSBhIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkudXBkYXRlID0gZnVuY3Rpb24oZGlzaF9pZCwgZGlzaCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQsIGRpc2gpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9kZWxldGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmRlbGV0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vYWRkIGEgY29tbWVudFxuICAgICAgICBkaXNoRmFjdG9yeS5hZGRDb21tZW50ID0gZnVuY3Rpb24oZGlzaF9pZCwgY29tbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkICsgJy9jb21tZW50cycsIGNvbW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaXNoRmFjdG9yeTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnU29jaWFsU2VydmljZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc29jaWFsRmFjdG9yeSA9IHt9O1xuXG4gICAgICAgIHNvY2lhbEZhY3RvcnkuZmJTaGFyZSA9IGZ1bmN0aW9uKGxpbmspIHtcbiAgICAgICAgICAgIEZCLnVpKHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdzaGFyZScsXG4gICAgICAgICAgICAgICAgaHJlZjogbGluayxcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7fSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc29jaWFsRmFjdG9yeTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgJHJvb3RTY29wZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB1c2VyRmFjdG9yeSA9IHt9O1xuICAgICAgICAvL3NvY2lhbCBsb2dpblxuICAgICAgICB1c2VyRmFjdG9yeS5zb2NpYWxMb2dpbiA9IGZ1bmN0aW9uKHNvY2lhbFVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic29jaWFsVXNlcjogXCIsIHNvY2lhbFVzZXIpO1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnkuc2VhcmNoQnkoJ2VtYWlsPScgKyBzb2NpYWxVc2VyLmVtYWlsKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90IGZvdW5kLCB0aGVuIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuY3JlYXRlKHNvY2lhbFVzZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZm91bmQgdGhlIHVzZXIgd2l0aCBlbWFpbFxuICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSB0aGUgbGlua2VkIHNvY2lhbCBpZiBub3QgYWRkZWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBkYXRhLnVzZXJzWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5saW5rZWRTb2NpYWwuaW5kZXhPZihzb2NpYWxVc2VyLmxpbmtlZFNvY2lhbCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxpbmtlZFNvY2lhbC5wdXNoKHNvY2lhbFVzZXIubGlua2VkU29jaWFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIudXNlck5hbWUgPSBzb2NpYWxVc2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5waG90b1VybCA9IHNvY2lhbFVzZXIucGhvdG9Vcmw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS51cGRhdGUodXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgQ09OU1RBTlRTLlNPQ0lBTF9QQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dpbiA9IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9hdXRoJywge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9nb3V0IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgY3VycmVudCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9tZScpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9zZWFyY2ggdXNlciBieSBmaWVsZFxuICAgICAgICB1c2VyRmFjdG9yeS5zZWFyY2hCeSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzPycgKyBxdWVyeSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCB1c2VyIGJ5IGlkXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldEJ5SWQgPSBmdW5jdGlvbih1c2VyX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzLycgKyB1c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkuY3JlYXRlID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMvJywgdXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgdXNlci5wYXNzd29yZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkudXBkYXRlID0gZnVuY3Rpb24odXNlcl9pZCwgdXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCwgdXNlcikudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NvbGxlY3QgZGlzaCBhcyBmYXZvdXJpdGVcbiAgICAgICAgdXNlckZhY3RvcnkuY29sbGVjdCA9IGZ1bmN0aW9uKGRpc2hfaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvdXNlcnMvJyArICRyb290U2NvcGUudXNlci5faWQgKyAnL2Rpc2hlcy8nICsgZGlzaF9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnk7XG4gICAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=