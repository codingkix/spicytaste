angular.module("spicyTaste",["ngRoute","angular-md5"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/all.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/list",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"})}]),angular.module("spicyTaste").controller("DishListController",["DishService",function(e){var n=this;n.processing=!0,e.all().success(function(e){n.processing=!1,n.dishes=e}),n.deleteDish=function(t){n.processing=!0,e["delete"](t).success(function(){e.all().success(function(e){n.processing=!1,n.dishes=e})})},n.addDish=function(){n.processing=!0,e.create({name:"new dish"}).success(function(e){$location.path("/admin/dish/"+e.dish._id)})}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","DishService","UserService",function(e,n,t,o,i,s){function r(){e.focusOnComment=!1,l.newComment={content:"",replyTo:null},l.commentTitle="Comment"}var l=this;l.dish={},r(),i.get(o.dish_id).success(function(e){l.dish=e,l.dish.isCollected=t.user&&t.user.favouriteDishes.indexOf(l.dish._id)>=0?!0:!1}),l.addComment=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}i.addComment(l.dish._id,l.newComment).success(function(e){l.dish.comments.push(e)}),r()},l.reply=function(n){l.newComment.replyTo=n._id,l.commentTitle="@"+n.userName,e.focusOnComment=!0},l.collect=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}s.collect(l.dish._id).then(function(e){console.log("UserService.collect:",e),e.success&&(l.dish.isCollected=!0)})}}]).controller("DishCreateController",["$location","DishService",function(e,n){var t=this;t.dish={name:"new dish"},t.save=function(){t.processing=!0,n.create(t.dish).success(function(n){e.path("/admin/dish/"+n.dish._id)})}}]).controller("DishEditController",["$routeParams","DishService","$location",function(e,n){function t(){o.newPhoto="",o.newInstruction="",o.message="",o.processing=!1}var o=this;t(),n.get(e.dish_id).success(function(e){o.dish=e}),o.addInstruction=function(){o.dish.instructions.push(o.newInstruction),o.newInstruction=""},o.removeInstruction=function(e){o.dish.instructions.splice(e,1)},o.addPhoto=function(){console.log("newPhoto: ",o.newPhoto),o.dish.photos.push(o.newPhoto),console.log("dish:",o.dish),o.newPhoto=""},o.removePhoto=function(e){o.dish.photos.splice(e,1)},o.save=function(){o.processing=!0,n.update(e.dish_id,o.dish).success(function(e){t(),o.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS","md5",function(e,n,t,o,i){var s=this;s.email="",s.password="",s.userName="",s.showSignUpForm=!1,s.fbLogin=function(){FB.login(function(t){"connected"===t.status?FB.api("/me",function(t){console.log("fb user: ",t);var i={userName:t.name,email:t.email,password:o.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+t.id+"/picture?type=large",linkedSocial:o.FACEBOOK};n.socialLogin(i).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n)})}):"not_authorized"===t.status},{scope:"public_profile,email"})},s.login=function(){n.login(s.email,s.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n)})},s.signUp=function(){var t={userName:s.userName,email:s.email,password:s.password,photoUrl:"http://www.gravatar.com/avatar/"+i.createHash(s.email),linkedSocial:o.EMAIL};n.create(t).then(function(n){e.$emit("login",n)})}}]),angular.module("spicyTaste").controller("MainController",["$scope","$rootScope","$location","UserService","CONSTANTS",function(e,n,t,o,i){var s=this;e.$on("login",function(e,o){n.user=s.currentUser=o;var i=t.search().returnUrl;i?(console.log("return url: ",i),t.path(i).search({returnUrl:null})):t.path("/")}),s.logout=function(){s.currentUser.loginType==i.FACEBOOK&&FB.logout(function(){}),s.currentUser=null,n.user=null,o.logout()}}]),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n}]),angular.module("spicyTaste").factory("UserService",["$http","$rootScope","CONSTANTS",function(e,n,t){var o={};return o.socialLogin=function(e){return console.log("socialUser: ",e),o.searchBy("email="+e.email).then(function(n){if(n.success){var i=n.users[0];return i.linkedSocial.indexOf(e.linkedSocial)<0?(i.linkedSocial.push(e.linkedSocial),i.userName=e.userName,i.photoUrl=e.photoUrl,o.update(i).then(function(){return o.login(i.email,t.SOCIAL_PASS)})):o.login(i.email,t.SOCIAL_PASS)}return o.create(e)})},o.login=function(n,t){return e.post("/api/auth",{email:n,password:t}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,o.get()})},o.logout=function(){delete e.defaults.headers.common["X-Auth"]},o.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},o.searchBy=function(n){return e.get("/api/users?"+n).then(function(e){return e.data})},o.getById=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},o.create=function(n){return e.post("/api/users/",n).then(function(){return o.login(n.email,n.password)})},o.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},o.collect=function(t){return e.put("/api/users/"+n.user._id+"/dishes/"+t).then(function(e){return e.data})},o}]),angular.module("spicyTaste").directive("contenteditable",function(){return{require:"ngModel",restrict:"A",link:function(e,n,t,o){o.$render=function(){n.html(o.$viewValue||"")},n.bind("blur",function(){e.$apply(function(){o.$setViewValue(n.html())})})}}}),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,n){e.$watch("focusValue",function(e,t){e&&!t&&n[0].focus()})}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwic2VydmljZXMvZGlzaFNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyIsImRpcmVjdGl2ZXMvY29udGVudGVkaXRhYmxlRGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9mb2N1c09uRGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIkZCX0FQUF9JRCIsIkZBQ0VCT09LIiwiRU1BSUwiLCJTT0NJQUxfUEFTUyIsInJ1biIsIiRyb290U2NvcGUiLCIkd2luZG93IiwiVXNlclNlcnZpY2UiLCJDT05TVEFOVFMiLCJ1c2VyIiwiZmJBc3luY0luaXQiLCJGQiIsImluaXQiLCJhcHBJZCIsImNvb2tpZSIsInhmYm1sIiwidmVyc2lvbiIsImQiLCJzIiwiaWQiLCJqcyIsImZqcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImRvY3VtZW50IiwiY29uZmlnIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJEaXNoU2VydmljZSIsInZtIiwidGhpcyIsInByb2Nlc3NpbmciLCJhbGwiLCJzdWNjZXNzIiwiZGF0YSIsImRpc2hlcyIsImRlbGV0ZURpc2giLCJhZGREaXNoIiwiY3JlYXRlIiwibmFtZSIsIiRsb2NhdGlvbiIsInBhdGgiLCJkaXNoIiwiX2lkIiwiJHNjb3BlIiwiJHJvdXRlUGFyYW1zIiwiZm9jdXNPbkNvbW1lbnQiLCJuZXdDb21tZW50IiwiY29udGVudCIsInJlcGx5VG8iLCJjb21tZW50VGl0bGUiLCJnZXQiLCJkaXNoX2lkIiwiaXNDb2xsZWN0ZWQiLCJmYXZvdXJpdGVEaXNoZXMiLCJpbmRleE9mIiwiYWRkQ29tbWVudCIsInJldHVyblVybCIsInVybCIsInNlYXJjaCIsImNvbW1lbnQiLCJjb21tZW50cyIsInB1c2giLCJyZXBseSIsInVzZXJOYW1lIiwiY29sbGVjdCIsInRoZW4iLCJjb25zb2xlIiwibG9nIiwic2F2ZSIsIm5ld1Bob3RvIiwibmV3SW5zdHJ1Y3Rpb24iLCJtZXNzYWdlIiwiYWRkSW5zdHJ1Y3Rpb24iLCJpbnN0cnVjdGlvbnMiLCJyZW1vdmVJbnN0cnVjdGlvbiIsImluZGV4Iiwic3BsaWNlIiwiYWRkUGhvdG8iLCJwaG90b3MiLCJyZW1vdmVQaG90byIsInVwZGF0ZSIsIm1kNSIsImVtYWlsIiwicGFzc3dvcmQiLCJzaG93U2lnblVwRm9ybSIsImZiTG9naW4iLCJsb2dpbiIsInJlc3BvbnNlIiwic3RhdHVzIiwiYXBpIiwiZmJVc2VyIiwicGhvdG9VcmwiLCJsaW5rZWRTb2NpYWwiLCJzb2NpYWxMb2dpbiIsImxvZ2luVHlwZSIsIiRlbWl0Iiwic2NvcGUiLCJzaWduVXAiLCJuZXdVc2VyIiwiY3JlYXRlSGFzaCIsIiRvbiIsIl8iLCJjdXJyZW50VXNlciIsImxvZ291dCIsImZhY3RvcnkiLCIkaHR0cCIsImRpc2hGYWN0b3J5IiwicG9zdCIsInB1dCIsInVzZXJGYWN0b3J5Iiwic29jaWFsVXNlciIsInNlYXJjaEJ5IiwidXNlcnMiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJxdWVyeSIsImdldEJ5SWQiLCJ1c2VyX2lkIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInJlc3RyaWN0IiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dHMiLCJuZ01vZGVsIiwiJHJlbmRlciIsImh0bWwiLCIkdmlld1ZhbHVlIiwiYmluZCIsIiRhcHBseSIsIiRzZXRWaWV3VmFsdWUiLCJmb2N1c1ZhbHVlIiwiJGVsZW1lbnQiLCIkd2F0Y2giLCJjdXJyZW50VmFsdWUiLCJwcmV2aW91c1ZhbHVlIiwiZm9jdXMiXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFBQyxPQUFBLGNBQUEsVUFBQSxnQkFDQUMsU0FBQSxhQUNBQyxVQUFBLGdCQUNBQyxTQUFBLEtBQ0FDLE1BQUEsUUFDQUMsWUFBQSxhQ0xBTixRQUFBQyxPQUFBLGNBQ0FNLEtBQUEsYUFBQSxVQUFBLGNBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxLQUFBLEtBRUFILEVBQUFJLFlBQUEsV0FDQUMsR0FBQUMsTUFDQUMsTUFBQUwsRUFBQVIsVUFDQWMsUUFBQSxFQUNBQyxPQUFBLEVBQ0FDLFFBQUEsVUFLQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEdBQUFDLEVBQUFKLEVBQUFLLHFCQUFBSixHQUFBLEVBQ0FELEdBQUFNLGVBQUFKLEtBQ0FDLEVBQUFILEVBQUFPLGNBQUFOLEdBQ0FFLEVBQUFELEdBQUFBLEVBQ0FDLEVBQUFLLElBQUEsc0NBQ0FKLEVBQUFLLFdBQUFDLGFBQUFQLEVBQUFDLEtBQ0FPLFNBQUEsU0FBQSxxQkNyQkEvQixRQUFBQyxPQUFBLGNBQ0ErQixRQUFBLG9CQUFBLGlCQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEVBQUFFLFdBQUEsR0FFQUQsRUFFQUUsS0FBQSxLQUNBQyxZQUFBLDJCQUNBQyxXQUFBLGlCQUNBQyxhQUFBLFNBR0FILEtBQUEsV0FDQUMsWUFBQSwrQkFDQUMsV0FBQSxxQkFDQUMsYUFBQSxhQUdBSCxLQUFBLG9CQUNBQyxZQUFBLGtDQUNBQyxXQUFBLHVCQUNBQyxhQUFBLFdBR0FILEtBQUEsc0JBQ0FDLFlBQUEsc0NBQ0FDLFdBQUEscUJBQ0FDLGFBQUEsYUFHQUgsS0FBQSx3QkFDQUMsWUFBQSx3Q0FDQUMsV0FBQSx1QkFDQUMsYUFBQSxlQUdBSCxLQUFBLDBCQUNBQyxZQUFBLHdDQUNB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QUFBLFdBQ0EsT0FDQUMsUUFBQSxVQUNBQyxTQUFBLElBQ0FDLEtBQUEsU0FBQTFCLEVBQUEyQixFQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxRQUFBLFdBQ0FILEVBQUFJLEtBQUFGLEVBQUFHLFlBQUEsS0FHQUwsRUFBQU0sS0FBQSxPQUFBLFdBQ0FqQyxFQUFBa0MsT0FBQSxXQUNBTCxFQUFBTSxjQUFBUixFQUFBSSxnQkNaQTVJLFFBQUFDLE9BQUEsY0FDQW1JLFVBQUEsVUFBQSxXQUNBLE9BQ0FFLFNBQUEsSUFDQXpCLE9BQ0FvQyxXQUFBLFlBRUFWLEtBQUEsU0FBQS9FLEVBQUEwRixHQUNBMUYsRUFBQTJGLE9BQUEsYUFBQSxTQUFBQyxFQUFBQyxHQUNBRCxJQUFBQyxHQUNBSCxFQUFBLEdBQUFJIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJywgWyduZ1JvdXRlJywgJ2FuZ3VsYXItbWQ1J10pXG4gICAgLmNvbnN0YW50KCdDT05TVEFOVFMnLCB7XG4gICAgICAgIFwiRkJfQVBQX0lEXCI6IDE1NjM1NjczODcyNTM0NjgsXG4gICAgICAgIFwiRkFDRUJPT0tcIjogXCJGQlwiLFxuICAgICAgICBcIkVNQUlMXCI6IFwiRU1BSUxcIixcbiAgICAgICAgXCJTT0NJQUxfUEFTU1wiOiBcIlBBU1NXT1JEXCJcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUsICR3aW5kb3csIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0gbnVsbDtcblxuICAgICAgICAkd2luZG93LmZiQXN5bmNJbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBGQi5pbml0KHtcbiAgICAgICAgICAgICAgICBhcHBJZDogQ09OU1RBTlRTLkZCX0FQUF9JRCxcbiAgICAgICAgICAgICAgICBjb29raWU6IHRydWUsIC8vIGVuYWJsZSBjb29raWVzIHRvIGFsbG93IHRoZSBzZXJ2ZXIgdG8gYWNjZXNzIHRoZSBzZXNzaW9uXG4gICAgICAgICAgICAgICAgeGZibWw6IHRydWUsIC8vIHBhcnNlIHNvY2lhbCBwbHVnaW5zIG9uIHRoaXMgcGFnZVxuICAgICAgICAgICAgICAgIHZlcnNpb246ICd2Mi4yJyAvLyB1c2UgdmVyc2lvbiAyLjJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIExvYWQgdGhlIFNESyBhc3luY2hyb25vdXNseVxuICAgICAgICAoZnVuY3Rpb24oZCwgcywgaWQpIHtcbiAgICAgICAgICAgIHZhciBqcywgZmpzID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZShzKVswXTtcbiAgICAgICAgICAgIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkgcmV0dXJuO1xuICAgICAgICAgICAganMgPSBkLmNyZWF0ZUVsZW1lbnQocyk7XG4gICAgICAgICAgICBqcy5pZCA9IGlkO1xuICAgICAgICAgICAganMuc3JjID0gXCIvL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL3Nkay5qc1wiO1xuICAgICAgICAgICAgZmpzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGpzLCBmanMpO1xuICAgICAgICB9KGRvY3VtZW50LCAnc2NyaXB0JywgJ2ZhY2Vib29rLWpzc2RrJykpO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAvL2hvbWUgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy8nLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9ob21lLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnaG9tZSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3Nob3cgYWxsIGRpc2hlcyBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvYWxsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vc2hvdyBkaXNoIGRldGFpbCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvZGV0YWlsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGV0YWlsJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbGlzdCBhZG1pbiBkaXNoIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vZGlzaGVzL2xpc3QnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL2xpc3QuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hMaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaExpc3QnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9jcmVhdGUgYSBuZXcgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy9jcmVhdGUnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaENyZWF0ZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9lZGl0IGEgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2FkbWluL2Rpc2gvc2luZ2xlLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRWRpdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9sb2dpbiB1c2VyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvdXNlci9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdsb2dpbidcbiAgICAgICAgICAgIH0pXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBsaXN0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaExpc3RDb250cm9sbGVyJywgZnVuY3Rpb24oRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvL3NldCBhIHByb2Nlc3NpbmcgdmFyaWFibGUgdG8gc2hvdyBsb2FkaW5nXG4gICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgIC8vZ3JhYiBhbGwgdGhlIGRpc2hlcyBhdCBwYWdlIGxvYWRcbiAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAvL3doZW4gYWxsIGRpc2hlcyBmZXRjaGVkLCByZW1vdmUgcHJvY2Vzc2luZyB2YXJpYWJsZVxuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvL2JpbmQgdGhlIGRpc2hlc1xuICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9mdW5jdGlvbiB0byBkZWxldGUgYSBkaXNoXG4gICAgICAgIHZtLmRlbGV0ZURpc2ggPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmRlbGV0ZShpZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFkZERpc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICduZXcgZGlzaCdcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4vZGlzaC8nICsgZGF0YS5kaXNoLl9pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGRldGFpbCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hEZXRhaWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgRGlzaFNlcnZpY2UsIFVzZXJTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmRpc2ggPSB7fTtcbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIC8vZ2V0IHRoZSBkaXNoIGJ5IGlkXG4gICAgICAgIERpc2hTZXJ2aWNlLmdldCgkcm91dGVQYXJhbXMuZGlzaF9pZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB2bS5kaXNoID0gZGF0YTtcbiAgICAgICAgICAgIGlmICgkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLmZhdm91cml0ZURpc2hlcy5pbmRleE9mKHZtLmRpc2guX2lkKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgdm0uZGlzaC5pc0NvbGxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLmRpc2guaXNDb2xsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICB2bS5hZGRDb21tZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUudXNlcikge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24udXJsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKS5zZWFyY2goe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5Vcmw6IHJldHVyblVybFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5hZGRDb21tZW50KHZtLmRpc2guX2lkLCB2bS5uZXdDb21tZW50KS5zdWNjZXNzKGZ1bmN0aW9uKGNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNoLmNvbW1lbnRzLnB1c2goY29tbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlcGx5ID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgdm0ubmV3Q29tbWVudC5yZXBseVRvID0gdXNlci5faWQ7XG4gICAgICAgICAgICB2bS5jb21tZW50VGl0bGUgPSAnQCcgKyB1c2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jb2xsZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUudXNlcikge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24udXJsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKS5zZWFyY2goe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5Vcmw6IHJldHVyblVybFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5jb2xsZWN0KHZtLmRpc2guX2lkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXJTZXJ2aWNlLmNvbGxlY3Q6XCIsIGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2bS5kaXNoLmlzQ29sbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICAkc2NvcGUuZm9jdXNPbkNvbW1lbnQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLm5ld0NvbW1lbnQgPSB7XG4gICAgICAgICAgICAgICAgY29udGVudDogJycsXG4gICAgICAgICAgICAgICAgcmVwbHlUbzogbnVsbCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2bS5jb21tZW50VGl0bGUgPSAnQ29tbWVudCc7XG4gICAgICAgIH1cbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggY3JlYXRpb24gcGFnZVxuICAgIC8vbm90IHVzZSBhbnltb3JlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hDcmVhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCBEaXNoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmRpc2ggPSB7XG4gICAgICAgICAgICBuYW1lOiAnbmV3IGRpc2gnXG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmNyZWF0ZSh2bS5kaXNoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2FkbWluL2Rpc2gvJyArIGRhdGEuZGlzaC5faWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cblxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICB2bS50eXBlID0gJ2NyZWF0ZSc7XG4gICAgICAgICAgICB2bS5kaXNoID0ge1xuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICAgICAgICAgICAgcGhvdG86IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdm0ubmV3SW5zdHJ1Y3Rpb24gPSAnJztcbiAgICAgICAgICAgIHZtLm5ld1Bob3RvID0gJyc7XG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5kaXNoLmluc3RydWN0aW9ucy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgdm0uZGlzaC5waG90b3MubGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBlZGl0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSwgJGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICAvL2dldCB0aGUgZGlzaCBieSBpZFxuICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLmFkZEluc3RydWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5kaXNoLmluc3RydWN0aW9ucy5wdXNoKHZtLm5ld0luc3RydWN0aW9uKTtcbiAgICAgICAgICAgIHZtLm5ld0luc3RydWN0aW9uID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5yZW1vdmVJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICB2bS5kaXNoLmluc3RydWN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uYWRkUGhvdG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibmV3UGhvdG86IFwiLCB2bS5uZXdQaG90byk7XG4gICAgICAgICAgICB2bS5kaXNoLnBob3Rvcy5wdXNoKHZtLm5ld1Bob3RvKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzaDpcIiwgdm0uZGlzaCk7XG4gICAgICAgICAgICB2bS5uZXdQaG90byA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVtb3ZlUGhvdG8gPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAgICAgdm0uZGlzaC5waG90b3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS51cGRhdGUoJHJvdXRlUGFyYW1zLmRpc2hfaWQsIHZtLmRpc2gpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICB2bS5uZXdQaG90byA9ICcnO1xuICAgICAgICAgICAgdm0ubmV3SW5zdHJ1Y3Rpb24gPSAnJztcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlLCAkbG9jYXRpb24sIENPTlNUQU5UUywgbWQ1KSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmVtYWlsID0gXCJcIjtcbiAgICAgICAgdm0ucGFzc3dvcmQgPSBcIlwiO1xuICAgICAgICB2bS51c2VyTmFtZSA9IFwiXCI7XG4gICAgICAgIHZtLnNob3dTaWduVXBGb3JtID0gZmFsc2U7XG5cbiAgICAgICAgdm0uZmJMb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRkIubG9naW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnY29ubmVjdGVkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBMb2dnZWQgaW50byB5b3VyIGFwcCBhbmQgRmFjZWJvb2suXG4gICAgICAgICAgICAgICAgICAgIEZCLmFwaSgnL21lJywgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmYiB1c2VyOiAnLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmJVc2VyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiByZXNwb25zZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiByZXNwb25zZS5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogQ09OU1RBTlRTLlNPQ0lBTF9QQVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvVXJsOiAnaHR0cDovL2dyYXBoLmZhY2Vib29rLmNvbS8nICsgcmVzcG9uc2UuaWQgKyAnL3BpY3R1cmU/dHlwZT1sYXJnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua2VkU29jaWFsOiBDT05TVEFOVFMuRkFDRUJPT0tcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLnNvY2lhbExvZ2luKGZiVXNlcikudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRkFDRUJPT0s7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ25vdF9hdXRob3JpemVkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIGxvZ2dlZCBpbnRvIEZhY2Vib29rLCBidXQgbm90IHlvdXIgYXBwLlxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwZXJzb24gaXMgbm90IGxvZ2dlZCBpbnRvIEZhY2Vib29rLCBzbyB3ZSdyZSBub3Qgc3VyZSBpZlxuICAgICAgICAgICAgICAgICAgICAvLyB0aGV5IGFyZSBsb2dnZWQgaW50byB0aGlzIGFwcCBvciBub3QuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNjb3BlOiAncHVibGljX3Byb2ZpbGUsZW1haWwnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBVc2VyU2VydmljZS5sb2dpbih2bS5lbWFpbCwgdm0ucGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkVNQUlMO1xuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uc2lnblVwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbmV3VXNlciA9IHtcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogdm0udXNlck5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IHZtLmVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB2bS5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICBwaG90b1VybDogJ2h0dHA6Ly93d3cuZ3JhdmF0YXIuY29tL2F2YXRhci8nICsgbWQ1LmNyZWF0ZUhhc2godm0uZW1haWwpLFxuICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkVNQUlMXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5jcmVhdGUobmV3VXNlcikudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTWFpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgVXNlclNlcnZpY2UsIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oXywgdXNlcikge1xuICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gdm0uY3VycmVudFVzZXIgPSB1c2VyO1xuXG4gICAgICAgICAgICB2YXIgcmV0dXJuVXJsID0gJGxvY2F0aW9uLnNlYXJjaCgpLnJldHVyblVybDtcbiAgICAgICAgICAgIGlmIChyZXR1cm5VcmwpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmV0dXJuIHVybDogJywgcmV0dXJuVXJsKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChyZXR1cm5VcmwpLnNlYXJjaCh7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblVybDogbnVsbFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHZtLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHZtLmN1cnJlbnRVc2VyLmxvZ2luVHlwZSA9PSBDT05TVEFOVFMuRkFDRUJPT0spIHtcbiAgICAgICAgICAgICAgICBGQi5sb2dvdXQoZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gbnVsbDtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgIH07XG5cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnRGlzaFNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCkge1xuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IG9iamVjdFxuICAgICAgICB2YXIgZGlzaEZhY3RvcnkgPSB7fTtcblxuICAgICAgICAvL2dldCBhbGwgZGlzaGVzXG4gICAgICAgIGRpc2hGYWN0b3J5LmFsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2NyZWF0ZSBhIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuY3JlYXRlID0gZnVuY3Rpb24oZGlzaCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvZGlzaGVzJywgZGlzaCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9nZXQgYSBzaW5nbGUgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5nZXQgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3VwZGF0ZSBhIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkudXBkYXRlID0gZnVuY3Rpb24oZGlzaF9pZCwgZGlzaCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQsIGRpc2gpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9kZWxldGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmRlbGV0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vYWRkIGEgY29tbWVudFxuICAgICAgICBkaXNoRmFjdG9yeS5hZGRDb21tZW50ID0gZnVuY3Rpb24oZGlzaF9pZCwgY29tbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkICsgJy9jb21tZW50cycsIGNvbW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaXNoRmFjdG9yeTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgJHJvb3RTY29wZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB1c2VyRmFjdG9yeSA9IHt9O1xuICAgICAgICAvL3NvY2lhbCBsb2dpblxuICAgICAgICB1c2VyRmFjdG9yeS5zb2NpYWxMb2dpbiA9IGZ1bmN0aW9uKHNvY2lhbFVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic29jaWFsVXNlcjogXCIsIHNvY2lhbFVzZXIpO1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnkuc2VhcmNoQnkoJ2VtYWlsPScgKyBzb2NpYWxVc2VyLmVtYWlsKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90IGZvdW5kLCB0aGVuIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuY3JlYXRlKHNvY2lhbFVzZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZm91bmQgdGhlIHVzZXIgd2l0aCBlbWFpbFxuICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSB0aGUgbGlua2VkIHNvY2lhbCBpZiBub3QgYWRkZWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBkYXRhLnVzZXJzWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5saW5rZWRTb2NpYWwuaW5kZXhPZihzb2NpYWxVc2VyLmxpbmtlZFNvY2lhbCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxpbmtlZFNvY2lhbC5wdXNoKHNvY2lhbFVzZXIubGlua2VkU29jaWFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIudXNlck5hbWUgPSBzb2NpYWxVc2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5waG90b1VybCA9IHNvY2lhbFVzZXIucGhvdG9Vcmw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS51cGRhdGUodXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgQ09OU1RBTlRTLlNPQ0lBTF9QQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dpbiA9IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9hdXRoJywge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9nb3V0IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgY3VycmVudCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9tZScpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9zZWFyY2ggdXNlciBieSBmaWVsZFxuICAgICAgICB1c2VyRmFjdG9yeS5zZWFyY2hCeSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzPycgKyBxdWVyeSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCB1c2VyIGJ5IGlkXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldEJ5SWQgPSBmdW5jdGlvbih1c2VyX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzLycgKyB1c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkuY3JlYXRlID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMvJywgdXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgdXNlci5wYXNzd29yZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkudXBkYXRlID0gZnVuY3Rpb24odXNlcl9pZCwgdXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCwgdXNlcikudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NvbGxlY3QgZGlzaCBhcyBmYXZvdXJpdGVcbiAgICAgICAgdXNlckZhY3RvcnkuY29sbGVjdCA9IGZ1bmN0aW9uKGRpc2hfaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvdXNlcnMvJyArICRyb290U2NvcGUudXNlci5faWQgKyAnL2Rpc2hlcy8nICsgZGlzaF9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmRpcmVjdGl2ZSgnY29udGVudGVkaXRhYmxlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0cywgbmdNb2RlbCkge1xuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwobmdNb2RlbC4kdmlld1ZhbHVlIHx8ICcnKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdibHVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShlbGVtZW50Lmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ2ZvY3VzT24nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGZvY3VzVmFsdWU6IFwiPWZvY3VzT25cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdmb2N1c1ZhbHVlJywgZnVuY3Rpb24oY3VycmVudFZhbHVlLCBwcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgJiYgIXByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50WzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==