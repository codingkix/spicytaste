angular.module("spicyTaste",["ngRoute"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/create",{templateUrl:"ng/views/pages/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"})}]),angular.module("spicyTaste").controller("DishListController",["DishService",function(e){var n=this;n.processing=!0,e.all().success(function(e){n.processing=!1,n.dishes=e}),n.deleteDish=function(t){n.processing=!0,e["delete"](t).success(function(){e.all().success(function(e){n.processing=!1,n.dishes=e})})}}]).controller("DishCreateController",["DishService",function(e){var n=this;n.type="create",n.save=function(){n.processing=!0,n.message="",e.create(n.dish).success(function(e){n.processing=!1,n.dish={},n.message=e.message})}}]).controller("DishEditController",["$routeParams","DishService",function(e,n){var t=this;t.type="edit",n.get(e.dish_id).success(function(e){t.dish=e}),t.save=function(){t.processing=!0,t.message="",n.update(e.dish_id,t.dish).success(function(e){t.processing=!1,t.dish={},t.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS",function(e,n,t,o){var i=this;i.email="",i.password="",i.showSignUpForm=!1,i.fbLogin=function(){FB.login(function(i){"connected"===i.status?FB.api("/me",function(i){n.socialLogin(i.email,o.FACEBOOK).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n),t.path("/")})}):"not_authorized"===i.status},{scope:"public_profile,email"})},i.login=function(){n.login(i.email,i.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n),t.path("/")})},i.signUp=function(){var s={email:i.email,password:i.password,social:o.EMAIL};n.create(s).then(function(n){e.$emit("login",n),t.path("/")})}}]),angular.module("spicyTaste").controller("MainController",["$scope","UserService","CONSTANTS",function(e,n,t){var o=this;e.$on("login",function(e,n){o.currentUser=n}),o.logout=function(){o.currentUser.loginType==t.FACEBOOK&&FB.logout(function(){}),o.currentUser=null,n.logout()}}]),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n}]),angular.module("spicyTaste").factory("UserService",["$http","CONSTANTS",function(e,n){var t={};return t.socialLogin=function(e,o){return t.getByEmail(e).then(function(i){if(console.log("getByEmail: ",i),i.success){var s=i.user;return s.linkedSocial.indexOf(o)<0?(s.linkedSocial.push(o),t.update(s).then(function(){return t.login(s.email,n.SOCIAL_PASS)})):t.login(s.email,n.SOCIAL_PASS)}var r={email:e,password:n.SOCIAL_PASS,social:o};return t.create(r)})},t.login=function(n,o){return e.post("/api/auth",{email:n,password:o}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,t.get()})},t.logout=function(){delete e.defaults.headers.common["X-Auth"]},t.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},t.getByEmail=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},t.create=function(n){return e.post("/api/users/",n).then(function(){return t.login(n.email,n.password)})},t.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwic2VydmljZXMvZGlzaFNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJGQl9BUFBfSUQiLCJGQUNFQk9PSyIsIkVNQUlMIiwiU09DSUFMX1BBU1MiLCJydW4iLCIkcm9vdFNjb3BlIiwiJHdpbmRvdyIsIlVzZXJTZXJ2aWNlIiwiQ09OU1RBTlRTIiwidXNlciIsImZiQXN5bmNJbml0IiwiRkIiLCJpbml0IiwiYXBwSWQiLCJjb29raWUiLCJ4ZmJtbCIsInZlcnNpb24iLCJkIiwicyIsImlkIiwianMiLCJmanMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEVsZW1lbnRCeUlkIiwiY3JlYXRlRWxlbWVudCIsInNyYyIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJkb2N1bWVudCIsImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHJvdXRlUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiRGlzaFNlcnZpY2UiLCJ2bSIsInRoaXMiLCJwcm9jZXNzaW5nIiwiYWxsIiwic3VjY2VzcyIsImRhdGEiLCJkaXNoZXMiLCJkZWxldGVEaXNoIiwidHlwZSIsInNhdmUiLCJtZXNzYWdlIiwiY3JlYXRlIiwiZGlzaCIsIiRyb3V0ZVBhcmFtcyIsImdldCIsImRpc2hfaWQiLCJ1cGRhdGUiLCIkc2NvcGUiLCIkbG9jYXRpb24iLCJlbWFpbCIsInBhc3N3b3JkIiwic2hvd1NpZ25VcEZvcm0iLCJmYkxvZ2luIiwibG9naW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImFwaSIsInNvY2lhbExvZ2luIiwidGhlbiIsImxvZ2luVHlwZSIsIiRlbWl0IiwicGF0aCIsInNjb3BlIiwic2lnblVwIiwibmV3VXNlciIsInNvY2lhbCIsIiRvbiIsIl8iLCJjdXJyZW50VXNlciIsImxvZ291dCIsImZhY3RvcnkiLCIkaHR0cCIsImRpc2hGYWN0b3J5IiwicG9zdCIsInB1dCIsInVzZXJGYWN0b3J5Iiwib3JpZ2luIiwiZ2V0QnlFbWFpbCIsImNvbnNvbGUiLCJsb2ciLCJsaW5rZWRTb2NpYWwiLCJpbmRleE9mIiwicHVzaCIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsInVzZXJfaWQiXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFBQyxPQUFBLGNBQUEsWUFDQUMsU0FBQSxhQUNBQyxVQUFBLGdCQUNBQyxTQUFBLEtBQ0FDLE1BQUEsUUFDQUMsWUFBQSxhQ0xBTixRQUFBQyxPQUFBLGNBQ0FNLEtBQUEsYUFBQSxVQUFBLGNBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxLQUFBLEtBRUFILEVBQUFJLFlBQUEsV0FDQUMsR0FBQUMsTUFDQUMsTUFBQUwsRUFBQVIsVUFDQWMsUUFBQSxFQUNBQyxPQUFBLEVBQ0FDLFFBQUEsVUFLQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEdBQUFDLEVBQUFKLEVBQUFLLHFCQUFBSixHQUFBLEVBQ0FELEdBQUFNLGVBQUFKLEtBQ0FDLEVBQUFILEVBQUFPLGNBQUFOLEdBQ0FFLEVBQUFELEdBQUFBLEVBQ0FDLEVBQUFLLElBQUEsc0NBQ0FKLEVBQUFLLFdBQUFDLGFBQUFQLEVBQUFDLEtBQ0FPLFNBQUEsU0FBQSxxQkNyQkEvQixRQUFBQyxPQUFBLGNBQ0ErQixRQUFBLG9CQUFBLGlCQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEVBQUFFLFdBQUEsR0FFQUQsRUFFQUUsS0FBQSxLQUNBQyxZQUFBLDJCQUNBQyxXQUFBLGlCQUNB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QWdGLEVBQUF0QixNQUFBcEQsRUFBQWdELE1BQUFqRCxFQUFBTCxhQWhCQSxHQUFBcUUsSUFDQWYsTUFBQUEsRUFDQUMsU0FBQWxELEVBQUFMLFlBQ0FzRSxPQUFBVyxFQUVBLE9BQUFELEdBQUFsQyxPQUFBdUIsTUFrQkFXLEVBQUF0QixNQUFBLFNBQUFKLEVBQUFDLEdBRUEsTUFBQXFCLEdBQUFFLEtBQUEsYUFDQXhCLE1BQUFBLEVBQ0FDLFNBQUFBLElBQ0FRLEtBQUEsU0FBQUosR0FHQSxNQUZBaUIsR0FBQVksU0FBQUMsUUFBQUMsT0FBQSxVQUFBL0IsRUFBQW5CLEtBRUF3QyxFQUFBL0IsU0FLQStCLEVBQUFOLE9BQUEsaUJBQ0FFLEdBQUFZLFNBQUFDLFFBQUFDLE9BQUEsV0FJQVYsRUFBQS9CLElBQUEsV0FDQSxNQUFBMkIsR0FBQTNCLElBQUEsaUJBQUFjLEtBQUEsU0FBQUosR0FDQSxNQUFBQSxHQUFBbkIsUUFLQXdDLEVBQUFFLFdBQUEsU0FBQTVCLEdBQ0EsTUFBQXNCLEdBQUEzQixJQUFBLGNBQUFLLEdBQUFTLEtBQUEsU0FBQUosR0FDQSxNQUFBQSxHQUFBbkIsUUFLQXdDLEVBQUFsQyxPQUFBLFNBQUF4QyxHQUNBLE1BQUFzRSxHQUFBRSxLQUFBLGNBQUF4RSxHQUFBeUQsS0FBQSxXQUNBLE1BQUFpQixHQUFBdEIsTUFBQXBELEVBQUFnRCxNQUFBaEQsRUFBQWlELGFBS0F5QixFQUFBN0IsT0FBQSxTQUFBd0MsRUFBQXJGLEdBQ0EsTUFBQXNFLEdBQUFHLElBQUEsY0FBQVksRUFBQXJGLEdBQUF5RCxLQUFBLFNBQUFKLEdBQ0EsTUFBQUEsR0FBQW5CLFFBSUF3QyIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScsIFsnbmdSb3V0ZSddKVxuICAgIC5jb25zdGFudCgnQ09OU1RBTlRTJywge1xuICAgICAgICBcIkZCX0FQUF9JRFwiOiAxNTYzNTY3Mzg3MjUzNDY4LFxuICAgICAgICBcIkZBQ0VCT09LXCI6IFwiRkJcIixcbiAgICAgICAgXCJFTUFJTFwiOiBcIkVNQUlMXCIsXG4gICAgICAgIFwiU09DSUFMX1BBU1NcIjogXCJQQVNTV09SRFwiXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCBVc2VyU2VydmljZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IG51bGw7XG5cbiAgICAgICAgJHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRkIuaW5pdCh7XG4gICAgICAgICAgICAgICAgYXBwSWQ6IENPTlNUQU5UUy5GQl9BUFBfSUQsXG4gICAgICAgICAgICAgICAgY29va2llOiB0cnVlLCAvLyBlbmFibGUgY29va2llcyB0byBhbGxvdyB0aGUgc2VydmVyIHRvIGFjY2VzcyB0aGUgc2Vzc2lvblxuICAgICAgICAgICAgICAgIHhmYm1sOiB0cnVlLCAvLyBwYXJzZSBzb2NpYWwgcGx1Z2lucyBvbiB0aGlzIHBhZ2VcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAndjIuMicgLy8gdXNlIHZlcnNpb24gMi4yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBMb2FkIHRoZSBTREsgYXN5bmNocm9ub3VzbHlcbiAgICAgICAgKGZ1bmN0aW9uKGQsIHMsIGlkKSB7XG4gICAgICAgICAgICB2YXIganMsIGZqcyA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUocylbMF07XG4gICAgICAgICAgICBpZiAoZC5nZXRFbGVtZW50QnlJZChpZCkpIHJldHVybjtcbiAgICAgICAgICAgIGpzID0gZC5jcmVhdGVFbGVtZW50KHMpO1xuICAgICAgICAgICAganMuaWQgPSBpZDtcbiAgICAgICAgICAgIGpzLnNyYyA9IFwiLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9zZGsuanNcIjtcbiAgICAgICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcbiAgICAgICAgfShkb2N1bWVudCwgJ3NjcmlwdCcsICdmYWNlYm9vay1qc3NkaycpKTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkcm91dGVQcm92aWRlcikge1xuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgLy9ob21lIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvaG9tZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2hvbWUnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9zaG93IGFsbCBkaXNoZXMgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2xpc3QuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hMaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaExpc3QnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9jcmVhdGUgYSBuZXcgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcy9jcmVhdGUnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaENyZWF0ZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9lZGl0IGEgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvc2luZ2xlLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRWRpdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9sb2dpbiB1c2VyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvdXNlci9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdsb2dpbidcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvLyAvL3NpZ251cCB1c2VyXG4gICAgICAgICAgICAvLyAud2hlbignL3NpZ251cCcsIHtcbiAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvc2lnbnVwLmh0bWwnLFxuICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6IFwiU2lnblVwQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXJBczogJ3NpZ251cCdcbiAgICAgICAgICAgIC8vIH0pXG5cblxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggbGlzdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hMaXN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgLy9zZXQgYSBwcm9jZXNzaW5nIHZhcmlhYmxlIHRvIHNob3cgbG9hZGluZ1xuICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAvL2dyYWIgYWxsIHRoZSBkaXNoZXMgYXQgcGFnZSBsb2FkXG4gICAgICAgIERpc2hTZXJ2aWNlLmFsbCgpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgLy93aGVuIGFsbCBkaXNoZXMgZmV0Y2hlZCwgcmVtb3ZlIHByb2Nlc3NpbmcgdmFyaWFibGVcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy9iaW5kIHRoZSBkaXNoZXNcbiAgICAgICAgICAgIHZtLmRpc2hlcyA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vZnVuY3Rpb24gdG8gZGVsZXRlIGEgZGlzaFxuICAgICAgICB2bS5kZWxldGVEaXNoID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5kZWxldGUoaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIERpc2hTZXJ2aWNlLmFsbCgpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZtLmRpc2hlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggY3JlYXRpb24gcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoQ3JlYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0udHlwZSA9IFwiY3JlYXRlXCI7XG5cbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmNyZWF0ZSh2bS5kaXNoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdm0uZGlzaCA9IHt9O1xuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggZWRpdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hFZGl0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRyb3V0ZVBhcmFtcywgRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS50eXBlID0gXCJlZGl0XCI7XG5cbiAgICAgICAgLy9nZXQgdGhlIGRpc2ggYnkgaWRcbiAgICAgICAgRGlzaFNlcnZpY2UuZ2V0KCRyb3V0ZVBhcmFtcy5kaXNoX2lkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHZtLmRpc2ggPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UudXBkYXRlKCRyb3V0ZVBhcmFtcy5kaXNoX2lkLCB2bS5kaXNoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB2bS5kaXNoID0ge307XG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSwgJGxvY2F0aW9uLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0uZW1haWwgPSBcIlwiO1xuICAgICAgICB2bS5wYXNzd29yZCA9IFwiXCI7XG4gICAgICAgIHZtLnNob3dTaWduVXBGb3JtID0gZmFsc2U7XG5cbiAgICAgICAgdm0uZmJMb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRkIubG9naW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnY29ubmVjdGVkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBMb2dnZWQgaW50byB5b3VyIGFwcCBhbmQgRmFjZWJvb2suXG4gICAgICAgICAgICAgICAgICAgIEZCLmFwaSgnL21lJywgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLnNvY2lhbExvZ2luKHJlc3BvbnNlLmVtYWlsLCBDT05TVEFOVFMuRkFDRUJPT0spLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkZBQ0VCT09LO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ25vdF9hdXRob3JpemVkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIGxvZ2dlZCBpbnRvIEZhY2Vib29rLCBidXQgbm90IHlvdXIgYXBwLlxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwZXJzb24gaXMgbm90IGxvZ2dlZCBpbnRvIEZhY2Vib29rLCBzbyB3ZSdyZSBub3Qgc3VyZSBpZlxuICAgICAgICAgICAgICAgICAgICAvLyB0aGV5IGFyZSBsb2dnZWQgaW50byB0aGlzIGFwcCBvciBub3QuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNjb3BlOiAncHVibGljX3Byb2ZpbGUsZW1haWwnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBVc2VyU2VydmljZS5sb2dpbih2bS5lbWFpbCwgdm0ucGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkVNQUlMO1xuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5zaWduVXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBuZXdVc2VyID0ge1xuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5lbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdm0ucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgc29jaWFsOiBDT05TVEFOVFMuRU1BSUxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmNyZWF0ZShuZXdVc2VyKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgJHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbihfLCB1c2VyKSB7XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICAgIH0pXG5cbiAgICAgICAgdm0ubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodm0uY3VycmVudFVzZXIubG9naW5UeXBlID09IENPTlNUQU5UUy5GQUNFQk9PSykge1xuICAgICAgICAgICAgICAgIEZCLmxvZ291dChmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgICAgICBVc2VyU2VydmljZS5sb2dvdXQoKTtcbiAgICAgICAgfTtcblxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5mYWN0b3J5KCdEaXNoU2VydmljZScsIGZ1bmN0aW9uKCRodHRwKSB7XG5cbiAgICAgICAgLy9jcmVhdGUgYSBuZXcgb2JqZWN0XG4gICAgICAgIHZhciBkaXNoRmFjdG9yeSA9IHt9O1xuXG4gICAgICAgIC8vZ2V0IGFsbCBkaXNoZXNcbiAgICAgICAgZGlzaEZhY3RvcnkuYWxsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2Rpc2hlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vY3JlYXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5jcmVhdGUgPSBmdW5jdGlvbihkaXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9kaXNoZXMnLCBkaXNoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2dldCBhIHNpbmdsZSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKGRpc2hfaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS51cGRhdGUgPSBmdW5jdGlvbihkaXNoX2lkLCBkaXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCwgZGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2RlbGV0ZSBhIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZGVsZXRlID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRpc2hGYWN0b3J5O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5mYWN0b3J5KCdVc2VyU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHVzZXJGYWN0b3J5ID0ge307XG4gICAgICAgIC8vc29jaWFsIGxvZ2luXG4gICAgICAgIHVzZXJGYWN0b3J5LnNvY2lhbExvZ2luID0gZnVuY3Rpb24oZW1haWwsIG9yaWdpbikge1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuZ2V0QnlFbWFpbChlbWFpbCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJnZXRCeUVtYWlsOiBcIiwgZGF0YSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL25vdCBmb3VuZCwgdGhlbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogQ09OU1RBTlRTLlNPQ0lBTF9QQVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgc29jaWFsOiBvcmlnaW5cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmNyZWF0ZShuZXdVc2VyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL2ZvdW5kIG9uZSB3aXRoIGVtYWlsXG4gICAgICAgICAgICAgICAgICAgIC8vdXBkYXRlIHRoZSBsaW5rZWQgc29jaWFsIGlmIG5vdCBhZGRlZFxuICAgICAgICAgICAgICAgICAgICB2YXIgdXNlciA9IGRhdGEudXNlcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIubGlua2VkU29jaWFsLmluZGV4T2Yob3JpZ2luKSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIubGlua2VkU29jaWFsLnB1c2gob3JpZ2luKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS51cGRhdGUodXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgQ09OU1RBTlRTLlNPQ0lBTF9QQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dpbiA9IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9hdXRoJywge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9nb3V0IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgY3VycmVudCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9tZScpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgdXNlciBieSBlbWFpbFxuICAgICAgICB1c2VyRmFjdG9yeS5nZXRCeUVtYWlsID0gZnVuY3Rpb24oZW1haWwpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvJyArIGVtYWlsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkuY3JlYXRlID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMvJywgdXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgdXNlci5wYXNzd29yZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkudXBkYXRlID0gZnVuY3Rpb24odXNlcl9pZCwgdXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCwgdXNlcikudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnk7XG4gICAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=