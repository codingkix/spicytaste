angular.module("spicyTaste",["ngRoute","angular-md5","ngMaterial","ngAnimate","ngMessages"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"P@ssw0rd",LOCAL_STORAGE_KEY:"spicyTasteUser",LATEST_COUNT:10}),angular.module("spicyTaste").config(["$mdThemingProvider","$mdIconProvider",function(e,t){var n=e.extendPalette("deep-orange",{500:"f27242"}),i=e.extendPalette("blue",{500:"6984b4",600:"6984b4"});e.definePalette("primaryOrange",n),e.definePalette("primaryBlue",i),e.theme("default").primaryPalette("primaryOrange").accentPalette("light-green"),e.theme("blue").primaryPalette("primaryBlue"),t.icon("menu","svg/ic_menu_24px.svg").icon("share","svg/ic_share_48px.svg").icon("login","svg/ic_account_circle_24px.svg").icon("recipes","svg/ic_event_note_48px.svg").icon("restaurants","svg/ic_restaurant_menu_48px.svg").icon("ingredients","svg/ic_receipt_48px.svg").icon("arrow","svg/ic_arrow_drop_up_48px.svg").icon("more","svg/ic_more_24px.svg").icon("time1","svg/ic_av_timer_24px.svg").icon("time2","svg/ic_access_time_24px.svg").icon("difficulty","svg/ic_track_changes_24px.svg").icon("exit","svg/ic_exit_to_app_48px.svg").icon("photo","svg/ic_mms_24px.svg").icon("check","svg/ic_check_circle_24px.svg").icon("facebook","svg/facebook.svg").icon("twitter","svg/twitter.svg").icon("pinterest","svg/pinterest.svg").icon("comments","svg/ic_chat_48px.svg").icon("menu","svg/ic_menu_48px.svg").icon("favorite","svg/ic_favorite_24px.svg").icon("delete","svg/ic_delete_48px.svg").icon("add","svg/ic_add_circle_outline_48px.svg")}]),angular.module("spicyTaste").run(["$rootScope","$location","$window","CONSTANTS","UserService",function(e,t,n,i,o){n.fbAsyncInit=function(){FB.init({appId:i.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,t,n){var i,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(i=e.createElement(t),i.id=n,i.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(i,o))}(document,"script","facebook-jssdk"),e.$on("$routeChangeStart",function(e,n){n.access&&o.authorize(n.access.requirePermissions).then(function(e){e||t.path("not-authorize").replace()})})}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,t){e.html5Mode(!0),t.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/all.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"dishDetail"}).when("/admin/dishes",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList",access:{requirePermissions:["Admin"]}}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage",access:{requirePermissions:["Admin"]}}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"}).when("/me",{templateUrl:"ng/views/pages/user/me.html",controller:"ProfileController",controllerAs:"me"}).when("/not-authorize",{templateUrl:"ng/views/pages/not-authorize.html"})}]),angular.module("spicyTaste").controller("DishListController",["DishService","SocialService","$location",function(e,t,n){var i=this;e.all().success(function(e){i.dishes=e}),i.deleteDish=function(t){var n=i.dishes[t];e["delete"](n._id).success(function(e){i.dishes.splice(t,1)})},i.addDish=function(){e.create({name:"new dish"}).success(function(e){n.path("/admin/dishes/"+e.dish._id)})},i.goToEdit=function(e){n.path("/admin/dishes/"+e)}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","$filter","$mdDialog","DishService","UserService","SocialService",function(e,t,n,i,o,s,r,c,l){function a(){h.dish={},h.relatedDishes={},r.get(i.dish_id).success(function(e){if(h.dish=e,h.dish.isCollected=!1,r.relate(h.dish._id,h.dish.tags,3).success(function(e){h.relatedDishes=e}),n.currentUser){var t=o("filter")(n.currentUser.favouriteDishes,{_id:h.dish._id},!0);t.length&&(h.dish.isCollected=!0)}})}function u(e,t,n){s.show({targetEvent:t,clickOutsideToClose:!0,templateUrl:"ng/views/dialogs/comment.html",locals:{title:e},controller:d,controllerAs:"comment"}).then(function(e){r.addComment(h.dish._id,{content:e,replyTo:n}).success(function(e){h.dish.comments.push(e)})})}function d(e,t){var n=this;n.content="",n.title=e,n.closeDialog=function(){t.cancel()},n.submit=function(){""==n.content.trim()?t.cancel():t.hide(n.content)}}var h=this;h.dish={},a(),h.enterFlipBook=function(e){s.show({targetEvent:e,clickOutsideToClose:!0,templateUrl:"ng/views/dialogs/flipbook.html",controller:"DishDetailController",controllerAs:"book"})["finally"](function(){n.shownBook=!1}),n.shownBook=!0},e.$on("onRepeatLast",function(e,t,n){angular.element(t).parents("#dishBook").booklet({width:"100%",height:600,closed:!0,autoCenter:!0,pageNumbers:!1,pagePadding:0,hoverWidth:100})}),h.closeDialog=function(){s.cancel()},h.fbShare=function(e){var n=t.absUrl()+"/"+e._id;l.fbShare(n)},h.reply=function(e,t){var n="@"+e.userName;u(n,t,e._id)},h.collect=function(t){n.currentUser?c.collect(h.dish._id).then(function(e){e.success&&(h.dish.isCollected=!0)}):e.showLoginDialog(t,!0,"Login/SignUp first to save as favorite").then(function(e){n.currentUser=e,c.collect(h.dish._id).then(function(e){e.success&&(h.dish.isCollected=!0)})})},h.showInstructionPhoto=function(e,t){null!=e&&""!=e.trim()&&s.show({targetEvent:t,clickOutsideToClose:!0,template:'<md-dialog><md-dialog-content><img src="{{photo}}"></md-dialog-content></md-dialog>',controller:["$scope",function(t){t.photo=e}]})},h.newComment=function(t){n.currentUser?u("Comment",t,null):e.showLoginDialog(t,!0,"Login/SignUp first to leave a comment").then(function(e){n.currentUser=e,u("Comment",t,null)})},d.$inject=["title","$mdDialog"]}]).controller("DishEditController",["$mdDialog","$routeParams","DishService","$location","$timeout",function(e,t,n,i,o){function s(e){var t=this;t.newPhoto="",t.closeDialog=function(){e.cancel()},t.submit=function(){e.hide(t.newPhoto)}}function r(e){var t=this;t.newInstruction={photo:"",text:""},t.closeDialog=function(){e.cancel()},t.submit=function(){e.hide(t.newInstruction)}}function c(){n.get(t.dish_id).success(function(e){l.dish=e}),l.difficulties=n.getDifficulties()}var l=this;c(),l.saveDish=function(){n.update(t.dish_id,l.dish).success(function(e){l.updateSuccess=!0,o(function(){l.updateSuccess=!1},1e3)})},l.removeInstruction=function(e){n.removeInstruction(t.dish_id,l.dish.instructions[e]._id).success(function(t){l.dish.instructions.splice(e,1)})},l.removePhoto=function(e){l.dish.photos.splice(e,1),l.saveDish()},l.showAddPhotoDialog=function(t){e.show({targetEvent:t,controller:s,controllerAs:"photoDlg",clickOutsideToClose:!0,templateUrl:"ng/views/dialogs/addPhoto.html"}).then(function(e){l.dish.photos.push(e),l.saveDish()})},l.showAddInstructionDialog=function(i){e.show({targetEvent:i,controller:r,controllerAs:"instructionDlg",clickOutsideToClose:!0,templateUrl:"ng/views/dialogs/addInstruction.html"}).then(function(e){l.dish.instructions.push(e),n.addInstruction(t.dish_id,e).success(function(e){})})},s.$inject=["$mdDialog"],r.$inject=["$mdDialog"]}]),angular.module("spicyTaste").controller("HomeController",["$scope","$mdMedia","DishService","CONSTANTS",function(e,t,n,i){function o(){r.recipeTiles=[],e.$watch(function(){return t("sm")},function(t){e.smallScreen=t}),s()}function s(){n.limit(i.LATEST_COUNT).success(function(e){angular.forEach(e,function(e,t){var n={image:e.imageUrl,title:e.name,id:e._id,prepTime:e.prepTime,totalTime:e.totalTime,difficulty:e.difficulty,tags:e.tags,span:{row:1,col:1}};switch(t+1){case 1:n.span.row=n.span.col=2;break;case 2:case 3:break;case 4:n.span.col=2;case 5:case 6:break;case 7:n.span.row=n.span.col=2;case 8:case 9:break;case 10:n.span.col=2}r.recipeTiles.push(n)})})}var r=this;o()}]),angular.module("spicyTaste").controller("MainController",["$rootScope","$scope","$location","$mdDialog","$http","SessionService","UserService","CONSTANTS",function(e,t,n,i,o,s,r,c){"use strict";function l(e,t,n,i){function r(e){var n=o.defaults.headers.common["X-Auth"];s.setLocal(c.LOCAL_STORAGE_KEY,n),t.hide(e)}var l=this;l.title=e,l.email="",l.password="",l.userName="",l.fbLogin=function(){FB.login(function(e){"connected"===e.status?FB.api("/me",function(e){var t={userName:e.name,email:e.email,password:c.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+e.id+"/picture?type=large",linkedSocial:c.FACEBOOK};n.socialLogin(t).then(function(e){e.loginType=c.FACEBOOK,r(e)})}):"not_authorized"===e.status},{scope:"public_profile,email"})},l.login=function(){n.login(l.email,l.password).then(function(e){e.loginType=c.EMAIL,r(e)})},l.signUp=function(){var e={userName:l.userName,email:l.email,password:l.password,photoUrl:"http://www.gravatar.com/avatar/"+i.createHash(l.email),linkedSocial:c.EMAIL};n.create(e).then(function(e){e.loginType=c.EMAIL,r(e)})}}function a(){u.showMobileMenu=!1,u.scrollTargetReached=!1;var t=s.getLocal(c.LOCAL_STORAGE_KEY);t&&(console.log("token",t),o.defaults.headers.common["X-Auth"]=t,r.getCurrentUser().then(function(t){e.currentUser=t}))}var u=this;a(),u.toggleMobileMenu=function(){u.showMobileMenu=!u.showMobileMenu},t.setScrollReached=function(e){console.log("setScrollReached called",e),u.scrollTargetReached=e},t.showLoginDialog=function(t,n,o){var s=i.show({clickOutsideToClose:!0,templateUrl:"ng/views/dialogs/login.html",targetEvent:t,controller:l,controllerAs:"login",locals:{dialogTitle:o}});return n?s:void s.then(function(t){e.currentUser=t})},l.$inject=["dialogTitle","$mdDialog","UserService","md5"]}]),angular.module("spicyTaste").controller("ProfileController",["$location","$rootScope","UserService",function(e,t,n){"use strict";function i(){o.user={},n.getById(t.currentUser._id).then(function(e){o.user=e})}var o=this;i(),o.logout=function(){n.logout(),t.currentUser=null,e.path("/")}}]),angular.module("spicyTaste").directive("contenteditable",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,i){i.$render=function(){t.html(i.$viewValue||"")},t.bind("blur",function(){e.$apply(function(){i.$setViewValue(t.html())})})}}}),angular.module("spicyTaste").directive("flipbook",function(){return{transclude:!1,restrict:"E",replace:!0,templateUrl:"ng/views/templates/flipbook.html",scope:{dish:"="}}}),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,t){e.$watch("focusValue",function(e,n){e&&!n&&t[0].focus()})}}}),angular.module("spicyTaste").directive("onLastRepeat",["$timeout",function(e){return function(t,n,i){t.$last&&e(function(){t.$emit("onRepeatLast",n,i)},0)}}]),angular.module("spicyTaste").directive("scrollReached",["$window",function(e){"use strict";return{restrict:"A",scope:!0,link:function(t,n,i){var o=n.offset().top-64;angular.element(e).on("scroll",function(){t.setScrollReached(this.pageYOffset>=o?!0:!1),t.$apply()})}}}]),angular.module("spicyTaste").directive("scrollTo",function(){return{restrict:"A",link:function(e,t,n){var i=$(n.scrollTo);t.on("click",function(){$("html, body").animate({scrollTop:i.offset().top},600)})}}}),angular.module("spicyTaste").factory("DishService",["$http",function(e){var t={};return t.all=function(){return e.get("/api/dishes")},t.limit=function(t){return e.get("/api/dishes?limit="+t)},t.relate=function(t,n,i){return e({method:"GET",url:"/api/dishes",params:{id:t,limit:i,"tags[]":n}})},t.create=function(t){return e.post("/api/dishes",t)},t.get=function(t){return e.get("/api/dishes/"+t)},t.update=function(t,n){return e.put("/api/dishes/"+t,n)},t["delete"]=function(t){return e["delete"]("/api/dishes/"+t)},t.addComment=function(t,n){return e.post("/api/dishes/"+t+"/comments",n)},t.addInstruction=function(t,n){return e.post("/api/dishes/"+t+"/instructions",n)},t.removeInstruction=function(t,n){return e["delete"]("/api/dishes/"+t+"/instructions/"+n)},t.getDifficulties=function(){return["初学","容易","一般","较难","专业"]},t}]),angular.module("spicyTaste").factory("SessionService",["$window",function(e){var t={};return t.getLocal=function(t){if(e.localStorage){var n=e.localStorage.getItem(t);return angular.fromJson(n)}return!1},t.setLocal=function(t,n){return e.localStorage&&e.localStorage.setItem(t,angular.toJson(n))},t}]),angular.module("spicyTaste").factory("SocialService",function(){var e={};return e.fbShare=function(e){FB.ui({method:"share",href:e},function(e){})},e}),angular.module("spicyTaste").factory("UserService",["$http","$rootScope","$window","CONSTANTS",function(e,t,n,i){"use strict";var o={};return o.socialLogin=function(e){return o.searchBy("email="+e.email).then(function(t){return t.success?o.login(e.email,i.SOCIAL_PASS):o.create(e)})},o.login=function(t,n){return e.post("/api/auth",{email:t,password:n}).then(function(t){return e.defaults.headers.common["X-Auth"]=t.data.token,o.getById(t.data.userId)})},o.logout=function(){delete e.defaults.headers.common["X-Auth"],n.localStorage.removeItem(i.LOCAL_STORAGE_KEY),o.loginedUser=null},o.searchBy=function(t){return e.get("/api/users?"+t).then(function(e){return e.data})},o.getCurrentUser=function(){return e.get("/api/me").then(function(e){return o.getById(e.data)})},o.getById=function(t){return e.get("/api/users/"+t).then(function(e){return e.data})},o.create=function(t){return e.post("/api/users/",t).then(function(){return o.login(t.email,t.password)})},o.update=function(t){return e.put("/api/users/"+t.user_id,t).then(function(e){return e.data})},o.collect=function(n){return e.put("/api/users/"+t.currentUser._id+"/dishes/"+n).then(function(e){return e.data})},o.authorize=function(e){return o.getCurrentUser().then(function(t){return t&&e.indexOf(t.role)>=0?!0:!1},function(e){return!1})},o}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImRlc2lnbi5qcyIsIm1vZHVsZS5ydW4uanMiLCJyb3V0ZXMuanMiLCJjb250cm9sbGVycy9kaXNoQ29udHJvbGxlci5qcyIsImFwcC5qcyIsImNvbnRyb2xsZXJzL2hvbWVDb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvbWFpbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9wcm9maWxlQ29udHJvbGxlci5qcyIsImRpcmVjdGl2ZXMvY29udGVudGVkaXRhYmxlRGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9mbGlwQm9va0RpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZm9jdXNPbkRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvb25MYXN0UmVwZWF0LmpzIiwiZGlyZWN0aXZlcy9zY3JvbGxSZWFjaGVkRGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9zY3JvbGxUb0RpcmVjdGl2ZS5qcyIsInNlcnZpY2VzL2Rpc2hTZXJ2aWNlLmpzIiwic2VydmljZXMvc2Vzc2lvblNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NpYWxTZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlclNlcnZpY2UuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiRkJfQVBQX0lEIiwiRkFDRUJPT0siLCJFTUFJTCIsIlNPQ0lBTF9QQVNTIiwiTE9DQUxfU1RPUkFHRV9LRVkiLCJMQVRFU1RfQ09VTlQiLCJjb25maWciLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkbWRJY29uUHJvdmlkZXIiLCJwcmltYXJ5T3JhbmdlIiwiZXh0ZW5kUGFsZXR0ZSIsIjUwMCIsInByaW1hcnlCbHVlIiwiNjAwIiwiZGVmaW5lUGFsZXR0ZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiaWNvbiIsInJ1biIsIiRyb290U2NvcGUiLCIkbG9jYXRpb24iLCIkd2luZG93IiwiQ09OU1RBTlRTIiwiVXNlclNlcnZpY2UiLCJmYkFzeW5jSW5pdCIsIkZCIiwiaW5pdCIsImFwcElkIiwiY29va2llIiwieGZibWwiLCJ2ZXJzaW9uIiwiZCIsInMiLCJpZCIsImpzIiwiZmpzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJnZXRFbGVtZW50QnlJZCIsImNyZWF0ZUVsZW1lbnQiLCJzcmMiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwiZG9jdW1lbnQiLCIkb24iLCJldmVudCIsIm5leHQiLCJhY2Nlc3MiLCJhdXRob3JpemUiLCJyZXF1aXJlUGVybWlzc2lvbnMiLCJ0aGVuIiwicmVzdWx0IiwicGF0aCIsInJlcGxhY2UiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRyb3V0ZVByb3ZpZGVyIiwiaHRtbDVNb2RlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsIkRpc2hTZXJ2aWNlIiwiU29jaWFsU2VydmljZSIsInZtIiwidGhpcyIsImFsbCIsInN1Y2Nlc3MiLCJkYXRhIiwiZGlzaGVzIiwiZGVsZXRlRGlzaCIsImluZGV4IiwiZGlzaCIsIl9pZCIsInNwbGljZSIsImFkZERpc2giLCJjcmVhdGUiLCJuYW1lIiwiZ29Ub0VkaXQiLCIkc2NvcGUiLCIkcm91dGVQYXJhbXMiLCIkZmlsdGVyIiwiJG1kRGlhbG9nIiwicmVsYXRlZERpc2hlcyIsImdldCIsImRpc2hfaWQiLCJpc0NvbGxlY3RlZCIsInJlbGF0ZSIsInRhZ3MiLCJjdXJyZW50VXNlciIsImZvdW5kIiwiZmF2b3VyaXRlRGlzaGVzIiwibGVuZ3RoIiwib3BlbkNvbW1lbnREaWFsb2ciLCJ0aXRsZSIsIiRldmVudCIsInJlcGx5VG8iLCJzaG93IiwidGFyZ2V0RXZlbnQiLCJjbGlja091dHNpZGVUb0Nsb3NlIiwibG9jYWxzIiwiY29tbWVudENvbnRyb2xsZXIiLCJjb250ZW50IiwiYWRkQ29tbWVudCIsImNvbW1lbnQiLCJjb21tZW50cyIsInB1c2giLCJkdm0iLCJjbG9zZURpYWxvZyIsImNhbmNlbCIsInN1Ym1pdCIsInRyaW0iLCJoaWRlIiwiZW50ZXJGbGlwQm9vayIsImV2biIsInNob3duQm9vayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwicGFyZW50cyIsImJvb2tsZXQiLCJ3aWR0aCIsImhlaWdodCIsImNsb3NlZCIsImF1dG9DZW50ZXIiLCJwYWdlTnVtYmVycyIsInBhZ2VQYWRkaW5nIiwiaG92ZXJXaWR0aCIsImZiU2hhcmUiLCJkaXNoTGluayIsImFic1VybCIsInJlcGx5IiwidXNlciIsImNvbW1lbnRUaXRsZSIsInVzZXJOYW1lIiwiY29sbGVjdCIsInNob3dMb2dpbkRpYWxvZyIsInNob3dJbnN0cnVjdGlvblBob3RvIiwicGhvdG9VcmwiLCJ0ZW1wbGF0ZSIsInBob3RvIiwibmV3Q29tbWVudCIsIiRpbmplY3QiLCIkdGltZW91dCIsInBob3RvRGlhbG9nQ29udHJvbGxlciIsIm5ld1Bob3RvIiwiaW5zdHJ1Y3Rpb25EaWFsb2dDb250cm9sbGVyIiwibmV3SW5zdHJ1Y3Rpb24iLCJ0ZXh0IiwiZGlmZmljdWx0aWVzIiwiZ2V0RGlmZmljdWx0aWVzIiwic2F2ZURpc2giLCJ1cGRhdGUiLCJ1cGRhdGVTdWNjZXNzIiwicmVtb3ZlSW5zdHJ1Y3Rpb24iLCJpbnN0cnVjdGlvbnMiLCJyZW1vdmVQaG90byIsInBob3RvcyIsInNob3dBZGRQaG90b0RpYWxvZyIsInNob3dBZGRJbnN0cnVjdGlvbkRpYWxvZyIsImFkZEluc3RydWN0aW9uIiwiJG1kTWVkaWEiLCJyZWNpcGVUaWxlcyIsIiR3YXRjaCIsImlzU21hbGwiLCJzbWFsbFNjcmVlbiIsImJ1aWxkR3JpZCIsImxpbWl0IiwiZm9yRWFjaCIsInRpbGUiLCJpbWFnZSIsImltYWdlVXJsIiwicHJlcFRpbWUiLCJ0b3RhbFRpbWUiLCJkaWZmaWN1bHR5Iiwic3BhbiIsInJvdyIsImNvbCIsIiRodHRwIiwiU2Vzc2lvblNlcnZpY2UiLCJsb2dpbkNvbnRyb2xsZXIiLCJkaWFsb2dUaXRsZSIsIm1kNSIsImFmdGVyQXV0aCIsInRva2VuIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwic2V0TG9jYWwiLCJlbWFpbCIsInBhc3N3b3JkIiwiZmJMb2dpbiIsImxvZ2luIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJhcGkiLCJmYlVzZXIiLCJsaW5rZWRTb2NpYWwiLCJzb2NpYWxMb2dpbiIsImxvZ2luVHlwZSIsInNpZ25VcCIsIm5ld1VzZXIiLCJjcmVhdGVIYXNoIiwic2hvd01vYmlsZU1lbnUiLCJzY3JvbGxUYXJnZXRSZWFjaGVkIiwibG9naW5lZFRva2VuIiwiZ2V0TG9jYWwiLCJjb25zb2xlIiwibG9nIiwiZ2V0Q3VycmVudFVzZXIiLCJ0b2dnbGVNb2JpbGVNZW51Iiwic2V0U2Nyb2xsUmVhY2hlZCIsImZsYWciLCJldiIsInBvc3RMb2dpbiIsInByb21pc2UiLCJnZXRCeUlkIiwibG9nb3V0IiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInJlc3RyaWN0IiwibGluayIsImF0dHJpYnV0cyIsIm5nTW9kZWwiLCIkcmVuZGVyIiwiaHRtbCIsIiR2aWV3VmFsdWUiLCJiaW5kIiwiJGFwcGx5IiwiJHNldFZpZXdWYWx1ZSIsInRyYW5zY2x1ZGUiLCJmb2N1c1ZhbHVlIiwiJGVsZW1lbnQiLCJjdXJyZW50VmFsdWUiLCJwcmV2aW91c1ZhbHVlIiwiZm9jdXMiLCIkYXR0cnMiLCIkbGFzdCIsIiRlbWl0Iiwib2Zmc2V0IiwidG9wIiwib24iLCJwYWdlWU9mZnNldCIsIiR0YXJnZXQiLCIkIiwic2Nyb2xsVG8iLCJhbmltYXRlIiwic2Nyb2xsVG9wIiwiZmFjdG9yeSIsImRpc2hGYWN0b3J5IiwibnVtIiwibWV0aG9kIiwidXJsIiwicGFyYW1zIiwidGFnc1tdIiwicG9zdCIsInB1dCIsImluc3RydWN0aW9uIiwiaW5zdHJ1Y3Rpb25faWQiLCJzZXNzaW9uRmFjdG9yeSIsImtleSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJmcm9tSnNvbiIsInNldEl0ZW0iLCJ0b0pzb24iLCJzb2NpYWxGYWN0b3J5IiwidWkiLCJocmVmIiwidXNlckZhY3RvcnkiLCJzb2NpYWxVc2VyIiwic2VhcmNoQnkiLCJ1c2VySWQiLCJyZW1vdmVJdGVtIiwibG9naW5lZFVzZXIiLCJxdWVyeSIsInVzZXJfaWQiLCJpbmRleE9mIiwicm9sZSJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQUFDLE9BQUEsY0FBQSxVQUFBLGNBQUEsYUFBQSxZQUFBLGVBQ0FDLFNBQUEsYUFDQUMsVUFBQSxnQkFDQUMsU0FBQSxLQUNBQyxNQUFBLFFBQ0FDLFlBQUEsV0FDQUMsa0JBQUEsaUJBQ0FDLGFBQUEsS0NQQVIsUUFBQUMsT0FBQSxjQUNBUSxRQUFBLHFCQUFBLGtCQUFBLFNBQUFDLEVBQUFDLEdBRUEsR0FBQUMsR0FBQUYsRUFBQUcsY0FBQSxlQUNBQyxJQUFBLFdBR0FDLEVBQUFMLEVBQUFHLGNBQUEsUUFDQUMsSUFBQSxTQUNBRSxJQUFBLFVBR0FOLEdBQUFPLGNBQUEsZ0JBQUFMLEdBQ0FGLEVBQUFPLGNBQUEsY0FBQUYsR0FFQUwsRUFBQVEsTUFBQSxXQUNBQyxlQUFBLGlCQUNBQyxjQUFBLGVBRUFWLEVBQUFRLE1BQUEsUUFDQUMsZUFBQSxlQUVBUixFQUFBVSxLQUFBLE9BQUEsd0JBQ0FBLEtBQUEsUUFBQSx5QkFDQUEsS0FBQSxRQUFBLGtDQUNBQSxLQUFBLFVBQUEsOEJBQ0FBLEtBQUEsY0FBQSxtQ0FDQUEsS0FBQSxjQUFBLDJCQUNBQSxLQUFBLFFBQUEsaUNBQ0FBLEtBQUEsT0FBQSx3QkFDQUEsS0FBQSxRQUFBLDRCQUNBQSxLQUFBLFFBQUEsK0JBQ0FBLEtBQUEsYUFBQSxpQ0FDQUEsS0FBQSxPQUFBLCtCQUNBQSxLQUFBLFFBQUEsdUJBQ0FBLEtBQUEsUUFBQSxnQ0FDQUEsS0FBQSxXQUFBLG9CQUNBQSxLQUFBLFVBQUEsbUJBQ0FBLEtBQUEsWUFBQSxxQkFDQUEsS0FBQSxXQUFBLHdCQUNBQSxLQUFBLE9BQUEsd0JBQ0FBLEtBQUEsV0FBQSw0QkFDQUEsS0FBQSxTQUFBLDBCQUNBQSxLQUFBLE1BQUEseUNDM0NBckIsUUFBQUMsT0FBQSxjQUNBcUIsS0FBQSxhQUFBLFlBQUEsVUFBQSxZ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OEUsSUFBQSxjQUFBM08sRUFBQW9FLFlBQUFoQixJQUFBLFdBQUFZLEdBQUFsQyxLQUFBLFNBQUE4SSxHQUNBLE1BQUFBLEdBQUE3SCxRQUtBeU0sRUFBQTVOLFVBQUEsU0FBQUMsR0FDQSxNQUFBMk4sR0FBQTVELGlCQUFBOUosS0FBQSxTQUFBaUYsR0FDQSxNQUFBQSxJQUFBbEYsRUFBQW1PLFFBQUFqSixFQUFBa0osT0FBQSxHQUNBLEdBRUEsR0FFQSxTQUFBckYsR0FDQSxPQUFBLEtBSUE0RSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScsIFsnbmdSb3V0ZScsICdhbmd1bGFyLW1kNScsICduZ01hdGVyaWFsJywgJ25nQW5pbWF0ZScsICduZ01lc3NhZ2VzJ10pXG4gICAgLmNvbnN0YW50KCdDT05TVEFOVFMnLCB7XG4gICAgICAgIFwiRkJfQVBQX0lEXCI6IDE1NjM1NjczODcyNTM0NjgsXG4gICAgICAgIFwiRkFDRUJPT0tcIjogXCJGQlwiLFxuICAgICAgICBcIkVNQUlMXCI6IFwiRU1BSUxcIixcbiAgICAgICAgXCJTT0NJQUxfUEFTU1wiOiBcIlBAc3N3MHJkXCIsXG4gICAgICAgIFwiTE9DQUxfU1RPUkFHRV9LRVlcIjogXCJzcGljeVRhc3RlVXNlclwiLFxuICAgICAgICBcIkxBVEVTVF9DT1VOVFwiOiAxMFxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJG1kVGhlbWluZ1Byb3ZpZGVyLCAkbWRJY29uUHJvdmlkZXIpIHtcblxuICAgICAgICB2YXIgcHJpbWFyeU9yYW5nZSA9ICRtZFRoZW1pbmdQcm92aWRlci5leHRlbmRQYWxldHRlKCdkZWVwLW9yYW5nZScsIHtcbiAgICAgICAgICAgICc1MDAnOiAnZjI3MjQyJ1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgcHJpbWFyeUJsdWUgPSAkbWRUaGVtaW5nUHJvdmlkZXIuZXh0ZW5kUGFsZXR0ZSgnYmx1ZScsIHtcbiAgICAgICAgICAgICc1MDAnOiAnNjk4NGI0JyxcbiAgICAgICAgICAgICc2MDAnOiAnNjk4NGI0J1xuICAgICAgICB9KTtcblxuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIuZGVmaW5lUGFsZXR0ZSgncHJpbWFyeU9yYW5nZScsIHByaW1hcnlPcmFuZ2UpO1xuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIuZGVmaW5lUGFsZXR0ZSgncHJpbWFyeUJsdWUnLCBwcmltYXJ5Qmx1ZSk7XG5cbiAgICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgICAgICAgIC5wcmltYXJ5UGFsZXR0ZSgncHJpbWFyeU9yYW5nZScpXG4gICAgICAgICAgICAuYWNjZW50UGFsZXR0ZSgnbGlnaHQtZ3JlZW4nKTtcblxuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2JsdWUnKVxuICAgICAgICAgICAgLnByaW1hcnlQYWxldHRlKCdwcmltYXJ5Qmx1ZScpO1xuXG4gICAgICAgICRtZEljb25Qcm92aWRlci5pY29uKCdtZW51JywgJ3N2Zy9pY19tZW51XzI0cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdzaGFyZScsICdzdmcvaWNfc2hhcmVfNDhweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2xvZ2luJywgJ3N2Zy9pY19hY2NvdW50X2NpcmNsZV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbigncmVjaXBlcycsICdzdmcvaWNfZXZlbnRfbm90ZV80OHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbigncmVzdGF1cmFudHMnLCAnc3ZnL2ljX3Jlc3RhdXJhbnRfbWVudV80OHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignaW5ncmVkaWVudHMnLCAnc3ZnL2ljX3JlY2VpcHRfNDhweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2Fycm93JywgJ3N2Zy9pY19hcnJvd19kcm9wX3VwXzQ4cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdtb3JlJywgJ3N2Zy9pY19tb3JlXzI0cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCd0aW1lMScsICdzdmcvaWNfYXZfdGltZXJfMjRweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ3RpbWUyJywgJ3N2Zy9pY19hY2Nlc3NfdGltZV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignZGlmZmljdWx0eScsICdzdmcvaWNfdHJhY2tfY2hhbmdlc18yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignZXhpdCcsICdzdmcvaWNfZXhpdF90b19hcHBfNDhweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ3Bob3RvJywgJ3N2Zy9pY19tbXNfMjRweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2NoZWNrJywgJ3N2Zy9pY19jaGVja19jaXJjbGVfMjRweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2ZhY2Vib29rJywgJ3N2Zy9mYWNlYm9vay5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ3R3aXR0ZXInLCAnc3ZnL3R3aXR0ZXIuc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdwaW50ZXJlc3QnLCAnc3ZnL3BpbnRlcmVzdC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2NvbW1lbnRzJywgJ3N2Zy9pY19jaGF0XzQ4cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdtZW51JywgJ3N2Zy9pY19tZW51XzQ4cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdmYXZvcml0ZScsICdzdmcvaWNfZmF2b3JpdGVfMjRweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ2RlbGV0ZScsICdzdmcvaWNfZGVsZXRlXzQ4cHguc3ZnJylcbiAgICAgICAgICAgIC5pY29uKCdhZGQnLCAnc3ZnL2ljX2FkZF9jaXJjbGVfb3V0bGluZV80OHB4LnN2ZycpO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkd2luZG93LCBDT05TVEFOVFMsIFVzZXJTZXJ2aWNlKSB7XG4gICAgICAgICR3aW5kb3cuZmJBc3luY0luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmluaXQoe1xuICAgICAgICAgICAgICAgIGFwcElkOiBDT05TVEFOVFMuRkJfQVBQX0lELFxuICAgICAgICAgICAgICAgIGNvb2tpZTogdHJ1ZSwgLy8gZW5hYmxlIGNvb2tpZXMgdG8gYWxsb3cgdGhlIHNlcnZlciB0byBhY2Nlc3MgdGhlIHNlc3Npb25cbiAgICAgICAgICAgICAgICB4ZmJtbDogdHJ1ZSwgLy8gcGFyc2Ugc29jaWFsIHBsdWdpbnMgb24gdGhpcyBwYWdlXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogJ3YyLjInIC8vIHVzZSB2ZXJzaW9uIDIuMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTG9hZCB0aGUgU0RLIGFzeW5jaHJvbm91c2x5XG4gICAgICAgIChmdW5jdGlvbihkLCBzLCBpZCkge1xuICAgICAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xuICAgICAgICAgICAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSByZXR1cm47XG4gICAgICAgICAgICBqcyA9IGQuY3JlYXRlRWxlbWVudChzKTtcbiAgICAgICAgICAgIGpzLmlkID0gaWQ7XG4gICAgICAgICAgICBqcy5zcmMgPSBcIi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvc2RrLmpzXCI7XG4gICAgICAgICAgICBmanMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoanMsIGZqcyk7XG4gICAgICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnKSk7XG5cbiAgICAgICAgLy9DaGVjayBBdXRob3JpemF0aW9uXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBuZXh0KXtcbiAgICAgICAgICAgIGlmKG5leHQuYWNjZXNzKXtcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5hdXRob3JpemUobmV4dC5hY2Nlc3MucmVxdWlyZVBlcm1pc3Npb25zKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFyZXN1bHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnbm90LWF1dGhvcml6ZScpLnJlcGxhY2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkcm91dGVQcm92aWRlcikge1xuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgLy9ob21lIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvaG9tZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2hvbWUnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9zaG93IGFsbCBkaXNoZXMgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2FsbC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaExpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTGlzdCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3Nob3cgZGlzaCBkZXRhaWwgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2RldGFpbC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaERldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hEZXRhaWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9saXN0IGFkbWluIGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL2xpc3QuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hMaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaExpc3QnLFxuICAgICAgICAgICAgICAgIGFjY2Vzczoge1xuICAgICAgICAgICAgICAgICAgICByZXF1aXJlUGVybWlzc2lvbnM6IFsnQWRtaW4nXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL2VkaXQgYSBkaXNoIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vZGlzaGVzLzpkaXNoX2lkJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hFZGl0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaE1hbmFnZScsXG4gICAgICAgICAgICAgICAgYWNjZXNzOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVQZXJtaXNzaW9uczogWydBZG1pbiddXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbG9naW4nXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy91c2VyIHByb2ZpbGVcbiAgICAgICAgICAgIC53aGVuKCcvbWUnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy91c2VyL21lLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQcm9maWxlQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbWUnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9ub3QtYXV0aG9yaXplJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvbm90LWF1dGhvcml6ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGxpc3QgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoTGlzdENvbnRyb2xsZXInLCBmdW5jdGlvbihEaXNoU2VydmljZSwgU29jaWFsU2VydmljZSwgJGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgLy9ncmFiIGFsbCB0aGUgZGlzaGVzIGF0IHBhZ2UgbG9hZFxuICAgICAgICBEaXNoU2VydmljZS5hbGwoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIC8vYmluZCB0aGUgZGlzaGVzXG4gICAgICAgICAgICB2bS5kaXNoZXMgPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL2Z1bmN0aW9uIHRvIGRlbGV0ZSBhIGRpc2hcbiAgICAgICAgdm0uZGVsZXRlRGlzaCA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgZGlzaCA9IHZtLmRpc2hlc1tpbmRleF07XG4gICAgICAgICAgICBEaXNoU2VydmljZS5kZWxldGUoZGlzaC5faWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmRpc2hlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkRGlzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRGlzaFNlcnZpY2UuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbmV3IGRpc2gnXG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2FkbWluL2Rpc2hlcy8nICsgZGF0YS5kaXNoLl9pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmdvVG9FZGl0ID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4vZGlzaGVzLycgKyBpZCk7XG4gICAgICAgIH1cblxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBkZXRhaWwgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoRGV0YWlsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRmaWx0ZXIsICRtZERpYWxvZywgRGlzaFNlcnZpY2UsIFVzZXJTZXJ2aWNlLCBTb2NpYWxTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmRpc2ggPSB7fTtcbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIHZtLmVudGVyRmxpcEJvb2sgPSBmdW5jdGlvbihldm4pIHtcbiAgICAgICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgICAgICB0YXJnZXRFdmVudDogZXZuLFxuICAgICAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9kaWFsb2dzL2ZsaXBib29rLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnYm9vaydcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zaG93bkJvb2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkcm9vdFNjb3BlLnNob3duQm9vayA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9jYWxsIGJvb2tsZXQgcGx1Z2luXG4gICAgICAgICRzY29wZS4kb24oJ29uUmVwZWF0TGFzdCcsIGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpLnBhcmVudHMoJyNkaXNoQm9vaycpLmJvb2tsZXQoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiA2MDAsXG4gICAgICAgICAgICAgICAgY2xvc2VkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF1dG9DZW50ZXI6IHRydWUsXG4gICAgICAgICAgICAgICAgcGFnZU51bWJlcnM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBhZ2VQYWRkaW5nOiAwLFxuICAgICAgICAgICAgICAgIGhvdmVyV2lkdGg6IDEwMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLmNsb3NlRGlhbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuY2FuY2VsKCk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5mYlNoYXJlID0gZnVuY3Rpb24oZGlzaCkge1xuICAgICAgICAgICAgdmFyIGRpc2hMaW5rID0gJGxvY2F0aW9uLmFic1VybCgpICsgJy8nICsgZGlzaC5faWQ7XG4gICAgICAgICAgICBTb2NpYWxTZXJ2aWNlLmZiU2hhcmUoZGlzaExpbmspO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVwbHkgPSBmdW5jdGlvbih1c2VyLCAkZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBjb21tZW50VGl0bGUgPSAnQCcgKyB1c2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgb3BlbkNvbW1lbnREaWFsb2coY29tbWVudFRpdGxlLCAkZXZlbnQsIHVzZXIuX2lkKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jb2xsZWN0ID0gZnVuY3Rpb24oJGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUuY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0xvZ2luRGlhbG9nKCRldmVudCwgdHJ1ZSwgJ0xvZ2luL1NpZ25VcCBmaXJzdCB0byBzYXZlIGFzIGZhdm9yaXRlJykudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuXG4gICAgICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmNvbGxlY3Qodm0uZGlzaC5faWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmRpc2guaXNDb2xsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5jb2xsZWN0KHZtLmRpc2guX2lkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZGlzaC5pc0NvbGxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNob3dJbnN0cnVjdGlvblBob3RvID0gZnVuY3Rpb24ocGhvdG9VcmwsICRldmVudCkge1xuICAgICAgICAgICAgaWYgKHBob3RvVXJsID09IG51bGwgfHwgcGhvdG9VcmwudHJpbSgpID09ICcnKVxuICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgICAgIHRhcmdldEV2ZW50OiAkZXZlbnQsXG4gICAgICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJzxtZC1kaWFsb2c+JyArXG4gICAgICAgICAgICAgICAgICAgICc8bWQtZGlhbG9nLWNvbnRlbnQ+PGltZyBzcmM9XCJ7e3Bob3RvfX1cIj48L21kLWRpYWxvZy1jb250ZW50PicgK1xuICAgICAgICAgICAgICAgICAgICAnPC9tZC1kaWFsb2c+JyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiBEaWFsb2dDdHIoJHNjb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5waG90byA9IHBob3RvVXJsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ubmV3Q29tbWVudCA9IGZ1bmN0aW9uKCRldmVudCkge1xuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dMb2dpbkRpYWxvZygkZXZlbnQsIHRydWUsICdMb2dpbi9TaWduVXAgZmlyc3QgdG8gbGVhdmUgYSBjb21tZW50JykudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICAgICAgICAgICAgICBvcGVuQ29tbWVudERpYWxvZygnQ29tbWVudCcsICRldmVudCwgbnVsbCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3BlbkNvbW1lbnREaWFsb2coJ0NvbW1lbnQnLCAkZXZlbnQsIG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHZtLmRpc2ggPSB7fTtcbiAgICAgICAgICAgIHZtLnJlbGF0ZWREaXNoZXMgPSB7fTtcblxuICAgICAgICAgICAgLy9nZXQgdGhlIGRpc2ggYnkgaWRcbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmdldCgkcm91dGVQYXJhbXMuZGlzaF9pZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0uZGlzaC5pc0NvbGxlY3RlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIDMgcmVsYXRlZCBkaXNoZXNcbiAgICAgICAgICAgICAgICBEaXNoU2VydmljZS5yZWxhdGUodm0uZGlzaC5faWQsIHZtLmRpc2gudGFncywgMykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlbGF0ZWREaXNoZXMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICBpZiAoJHJvb3RTY29wZS5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSAkZmlsdGVyKCdmaWx0ZXInKSgkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLmZhdm91cml0ZURpc2hlcywge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2lkOiB2bS5kaXNoLl9pZFxuICAgICAgICAgICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5kaXNoLmlzQ29sbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuQ29tbWVudERpYWxvZyh0aXRsZSwgJGV2ZW50LCByZXBseVRvKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6ICRldmVudCxcbiAgICAgICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvZGlhbG9ncy9jb21tZW50Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGxvY2Fsczoge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNvbW1lbnRDb250cm9sbGVyLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2NvbW1lbnQnXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICBEaXNoU2VydmljZS5hZGRDb21tZW50KHZtLmRpc2guX2lkLCB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgIHJlcGx5VG86IHJlcGx5VG9cbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaC5jb21tZW50cy5wdXNoKGNvbW1lbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjb21tZW50Q29udHJvbGxlcih0aXRsZSwgJG1kRGlhbG9nKSB7XG4gICAgICAgICAgICB2YXIgZHZtID0gdGhpcztcbiAgICAgICAgICAgIGR2bS5jb250ZW50ID0gJyc7XG4gICAgICAgICAgICBkdm0udGl0bGUgPSB0aXRsZTtcblxuICAgICAgICAgICAgZHZtLmNsb3NlRGlhbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmNhbmNlbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkdm0uc3VibWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGR2bS5jb250ZW50LnRyaW0oKSA9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgJG1kRGlhbG9nLmNhbmNlbCgpXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZShkdm0uY29udGVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggZWRpdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hFZGl0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRtZERpYWxvZywgJHJvdXRlUGFyYW1zLCBEaXNoU2VydmljZSwgJGxvY2F0aW9uLCAkdGltZW91dCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgdm0uc2F2ZURpc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLnVwZGF0ZSgkcm91dGVQYXJhbXMuZGlzaF9pZCwgdm0uZGlzaCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlU3VjY2VzcyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlU3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnJlbW92ZUluc3RydWN0aW9uID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLnJlbW92ZUluc3RydWN0aW9uKCRyb3V0ZVBhcmFtcy5kaXNoX2lkLCB2bS5kaXNoLmluc3RydWN0aW9uc1tpbmRleF0uX2lkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNoLmluc3RydWN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5yZW1vdmVQaG90byA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICB2bS5kaXNoLnBob3Rvcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdm0uc2F2ZURpc2goKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNob3dBZGRQaG90b0RpYWxvZyA9IGZ1bmN0aW9uKGV2bikge1xuICAgICAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgICAgIHRhcmdldEV2ZW50OiBldm4sXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogcGhvdG9EaWFsb2dDb250cm9sbGVyLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3Bob3RvRGxnJyxcbiAgICAgICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvZGlhbG9ncy9hZGRQaG90by5odG1sJ1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihuZXdQaG90bykge1xuICAgICAgICAgICAgICAgIHZtLmRpc2gucGhvdG9zLnB1c2gobmV3UGhvdG8pO1xuICAgICAgICAgICAgICAgIHZtLnNhdmVEaXNoKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNob3dBZGRJbnN0cnVjdGlvbkRpYWxvZyA9IGZ1bmN0aW9uKGV2bikge1xuICAgICAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgICAgIHRhcmdldEV2ZW50OiBldm4sXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogaW5zdHJ1Y3Rpb25EaWFsb2dDb250cm9sbGVyLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2luc3RydWN0aW9uRGxnJyxcbiAgICAgICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvZGlhbG9ncy9hZGRJbnN0cnVjdGlvbi5odG1sJ1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihuZXdJbnN0cnVjdGlvbikge1xuICAgICAgICAgICAgICAgIHZtLmRpc2guaW5zdHJ1Y3Rpb25zLnB1c2gobmV3SW5zdHJ1Y3Rpb24pO1xuICAgICAgICAgICAgICAgIERpc2hTZXJ2aWNlLmFkZEluc3RydWN0aW9uKCRyb3V0ZVBhcmFtcy5kaXNoX2lkLCBuZXdJbnN0cnVjdGlvbikuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcGhvdG9EaWFsb2dDb250cm9sbGVyKCRtZERpYWxvZykge1xuICAgICAgICAgICAgdmFyIGR2bSA9IHRoaXM7XG4gICAgICAgICAgICBkdm0ubmV3UGhvdG8gPSAnJztcblxuICAgICAgICAgICAgZHZtLmNsb3NlRGlhbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmNhbmNlbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkdm0uc3VibWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUoZHZtLm5ld1Bob3RvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluc3RydWN0aW9uRGlhbG9nQ29udHJvbGxlcigkbWREaWFsb2cpIHtcbiAgICAgICAgICAgIHZhciBkdm0gPSB0aGlzO1xuXG4gICAgICAgICAgICBkdm0ubmV3SW5zdHJ1Y3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgcGhvdG86ICcnLFxuICAgICAgICAgICAgICAgIHRleHQ6ICcnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBkdm0uY2xvc2VEaWFsb2cgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkbWREaWFsb2cuY2FuY2VsKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGR2bS5zdWJtaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZShkdm0ubmV3SW5zdHJ1Y3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBkaXNoIGJ5IGlkXG4gICAgICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmRpc2ggPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5kaWZmaWN1bHRpZXMgPSBEaXNoU2VydmljZS5nZXREaWZmaWN1bHRpZXMoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuIixudWxsLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbWRNZWRpYSwgRGlzaFNlcnZpY2UsIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHZtLnJlY2lwZVRpbGVzID0gW107XG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkbWRNZWRpYSgnc20nKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGlzU21hbGwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc21hbGxTY3JlZW4gPSBpc1NtYWxsO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGJ1aWxkR3JpZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYnVpbGRHcmlkKCkge1xuICAgICAgICAgICAgRGlzaFNlcnZpY2UubGltaXQoQ09OU1RBTlRTLkxBVEVTVF9DT1VOVCkuc3VjY2VzcyhmdW5jdGlvbihkaXNoZXMpIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGlzaGVzLCBmdW5jdGlvbihkaXNoLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGlsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiBkaXNoLmltYWdlVXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGRpc2gubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkaXNoLl9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXBUaW1lOiBkaXNoLnByZXBUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxUaW1lOiBkaXNoLnRvdGFsVGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IGRpc2guZGlmZmljdWx0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3M6IGRpc2gudGFncyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwYW46IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3c6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiAxXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWxlLnNwYW4ucm93ID0gdGlsZS5zcGFuLmNvbCA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5zcGFuLmNvbCA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5zcGFuLnJvdyA9IHRpbGUuc3Bhbi5jb2wgPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWxlLnNwYW4uY29sID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZtLnJlY2lwZVRpbGVzLnB1c2godGlsZSk7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTWFpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJG1kRGlhbG9nLCAkaHR0cCwgU2Vzc2lvblNlcnZpY2UsIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgdm0udG9nZ2xlTW9iaWxlTWVudSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0uc2hvd01vYmlsZU1lbnUgPSAhdm0uc2hvd01vYmlsZU1lbnU7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnNldFNjcm9sbFJlYWNoZWQgPSBmdW5jdGlvbihmbGFnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2V0U2Nyb2xsUmVhY2hlZCBjYWxsZWQnLCBmbGFnKTtcbiAgICAgICAgICAgIHZtLnNjcm9sbFRhcmdldFJlYWNoZWQgPSBmbGFnO1xuICAgICAgICB9XG5cbiAgICAgICAgJHNjb3BlLnNob3dMb2dpbkRpYWxvZyA9IGZ1bmN0aW9uKGV2LCBwb3N0TG9naW4sIHRpdGxlKSB7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9ICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvZGlhbG9ncy9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogbG9naW5Db250cm9sbGVyLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2xvZ2luJyxcbiAgICAgICAgICAgICAgICBsb2NhbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nVGl0bGU6IHRpdGxlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAocG9zdExvZ2luKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiAodXNlci5yb2xlICYmIHVzZXIucm9sZSA9PSBcIkFkbWluXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4vZGlzaGVzJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gbG9naW5Db250cm9sbGVyKGRpYWxvZ1RpdGxlLCAkbWREaWFsb2csIFVzZXJTZXJ2aWNlLCBtZDUpIHtcbiAgICAgICAgICAgIHZhciBkdm0gPSB0aGlzO1xuICAgICAgICAgICAgZHZtLnRpdGxlID0gZGlhbG9nVGl0bGU7XG4gICAgICAgICAgICBkdm0uZW1haWwgPSAnJztcbiAgICAgICAgICAgIGR2bS5wYXNzd29yZCA9ICcnO1xuICAgICAgICAgICAgZHZtLnVzZXJOYW1lID0gJyc7XG5cbiAgICAgICAgICAgIGR2bS5mYkxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgRkIubG9naW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvZ2dlZCBpbnRvIHlvdXIgYXBwIGFuZCBGYWNlYm9vay5cbiAgICAgICAgICAgICAgICAgICAgICAgIEZCLmFwaSgnL21lJywgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmJVc2VyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogcmVzcG9uc2UubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IHJlc3BvbnNlLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogQ09OU1RBTlRTLlNPQ0lBTF9QQVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG90b1VybDogJ2h0dHA6Ly9ncmFwaC5mYWNlYm9vay5jb20vJyArIHJlc3BvbnNlLmlkICsgJy9waWN0dXJlP3R5cGU9bGFyZ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rZWRTb2NpYWw6IENPTlNUQU5UUy5GQUNFQk9PS1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5zb2NpYWxMb2dpbihmYlVzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxvZ2luVHlwZSA9IENPTlNUQU5UUy5GQUNFQk9PSztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJBdXRoKHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdub3RfYXV0aG9yaXplZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwZXJzb24gaXMgbG9nZ2VkIGludG8gRmFjZWJvb2ssIGJ1dCBub3QgeW91ciBhcHAuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIG5vdCBsb2dnZWQgaW50byBGYWNlYm9vaywgc28gd2UncmUgbm90IHN1cmUgaWZcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZXkgYXJlIGxvZ2dlZCBpbnRvIHRoaXMgYXBwIG9yIG5vdC5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICdwdWJsaWNfcHJvZmlsZSxlbWFpbCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGR2bS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ2luKGR2bS5lbWFpbCwgZHZtLnBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRU1BSUw7XG4gICAgICAgICAgICAgICAgICAgIGFmdGVyQXV0aCh1c2VyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGR2bS5zaWduVXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3VXNlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IGR2bS51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IGR2bS5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IGR2bS5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgcGhvdG9Vcmw6ICdodHRwOi8vd3d3LmdyYXZhdGFyLmNvbS9hdmF0YXIvJyArIG1kNS5jcmVhdGVIYXNoKGR2bS5lbWFpbCksXG4gICAgICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkVNQUlMXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmNyZWF0ZShuZXdVc2VyKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRU1BSUw7XG4gICAgICAgICAgICAgICAgICAgIGFmdGVyQXV0aCh1c2VyKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gYWZ0ZXJBdXRoKHVzZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ107XG4gICAgICAgICAgICAgICAgU2Vzc2lvblNlcnZpY2Uuc2V0TG9jYWwoQ09OU1RBTlRTLkxPQ0FMX1NUT1JBR0VfS0VZLCB0b2tlbik7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUodXNlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgdm0uc2hvd01vYmlsZU1lbnUgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLnNjcm9sbFRhcmdldFJlYWNoZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgdmFyIGxvZ2luZWRUb2tlbiA9IFNlc3Npb25TZXJ2aWNlLmdldExvY2FsKENPTlNUQU5UUy5MT0NBTF9TVE9SQUdFX0tFWSk7XG4gICAgICAgICAgICBpZiAobG9naW5lZFRva2VuKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Rva2VuJywgbG9naW5lZFRva2VuKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IGxvZ2luZWRUb2tlbjtcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5nZXRDdXJyZW50VXNlcigpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCBVc2VyU2VydmljZSkge1xuICAgICAgICAndXNlIHN0cmljdCc7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIHZtLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgVXNlclNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHZtLnVzZXIgPSB7fTtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmdldEJ5SWQoJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIHZtLnVzZXIgPSB1c2VyO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ2NvbnRlbnRlZGl0YWJsZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRyaWJ1dHMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiRyZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKG5nTW9kZWwuJHZpZXdWYWx1ZSB8fCAnJyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoZWxlbWVudC5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZGlyZWN0aXZlKCdmbGlwYm9vaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvdGVtcGxhdGVzL2ZsaXBib29rLmh0bWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkaXNoOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmRpcmVjdGl2ZSgnZm9jdXNPbicsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZm9jdXNWYWx1ZTogXCI9Zm9jdXNPblwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2ZvY3VzVmFsdWUnLCBmdW5jdGlvbihjdXJyZW50VmFsdWUsIHByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSAmJiAhcHJldmlvdXNWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnRbMF0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ29uTGFzdFJlcGVhdCcsIGZ1bmN0aW9uKCR0aW1lb3V0KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJGxhc3QpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdvblJlcGVhdExhc3QnLCAkZWxlbWVudCwgJGF0dHJzKTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ3Njcm9sbFJlYWNoZWQnLCBmdW5jdGlvbigkd2luZG93KSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZTogdHJ1ZSxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCAkZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gJGVsZW1lbnQub2Zmc2V0KCkudG9wIC0gNjQ7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGFnZVlPZmZzZXQgPj0gb2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zZXRTY3JvbGxSZWFjaGVkKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2V0U2Nyb2xsUmVhY2hlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmRpcmVjdGl2ZSgnc2Nyb2xsVG8nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgJGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgdmFyICR0YXJnZXQgPSAkKGF0dHJzLnNjcm9sbFRvKTtcbiAgICAgICAgICAgICAgICAkZWxlbWVudC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkdGFyZ2V0Lm9mZnNldCgpLnRvcFxuICAgICAgICAgICAgICAgICAgICB9LCA2MDApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5mYWN0b3J5KCdEaXNoU2VydmljZScsIGZ1bmN0aW9uKCRodHRwKSB7XG5cbiAgICAgICAgLy9jcmVhdGUgYSBuZXcgb2JqZWN0XG4gICAgICAgIHZhciBkaXNoRmFjdG9yeSA9IHt9O1xuXG4gICAgICAgIC8vZ2V0IGFsbCBkaXNoZXNcbiAgICAgICAgZGlzaEZhY3RvcnkuYWxsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2Rpc2hlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vZ2V0IGxpbWl0ZWQgbGF0ZXN0IGRpc2hlc1xuICAgICAgICBkaXNoRmFjdG9yeS5saW1pdCA9IGZ1bmN0aW9uKG51bSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXM/bGltaXQ9JyArIG51bSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCByZWxhdGVkIGRpc2hlcyBieSB0YWdzXG4gICAgICAgIGRpc2hGYWN0b3J5LnJlbGF0ZSA9IGZ1bmN0aW9uKGlkLCB0YWdzLCBudW0pIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvYXBpL2Rpc2hlcycsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgbGltaXQ6IG51bSxcbiAgICAgICAgICAgICAgICAgICAgJ3RhZ3NbXSc6IHRhZ3NcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3JlYXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5jcmVhdGUgPSBmdW5jdGlvbihkaXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9kaXNoZXMnLCBkaXNoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2dldCBhIHNpbmdsZSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKGRpc2hfaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS51cGRhdGUgPSBmdW5jdGlvbihkaXNoX2lkLCBkaXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCwgZGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2RlbGV0ZSBhIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZGVsZXRlID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9hZGQgYSBjb21tZW50XG4gICAgICAgIGRpc2hGYWN0b3J5LmFkZENvbW1lbnQgPSBmdW5jdGlvbihkaXNoX2lkLCBjb21tZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQgKyAnL2NvbW1lbnRzJywgY29tbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2FkZCBhIGluc3RydWN0aW9uXG4gICAgICAgIGRpc2hGYWN0b3J5LmFkZEluc3RydWN0aW9uID0gZnVuY3Rpb24oZGlzaF9pZCwgaW5zdHJ1Y3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCArICcvaW5zdHJ1Y3Rpb25zJywgaW5zdHJ1Y3Rpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9yZW1vdmUgYW4gaW5zdHJ1Y3Rpb25cbiAgICAgICAgZGlzaEZhY3RvcnkucmVtb3ZlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbihkaXNoX2lkLCBpbnN0cnVjdGlvbl9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQgKyAnL2luc3RydWN0aW9ucy8nICsgaW5zdHJ1Y3Rpb25faWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgZGlmZmljdWx0eVxuICAgICAgICBkaXNoRmFjdG9yeS5nZXREaWZmaWN1bHRpZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBbJ+WIneWtpicsICflrrnmmJMnLCAn5LiA6IisJywgJ+i+g+mavicsICfkuJPkuJonXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlzaEZhY3Rvcnk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ1Nlc3Npb25TZXJ2aWNlJywgZnVuY3Rpb24oJHdpbmRvdykge1xuICAgICAgICB2YXIgc2Vzc2lvbkZhY3RvcnkgPSB7fTtcblxuICAgICAgICBzZXNzaW9uRmFjdG9yeS5nZXRMb2NhbCA9IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgaWYgKCR3aW5kb3cubG9jYWxTdG9yYWdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5mcm9tSnNvbihkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlc3Npb25GYWN0b3J5LnNldExvY2FsID0gZnVuY3Rpb24oa2V5LCBkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIGFuZ3VsYXIudG9Kc29uKGRhdGEpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZXNzaW9uRmFjdG9yeTtcblxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5mYWN0b3J5KCdTb2NpYWxTZXJ2aWNlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzb2NpYWxGYWN0b3J5ID0ge307XG5cbiAgICAgICAgc29jaWFsRmFjdG9yeS5mYlNoYXJlID0gZnVuY3Rpb24obGluaykge1xuICAgICAgICAgICAgRkIudWkoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3NoYXJlJyxcbiAgICAgICAgICAgICAgICBocmVmOiBsaW5rLFxuICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHt9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzb2NpYWxGYWN0b3J5O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5mYWN0b3J5KCdVc2VyU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCAkcm9vdFNjb3BlLCAkd2luZG93LCBDT05TVEFOVFMpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgICAgIHZhciB1c2VyRmFjdG9yeSA9IHt9O1xuXG4gICAgICAgIC8vc29jaWFsIGxvZ2luXG4gICAgICAgIHVzZXJGYWN0b3J5LnNvY2lhbExvZ2luID0gZnVuY3Rpb24oc29jaWFsVXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LnNlYXJjaEJ5KCdlbWFpbD0nICsgc29jaWFsVXNlci5lbWFpbCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL25vdCBmb3VuZCwgdGhlbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmNyZWF0ZShzb2NpYWxVc2VyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL2ZvdW5kIHRoZSB1c2VyIHdpdGggZW1haWxcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHNvY2lhbFVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9sb2dpbiB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmxvZ2luID0gZnVuY3Rpb24oZW1haWwsIHBhc3N3b3JkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2F1dGgnLCB7XG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHJlc3BvbnNlLmRhdGEudG9rZW47XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldEJ5SWQocmVzcG9uc2UuZGF0YS51c2VySWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9sb2dvdXQgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRlbGV0ZSAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ107XG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENPTlNUQU5UUy5MT0NBTF9TVE9SQUdFX0tFWSk7XG4gICAgICAgICAgICB1c2VyRmFjdG9yeS5sb2dpbmVkVXNlciA9IG51bGw7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9zZWFyY2ggdXNlciBieSBmaWVsZFxuICAgICAgICB1c2VyRmFjdG9yeS5zZWFyY2hCeSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzPycgKyBxdWVyeSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdXNlckZhY3RvcnkuZ2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvbWUnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldEJ5SWQocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2dldCB1c2VyIGJ5IGlkXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldEJ5SWQgPSBmdW5jdGlvbih1c2VyX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzLycgKyB1c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzLycsIHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIHVzZXIucGFzc3dvcmQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy91cGRhdGUgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS51cGRhdGUgPSBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL3VzZXJzLycgKyB1c2VyLnVzZXJfaWQsIHVzZXIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vY29sbGVjdCBkaXNoIGFzIGZhdm91cml0ZVxuICAgICAgICB1c2VyRmFjdG9yeS5jb2xsZWN0ID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS91c2Vycy8nICsgJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQgKyAnL2Rpc2hlcy8nICsgZGlzaF9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9hdXRob3JpemUgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5hdXRob3JpemUgPSBmdW5jdGlvbihyZXF1aXJlUGVybWlzc2lvbnMpIHtcbiAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5nZXRDdXJyZW50VXNlcigpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIGlmICh1c2VyICYmIHJlcXVpcmVQZXJtaXNzaW9ucy5pbmRleE9mKHVzZXIucm9sZSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnk7XG4gICAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=