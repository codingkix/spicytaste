angular.module("spicyTaste",["ngRoute","angular-md5"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/list",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"})}]),angular.module("spicyTaste").controller("DishListController",["DishService",function(e){var n=this;n.processing=!0,e.all().success(function(e){n.processing=!1,n.dishes=e}),n.deleteDish=function(t){n.processing=!0,e["delete"](t).success(function(){e.all().success(function(e){n.processing=!1,n.dishes=e})})},n.addDish=function(){n.processing=!0,e.create({name:"new dish"}).success(function(e){$location.path("/admin/dish/"+e.dish._id)})}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","DishService","UserService",function(e,n,t,o,i){function s(){e.focusOnComment=!1,r.newComment={content:"",replyTo:null},r.commentTitle="Comment"}var r=this;r.dish=null,s(),i.get(o.dish_id).success(function(e){r.dish=e}),r.addComment=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}i.addComment(r.dish._id,r.newComment).success(function(e){r.dish.comments.push(e)}),s()},r.reply=function(n){r.newComment.replyTo=n._id,r.commentTitle="@"+n.userName,e.focusOnComment=!0}}]).controller("DishCreateController",["$location","DishService",function(e,n){var t=this;t.dish={name:"new dish"},t.save=function(){t.processing=!0,n.create(t.dish).success(function(n){e.path("/admin/dish/"+n.dish._id)})}}]).controller("DishEditController",["$routeParams","DishService","$location",function(e,n){function t(){o.newPhoto="",o.newInstruction="",o.message="",o.processing=!1}var o=this;t(),n.get(e.dish_id).success(function(e){o.dish=e}),o.addInstruction=function(){o.dish.instructions.push(o.newInstruction),o.newInstruction=""},o.removeInstruction=function(e){o.dish.instructions.splice(e,1)},o.addPhoto=function(){console.log("newPhoto: ",o.newPhoto),o.dish.photos.push(o.newPhoto),console.log("dish:",o.dish),o.newPhoto=""},o.removePhoto=function(e){o.dish.photos.splice(e,1)},o.save=function(){o.processing=!0,n.update(e.dish_id,o.dish).success(function(e){t(),o.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS","md5",function(e,n,t,o,i){var s=this;s.email="",s.password="",s.userName="",s.showSignUpForm=!1,s.fbLogin=function(){FB.login(function(t){"connected"===t.status?FB.api("/me",function(t){console.log("fb user: ",t);var i={userName:t.name,email:t.email,password:o.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+t.id+"/picture?type=large",linkedSocial:o.FACEBOOK};n.socialLogin(i).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n)})}):"not_authorized"===t.status},{scope:"public_profile,email"})},s.login=function(){n.login(s.email,s.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n)})},s.signUp=function(){var t={userName:s.userName,email:s.email,password:s.password,photoUrl:"http://www.gravatar.com/avatar/"+i.createHash(s.email),linkedSocial:o.EMAIL};n.create(t).then(function(n){e.$emit("login",n)})}}]),angular.module("spicyTaste").controller("MainController",["$scope","$rootScope","$location","UserService","CONSTANTS",function(e,n,t,o,i){var s=this;e.$on("login",function(e,o){n.user=s.currentUser=o;var i=t.search().returnUrl;i?(console.log("return url: ",i),t.path(i).search({returnUrl:null})):t.path("/")}),s.logout=function(){s.currentUser.loginType==i.FACEBOOK&&FB.logout(function(){}),s.currentUser=null,n.user=null,o.logout()}}]),angular.module("spicyTaste").directive("contenteditable",function(){return{require:"ngModel",restrict:"A",link:function(e,n,t,o){o.$render=function(){n.html(o.$viewValue||"")},n.bind("blur",function(){e.$apply(function(){o.$setViewValue(n.html())})})}}}),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,n){e.$watch("focusValue",function(e,t){e&&!t&&n[0].focus()})}}}),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n}]),angular.module("spicyTaste").factory("UserService",["$http","CONSTANTS",function(e,n){var t={};return t.socialLogin=function(e){return console.log("socialUser: ",e),t.searchBy("email="+e.email).then(function(o){if(o.success){var i=o.users[0];return i.linkedSocial.indexOf(e.linkedSocial)<0?(i.linkedSocial.push(e.linkedSocial),i.userName=e.userName,i.photoUrl=e.photoUrl,t.update(i).then(function(){return t.login(i.email,n.SOCIAL_PASS)})):t.login(i.email,n.SOCIAL_PASS)}return t.create(e)})},t.login=function(n,o){return e.post("/api/auth",{email:n,password:o}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,t.get()})},t.logout=function(){delete e.defaults.headers.common["X-Auth"]},t.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},t.searchBy=function(n){return e.get("/api/users?"+n).then(function(e){return e.data})},t.getById=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},t.create=function(n){return e.post("/api/users/",n).then(function(){return t.login(n.email,n.password)})},t.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwiZGlyZWN0aXZlcy9jb250ZW50ZWRpdGFibGVEaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL2ZvY3VzT25EaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNoU2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXJTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIkZCX0FQUF9JRCIsIkZBQ0VCT09LIiwiRU1BSUwiLCJTT0NJQUxfUEFTUyIsInJ1biIsIiRyb290U2NvcGUiLCIkd2luZG93IiwiVXNlclNlcnZpY2UiLCJDT05TVEFOVFMiLCJ1c2VyIiwiZmJBc3luY0luaXQiLCJGQiIsImluaXQiLCJhcHBJZCIsImNvb2tpZSIsInhmYm1sIiwidmVyc2lvbiIsImQiLCJzIiwiaWQiLCJqcyIsImZqcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImRvY3VtZW50IiwiY29uZmlnIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJEaXNoU2VydmljZSIsInZtIiwidGhpcyIsInByb2Nlc3NpbmciLCJhbGwiLCJzdWNjZXNzIiwiZGF0YSIsImRpc2hlcyIsImRlbGV0ZURpc2giLCJhZGREaXNoIiwiY3JlYXRlIiwibmFtZSIsIiRsb2NhdGlvbiIsInBhdGgiLCJkaXNoIiwiX2lkIiwiJHNjb3BlIiwiJHJvdXRlUGFyYW1zIiwiZm9jdXNPbkNvbW1lbnQiLCJuZXdDb21tZW50IiwiY29udGVudCIsInJlcGx5VG8iLCJjb21tZW50VGl0bGUiLCJnZXQiLCJkaXNoX2lkIiwiYWRkQ29tbWVudCIsInJldHVyblVybCIsInVybCIsInNlYXJjaCIsImNvbW1lbnQiLCJjb21tZW50cyIsInB1c2giLCJyZXBseSIsInVzZXJOYW1lIiwic2F2ZSIsIm5ld1Bob3RvIiwibmV3SW5zdHJ1Y3Rpb24iLCJtZXNzYWdlIiwiYWRkSW5zdHJ1Y3Rpb24iLCJpbnN0cnVjdGlvbnMiLCJyZW1vdmVJbnN0cnVjdGlvbiIsImluZGV4Iiwic3BsaWNlIiwiYWRkUGhvdG8iLCJjb25zb2xlIiwibG9nIiwicGhvdG9zIiwicmVtb3ZlUGhvdG8iLCJ1cGRhdGUiLCJtZDUiLCJlbWFpbCIsInBhc3N3b3JkIiwic2hvd1NpZ25VcEZvcm0iLCJmYkxvZ2luIiwibG9naW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImFwaSIsImZiVXNlciIsInBob3RvVXJsIiwibGlua2VkU29jaWFsIiwic29jaWFsTG9naW4iLCJ0aGVuIiwibG9naW5UeXBlIiwiJGVtaXQiLCJzY29wZSIsInNpZ25VcCIsIm5ld1VzZXIiLCJjcmVhdGVIYXNoIiwiJG9uIiwiXyIsImN1cnJlbnRVc2VyIiwibG9nb3V0IiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInJlc3RyaWN0IiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dHMiLCJuZ01vZGVsIiwiJHJlbmRlciIsImh0bWwiLCIkdmlld1ZhbHVlIiwiYmluZCIsIiRhcHBseSIsIiRzZXRWaWV3VmFsdWUiLCJmb2N1c1ZhbHVlIiwiJGVsZW1lbnQiLCIkd2F0Y2giLCJjdXJyZW50VmFsdWUiLCJwcmV2aW91c1ZhbHVlIiwiZm9jdXMiLCJmYWN0b3J5IiwiJGh0dHAiLCJkaXNoRmFjdG9yeSIsInBvc3QiLCJwdXQiLCJ1c2VyRmFjdG9yeSIsInNvY2lhbFVzZXIiLCJzZWFyY2hCeSIsInVzZXJzIiwiaW5kZXhPZiIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsInF1ZXJ5IiwiZ2V0QnlJZCIsInVzZXJfaWQiXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFBQyxPQUFBLGNBQUEsVUFBQSxnQkFDQUMsU0FBQSxhQUNBQyxVQUFBLGdCQUNBQyxTQUFBLEtBQ0FDLE1BQUEsUUFDQUMsWUFBQSxhQ0xBTixRQUFBQyxPQUFBLGNBQ0FNLEtBQUEsYUFBQSxVQUFBLGNBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxLQUFBLEtBRUFILEVBQUFJLFlBQUEsV0FDQUMsR0FBQUMsTUFDQUMsTUFBQUwsRUFBQVIsVUFDQWMsUUFBQSxFQUNBQyxPQUFBLEVBQ0FDLFFBQUEsVUFLQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEdBQUFDLEVBQUFKLEVBQUFLLHFCQUFBSixHQUFBLEVBQ0FELEdBQUFNLGVBQUFKLEtBQ0FDLEVBQUFILEVBQUFPLGNBQUFOLEdBQ0FFLEVBQUFELEdBQUFBLEVBQ0FDLEVBQUFLLElBQUEsc0NBQ0FKLEVBQUFLLFdBQUFDLGFBQUFQLEVBQUFDLEtBQ0FPLFNBQUEsU0FBQSxxQkNyQkEvQixRQUFBQyxPQUFBLGNBQ0ErQixRQUFBLG9CQUFBLGlCQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEVBQUFFLFdBQUEsR0FFQUQsRUFFQUUsS0FBQSxLQUNBQyxZQUFBLDJCQUNBQyxXQUFBLGlCQUNBQyxhQUFBLFNBR0FILEtBQUEsV0FDQUMsWUFBQSxnQ0FDQUMsV0FBQSxxQkFDQUMsYUFBQSxhQUdBSCxLQUFBLG9CQUNBQyxZQUFBLGtDQUNBQyxXQUFBLHVCQUNBQyxhQUFBLFdBR0FILEtBQUEsc0JBQ0FDLFlBQUEsc0NBQ0FDLFdBQUEscUJBQ0FDLGFBQUEsYUFHQUgsS0FBQSx3QkFDQUMsWUFBQSx3Q0FDQUMsV0FBQSx1QkFDQUMsYUFBQSxlQUdBSCxLQUFBLDBCQUNBQyxZQUFBLHdDQUNBQyxXQUFBLHFCQUNBQyxhQUFBLGVBR0FILEtBQUEsVUFDQUMsWUFBQSxp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LE1BQUEvRSxFQUFBTCxhQWRBLE1BQUFtSSxHQUFBdkYsT0FBQXdGLE1BcUJBRCxFQUFBM0MsTUFBQSxTQUFBSixFQUFBQyxHQUVBLE1BQUEwQyxHQUFBRSxLQUFBLGFBQ0E3QyxNQUFBQSxFQUNBQyxTQUFBQSxJQUNBVyxLQUFBLFNBQUFQLEdBR0EsTUFGQXNDLEdBQUFTLFNBQUFDLFFBQUFDLE9BQUEsVUFBQWpELEVBQUFqRCxLQUVBMkYsRUFBQTFFLFNBS0EwRSxFQUFBekIsT0FBQSxpQkFDQXFCLEdBQUFTLFNBQUFDLFFBQUFDLE9BQUEsV0FJQVAsRUFBQTFFLElBQUEsV0FDQSxNQUFBc0UsR0FBQXRFLElBQUEsaUJBQUF1QyxLQUFBLFNBQUFQLEdBQ0EsTUFBQUEsR0FBQWpELFFBS0EyRixFQUFBRSxTQUFBLFNBQUFNLEdBQ0EsTUFBQVosR0FBQXRFLElBQUEsY0FBQWtGLEdBQUEzQyxLQUFBLFNBQUFQLEdBQ0EsTUFBQUEsR0FBQWpELFFBS0EyRixFQUFBUyxRQUFBLFNBQUFDLEdBQ0EsTUFBQWQsR0FBQXRFLElBQUEsY0FBQW9GLEdBQUE3QyxLQUFBLFNBQUFQLEdBQ0EsTUFBQUEsR0FBQWpELFFBS0EyRixFQUFBdkYsT0FBQSxTQUFBdEMsR0FDQSxNQUFBeUgsR0FBQUUsS0FBQSxjQUFBM0gsR0FBQTBGLEtBQUEsV0FDQSxNQUFBbUMsR0FBQTNDLE1BQUFsRixFQUFBOEUsTUFBQTlFLEVBQUErRSxhQUtBOEMsRUFBQWpELE9BQUEsU0FBQTJELEVBQUF2SSxHQUNBLE1BQUF5SCxHQUFBRyxJQUFBLGNBQUFXLEVBQUF2SSxHQUFBMEYsS0FBQSxTQUFBUCxHQUNBLE1BQUFBLEdBQUFqRCxRQUlBMkYiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnLCBbJ25nUm91dGUnLCAnYW5ndWxhci1tZDUnXSlcbiAgICAuY29uc3RhbnQoJ0NPTlNUQU5UUycsIHtcbiAgICAgICAgXCJGQl9BUFBfSURcIjogMTU2MzU2NzM4NzI1MzQ2OCxcbiAgICAgICAgXCJGQUNFQk9PS1wiOiBcIkZCXCIsXG4gICAgICAgIFwiRU1BSUxcIjogXCJFTUFJTFwiLFxuICAgICAgICBcIlNPQ0lBTF9QQVNTXCI6IFwiUEFTU1dPUkRcIlxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHdpbmRvdywgVXNlclNlcnZpY2UsIENPTlNUQU5UUykge1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuXG4gICAgICAgICR3aW5kb3cuZmJBc3luY0luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmluaXQoe1xuICAgICAgICAgICAgICAgIGFwcElkOiBDT05TVEFOVFMuRkJfQVBQX0lELFxuICAgICAgICAgICAgICAgIGNvb2tpZTogdHJ1ZSwgLy8gZW5hYmxlIGNvb2tpZXMgdG8gYWxsb3cgdGhlIHNlcnZlciB0byBhY2Nlc3MgdGhlIHNlc3Npb25cbiAgICAgICAgICAgICAgICB4ZmJtbDogdHJ1ZSwgLy8gcGFyc2Ugc29jaWFsIHBsdWdpbnMgb24gdGhpcyBwYWdlXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogJ3YyLjInIC8vIHVzZSB2ZXJzaW9uIDIuMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTG9hZCB0aGUgU0RLIGFzeW5jaHJvbm91c2x5XG4gICAgICAgIChmdW5jdGlvbihkLCBzLCBpZCkge1xuICAgICAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xuICAgICAgICAgICAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSByZXR1cm47XG4gICAgICAgICAgICBqcyA9IGQuY3JlYXRlRWxlbWVudChzKTtcbiAgICAgICAgICAgIGpzLmlkID0gaWQ7XG4gICAgICAgICAgICBqcy5zcmMgPSBcIi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvc2RrLmpzXCI7XG4gICAgICAgICAgICBmanMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoanMsIGZqcyk7XG4gICAgICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnKSk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgIC8vaG9tZSBwYWdlXG4gICAgICAgICAgICAud2hlbignLycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2hvbWUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdob21lJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vc2hvdyBhbGwgZGlzaGVzIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvZGlzaGVzJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvZGlzaC9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vc2hvdyBkaXNoIGRldGFpbCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvZGV0YWlsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGV0YWlsJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbGlzdCBhZG1pbiBkaXNoIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vZGlzaGVzL2xpc3QnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL2xpc3QuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hMaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZGlzaExpc3QnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9jcmVhdGUgYSBuZXcgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy9jcmVhdGUnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaENyZWF0ZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9lZGl0IGEgZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy86ZGlzaF9pZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2FkbWluL2Rpc2gvc2luZ2xlLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoRWRpdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hNYW5hZ2UnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9sb2dpbiB1c2VyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvdXNlci9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdsb2dpbidcbiAgICAgICAgICAgIH0pXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBsaXN0IHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaExpc3RDb250cm9sbGVyJywgZnVuY3Rpb24oRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvL3NldCBhIHByb2Nlc3NpbmcgdmFyaWFibGUgdG8gc2hvdyBsb2FkaW5nXG4gICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgIC8vZ3JhYiBhbGwgdGhlIGRpc2hlcyBhdCBwYWdlIGxvYWRcbiAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAvL3doZW4gYWxsIGRpc2hlcyBmZXRjaGVkLCByZW1vdmUgcHJvY2Vzc2luZyB2YXJpYWJsZVxuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvL2JpbmQgdGhlIGRpc2hlc1xuICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9mdW5jdGlvbiB0byBkZWxldGUgYSBkaXNoXG4gICAgICAgIHZtLmRlbGV0ZURpc2ggPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmRlbGV0ZShpZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFkZERpc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICduZXcgZGlzaCdcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4vZGlzaC8nICsgZGF0YS5kaXNoLl9pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGRldGFpbCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hEZXRhaWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgRGlzaFNlcnZpY2UsIFVzZXJTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmRpc2ggPSBudWxsO1xuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgLy9nZXQgdGhlIGRpc2ggYnkgaWRcbiAgICAgICAgRGlzaFNlcnZpY2UuZ2V0KCRyb3V0ZVBhcmFtcy5kaXNoX2lkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHZtLmRpc2ggPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5hZGRDb21tZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUudXNlcikge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24udXJsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKS5zZWFyY2goe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5Vcmw6IHJldHVyblVybFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5hZGRDb21tZW50KHZtLmRpc2guX2lkLCB2bS5uZXdDb21tZW50KS5zdWNjZXNzKGZ1bmN0aW9uKGNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNoLmNvbW1lbnRzLnB1c2goY29tbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlcGx5ID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgdm0ubmV3Q29tbWVudC5yZXBseVRvID0gdXNlci5faWQ7XG4gICAgICAgICAgICB2bS5jb21tZW50VGl0bGUgPSAnQCcgKyB1c2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5uZXdDb21tZW50ID0ge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICAgICAgICAgIHJlcGx5VG86IG51bGwsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdm0uY29tbWVudFRpdGxlID0gJ0NvbW1lbnQnO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGNyZWF0aW9uIHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaENyZWF0ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkbG9jYXRpb24sIERpc2hTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0uZGlzaCA9IHtcbiAgICAgICAgICAgIG5hbWU6ICduZXcgZGlzaCdcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UuY3JlYXRlKHZtLmRpc2gpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4vZGlzaC8nICsgZGF0YS5kaXNoLl9pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuXG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHZtLnR5cGUgPSAnY3JlYXRlJztcbiAgICAgICAgICAgIHZtLmRpc2ggPSB7XG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zOiBbXSxcbiAgICAgICAgICAgICAgICBwaG90bzogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2bS5uZXdJbnN0cnVjdGlvbiA9ICcnO1xuICAgICAgICAgICAgdm0ubmV3UGhvdG8gPSAnJztcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmRpc2guaW5zdHJ1Y3Rpb25zLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICB2bS5kaXNoLnBob3Rvcy5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGVkaXQgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoRWRpdENvbnRyb2xsZXInLCBmdW5jdGlvbigkcm91dGVQYXJhbXMsIERpc2hTZXJ2aWNlLCAkbG9jYXRpb24pIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIC8vZ2V0IHRoZSBkaXNoIGJ5IGlkXG4gICAgICAgIERpc2hTZXJ2aWNlLmdldCgkcm91dGVQYXJhbXMuZGlzaF9pZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB2bS5kaXNoID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0uYWRkSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLmRpc2guaW5zdHJ1Y3Rpb25zLnB1c2godm0ubmV3SW5zdHJ1Y3Rpb24pO1xuICAgICAgICAgICAgdm0ubmV3SW5zdHJ1Y3Rpb24gPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnJlbW92ZUluc3RydWN0aW9uID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIHZtLmRpc2guaW5zdHJ1Y3Rpb25zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5hZGRQaG90byA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJuZXdQaG90bzogXCIsIHZtLm5ld1Bob3RvKTtcbiAgICAgICAgICAgIHZtLmRpc2gucGhvdG9zLnB1c2godm0ubmV3UGhvdG8pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJkaXNoOlwiLCB2bS5kaXNoKTtcbiAgICAgICAgICAgIHZtLm5ld1Bob3RvID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5yZW1vdmVQaG90byA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICB2bS5kaXNoLnBob3Rvcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLnVwZGF0ZSgkcm91dGVQYXJhbXMuZGlzaF9pZCwgdm0uZGlzaCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHZtLm5ld1Bob3RvID0gJyc7XG4gICAgICAgICAgICB2bS5uZXdJbnN0cnVjdGlvbiA9ICcnO1xuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNlcnZpY2UsICRsb2NhdGlvbiwgQ09OU1RBTlRTLCBtZDUpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0uZW1haWwgPSBcIlwiO1xuICAgICAgICB2bS5wYXNzd29yZCA9IFwiXCI7XG4gICAgICAgIHZtLnVzZXJOYW1lID0gXCJcIjtcbiAgICAgICAgdm0uc2hvd1NpZ25VcEZvcm0gPSBmYWxzZTtcblxuICAgICAgICB2bS5mYkxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBGQi5sb2dpbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdjb25uZWN0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIExvZ2dlZCBpbnRvIHlvdXIgYXBwIGFuZCBGYWNlYm9vay5cbiAgICAgICAgICAgICAgICAgICAgRkIuYXBpKCcvbWUnLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZiIHVzZXI6ICcsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYlVzZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IHJlc3BvbnNlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IHJlc3BvbnNlLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBDT05TVEFOVFMuU09DSUFMX1BBU1MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhvdG9Vcmw6ICdodHRwOi8vZ3JhcGguZmFjZWJvb2suY29tLycgKyByZXNwb25zZS5pZCArICcvcGljdHVyZT90eXBlPWxhcmdlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rZWRTb2NpYWw6IENPTlNUQU5UUy5GQUNFQk9PS1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgVXNlclNlcnZpY2Uuc29jaWFsTG9naW4oZmJVc2VyKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxvZ2luVHlwZSA9IENPTlNUQU5UUy5GQUNFQk9PSztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnbm90X2F1dGhvcml6ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwZXJzb24gaXMgbG9nZ2VkIGludG8gRmFjZWJvb2ssIGJ1dCBub3QgeW91ciBhcHAuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBub3QgbG9nZ2VkIGludG8gRmFjZWJvb2ssIHNvIHdlJ3JlIG5vdCBzdXJlIGlmXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZXkgYXJlIGxvZ2dlZCBpbnRvIHRoaXMgYXBwIG9yIG5vdC5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2NvcGU6ICdwdWJsaWNfcHJvZmlsZSxlbWFpbCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ2luKHZtLmVtYWlsLCB2bS5wYXNzd29yZCkudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRU1BSUw7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5zaWduVXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBuZXdVc2VyID0ge1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiB2bS51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogdm0uZW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHZtLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIHBob3RvVXJsOiAnaHR0cDovL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyLycgKyBtZDUuY3JlYXRlSGFzaCh2bS5lbWFpbCksXG4gICAgICAgICAgICAgICAgbGlua2VkU29jaWFsOiBDT05TVEFOVFMuRU1BSUxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmNyZWF0ZShuZXdVc2VyKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBVc2VyU2VydmljZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgJHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbihfLCB1c2VyKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSB2bS5jdXJyZW50VXNlciA9IHVzZXI7XG5cbiAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24uc2VhcmNoKCkucmV0dXJuVXJsO1xuICAgICAgICAgICAgaWYgKHJldHVyblVybCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXR1cm4gdXJsOiAnLCByZXR1cm5VcmwpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKHJldHVyblVybCkuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVXJsOiBudWxsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgdm0ubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodm0uY3VycmVudFVzZXIubG9naW5UeXBlID09IENPTlNUQU5UUy5GQUNFQk9PSykge1xuICAgICAgICAgICAgICAgIEZCLmxvZ291dChmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5sb2dvdXQoKTtcbiAgICAgICAgfTtcblxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ2NvbnRlbnRlZGl0YWJsZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRyaWJ1dHMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiRyZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKG5nTW9kZWwuJHZpZXdWYWx1ZSB8fCAnJyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoZWxlbWVudC5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZGlyZWN0aXZlKCdmb2N1c09uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBmb2N1c1ZhbHVlOiBcIj1mb2N1c09uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZm9jdXNWYWx1ZScsIGZ1bmN0aW9uKGN1cnJlbnRWYWx1ZSwgcHJldmlvdXNWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlICYmICFwcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkZWxlbWVudFswXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ0Rpc2hTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHApIHtcblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyBvYmplY3RcbiAgICAgICAgdmFyIGRpc2hGYWN0b3J5ID0ge307XG5cbiAgICAgICAgLy9nZXQgYWxsIGRpc2hlc1xuICAgICAgICBkaXNoRmFjdG9yeS5hbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9jcmVhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcycsIGRpc2gpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vZ2V0IGEgc2luZ2xlIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZ2V0ID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy91cGRhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQsIGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkLCBkaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZGVsZXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5kZWxldGUgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2FkZCBhIGNvbW1lbnRcbiAgICAgICAgZGlzaEZhY3RvcnkuYWRkQ29tbWVudCA9IGZ1bmN0aW9uKGRpc2hfaWQsIGNvbW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCArICcvY29tbWVudHMnLCBjb21tZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaXNoRmFjdG9yeTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgQ09OU1RBTlRTKSB7XG4gICAgICAgIHZhciB1c2VyRmFjdG9yeSA9IHt9O1xuICAgICAgICAvL3NvY2lhbCBsb2dpblxuICAgICAgICB1c2VyRmFjdG9yeS5zb2NpYWxMb2dpbiA9IGZ1bmN0aW9uKHNvY2lhbFVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic29jaWFsVXNlcjogXCIsIHNvY2lhbFVzZXIpO1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnkuc2VhcmNoQnkoJ2VtYWlsPScgKyBzb2NpYWxVc2VyLmVtYWlsKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90IGZvdW5kLCB0aGVuIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkuY3JlYXRlKHNvY2lhbFVzZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZm91bmQgdGhlIHVzZXIgd2l0aCBlbWFpbFxuICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSB0aGUgbGlua2VkIHNvY2lhbCBpZiBub3QgYWRkZWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBkYXRhLnVzZXJzWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5saW5rZWRTb2NpYWwuaW5kZXhPZihzb2NpYWxVc2VyLmxpbmtlZFNvY2lhbCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxpbmtlZFNvY2lhbC5wdXNoKHNvY2lhbFVzZXIubGlua2VkU29jaWFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIudXNlck5hbWUgPSBzb2NpYWxVc2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5waG90b1VybCA9IHNvY2lhbFVzZXIucGhvdG9Vcmw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS51cGRhdGUodXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgQ09OU1RBTlRTLlNPQ0lBTF9QQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5sb2dpbiA9IGZ1bmN0aW9uKGVtYWlsLCBwYXNzd29yZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9hdXRoJywge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmdldCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9nb3V0IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgY3VycmVudCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9tZScpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9zZWFyY2ggdXNlciBieSBmaWVsZFxuICAgICAgICB1c2VyRmFjdG9yeS5zZWFyY2hCeSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzPycgKyBxdWVyeSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCB1c2VyIGJ5IGlkXG4gICAgICAgIHVzZXJGYWN0b3J5LmdldEJ5SWQgPSBmdW5jdGlvbih1c2VyX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzLycgKyB1c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3JlYXRlIGEgbmV3IHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkuY3JlYXRlID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMvJywgdXNlcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkubG9naW4odXNlci5lbWFpbCwgdXNlci5wYXNzd29yZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkudXBkYXRlID0gZnVuY3Rpb24odXNlcl9pZCwgdXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCwgdXNlcikudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdXNlckZhY3Rvcnk7XG4gICAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=