angular.module("spicyTaste",["ngRoute","angular-md5","ngMaterial","ngAnimate","ngMessages"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").config(["$mdThemingProvider","$mdIconProvider",function(e,n){var t=e.extendPalette("deep-orange",{500:"f27242"});e.definePalette("primaryOrange",t),e.theme("default").primaryPalette("primaryOrange").accentPalette("light-green"),n.icon("menu","assets/svg/ic_menu_24px.svg").icon("share","assets/svg/ic_share_24px.svg").icon("login","assets/svg/ic_account_circle_24px.svg").icon("recipes","assets/svg/ic_event_note_48px.svg").icon("restaurants","assets/svg/ic_restaurant_menu_48px.svg")}]),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/all.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/list",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"}).when("/me",{templateUrl:"ng/views/pages/user/me.html",controller:"ProfileController",controllerAs:"me"})}]),angular.module("spicyTaste").controller("DishListController",["DishService","SocialService","$location",function(e,n,t){var o=this;o.processing=!0,e.all().success(function(e){o.processing=!1,o.dishes=e}),o.deleteDish=function(n){o.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){o.processing=!1,o.dishes=e})})},o.addDish=function(){o.processing=!0,e.create({name:"new dish"}).success(function(e){t.path("/admin/dish/"+e.dish._id)})},o.fbShare=function(e){var o=t.absUrl()+"/"+e._id;n.fbShare(o)}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","DishService","UserService",function(e,n,t,o,i,s){function r(){e.focusOnComment=!1,l.newComment={content:"",replyTo:null},l.commentTitle="Comment"}var l=this;l.dish={},r(),i.get(o.dish_id).success(function(e){l.dish=e,l.dish.isCollected=t.user&&t.user.favouriteDishes.indexOf(l.dish._id)>=0?!0:!1}),l.addComment=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}i.addComment(l.dish._id,l.newComment).success(function(e){l.dish.comments.push(e)}),r()},l.reply=function(n){l.newComment.replyTo=n._id,l.commentTitle="@"+n.userName,e.focusOnComment=!0},l.collect=function(){if(!t.user){var e=n.url();return n.path("/login").search({returnUrl:e})}s.collect(l.dish._id).then(function(e){console.log("UserService.collect:",e),e.success&&(l.dish.isCollected=!0)})}}]).controller("DishCreateController",["$location","DishService",function(e,n){var t=this;t.dish={name:"new dish"},t.save=function(){t.processing=!0,n.create(t.dish).success(function(n){e.path("/admin/dish/"+n.dish._id)})}}]).controller("DishEditController",["$routeParams","DishService","$location",function(e,n,t){function o(){i.newPhoto="",i.newInstruction="",i.message="",i.processing=!1}var i=this;o(),n.get(e.dish_id).success(function(e){i.dish=e}),i.addInstruction=function(){i.dish.instructions.push(i.newInstruction),i.newInstruction=""},i.removeInstruction=function(e){i.dish.instructions.splice(e,1)},i.addPhoto=function(){console.log("newPhoto: ",i.newPhoto),i.dish.photos.push(i.newPhoto),console.log("dish:",i.dish),i.newPhoto=""},i.removePhoto=function(e){i.dish.photos.splice(e,1)},i.save=function(){i.processing=!0,n.update(e.dish_id,i.dish).success(function(e){o(),i.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS","md5",function(e,n,t,o,i){var s=this;s.email="",s.password="",s.userName="",s.showSignUpForm=!1,s.fbLogin=function(){FB.login(function(t){"connected"===t.status?FB.api("/me",function(t){console.log("fb user: ",t);var i={userName:t.name,email:t.email,password:o.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+t.id+"/picture?type=large",linkedSocial:o.FACEBOOK};n.socialLogin(i).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n)})}):"not_authorized"===t.status},{scope:"public_profile,email"})},s.login=function(){n.login(s.email,s.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n)})},s.signUp=function(){var t={userName:s.userName,email:s.email,password:s.password,photoUrl:"http://www.gravatar.com/avatar/"+i.createHash(s.email),linkedSocial:o.EMAIL};n.create(t).then(function(n){e.$emit("login",n)})}}]),angular.module("spicyTaste").controller("MainController",["$scope","$rootScope","$location","$mdDialog","UserService","CONSTANTS",function(e,n,t,o,i,s){function r(){var n=this;n.email="",n.password="",n.userName="",n.showSignUpForm=!1,n.fbLogin=function(){FB.login(function(n){"connected"===n.status?FB.api("/me",function(n){console.log("fb user: ",n);var t={userName:n.name,email:n.email,password:s.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+n.id+"/picture?type=large",linkedSocial:s.FACEBOOK};i.socialLogin(t).then(function(n){n.loginType=s.FACEBOOK,e.$emit("login",n)})}):"not_authorized"===n.status},{scope:"public_profile,email"})},n.login=function(){i.login(n.email,n.password).then(function(n){n.loginType=s.EMAIL,e.$emit("login",n)})},n.signUp=function(){var t={userName:n.userName,email:n.email,password:n.password,photoUrl:"http://www.gravatar.com/avatar/"+md5.createHash(n.email),linkedSocial:s.EMAIL};i.create(t).then(function(n){e.$emit("login",n)})}}var l=this;l.showMobileMenu=!1,l.toggleMobileMenu=function(){l.showMobileMenu=!l.showMobileMenu},e.$on("login",function(e,o){n.user=l.currentUser=o;var i=t.search().returnUrl;i?(console.log("return url: ",i),t.path(i).search({returnUrl:null})):t.path("/")}),l.logout=function(){l.currentUser.loginType==s.FACEBOOK&&FB.logout(function(e){}),l.currentUser=null,n.user=null,i.logout()},l.showLoginDialog=function(n){o.show({clickOutsideToClose:!0,controller:r,templateUrl:"ng/views/dialogs/login.html",targetEvent:n,controllerAs:"login"}).then(function(n){e.alert='You said the information was "'+n+'".'},function(){e.alert="You cancelled the dialog."})}}]),angular.module("spicyTaste").controller("ProfileController",["UserService",function(e){var n=this;n.user={},e.get().then(function(e){n.user=e})}]),angular.module("spicyTaste").directive("contenteditable",function(){return{require:"ngModel",restrict:"A",link:function(e,n,t,o){o.$render=function(){n.html(o.$viewValue||"")},n.bind("blur",function(){e.$apply(function(){o.$setViewValue(n.html())})})}}}),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,n){e.$watch("focusValue",function(e,t){e&&!t&&n[0].focus()})}}}),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n}]),angular.module("spicyTaste").factory("SocialService",function(){var e={};return e.fbShare=function(e){FB.ui({method:"share",href:e},function(e){})},e}),angular.module("spicyTaste").factory("UserService",["$http","$rootScope","CONSTANTS",function(e,n,t){var o={};return o.socialLogin=function(e){return console.log("socialUser: ",e),o.searchBy("email="+e.email).then(function(n){if(n.success){var i=n.users[0];return i.linkedSocial.indexOf(e.linkedSocial)<0?(i.linkedSocial.push(e.linkedSocial),i.userName=e.userName,i.photoUrl=e.photoUrl,o.update(i).then(function(){return o.login(i.email,t.SOCIAL_PASS)})):o.login(i.email,t.SOCIAL_PASS)}return o.create(e)})},o.login=function(n,t){return e.post("/api/auth",{email:n,password:t}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,o.get()})},o.logout=function(){delete e.defaults.headers.common["X-Auth"]},o.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},o.searchBy=function(n){return e.get("/api/users?"+n).then(function(e){return e.data})},o.getById=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},o.create=function(n){return e.post("/api/users/",n).then(function(){return o.login(n.email,n.password)})},o.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},o.collect=function(t){return e.put("/api/users/"+n.user._id+"/dishes/"+t).then(function(e){return e.data})},o}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImRlc2lnbi5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvcHJvZmlsZUNvbnRyb2xsZXIuanMiLCJkaXJlY3RpdmVzL2NvbnRlbnRlZGl0YWJsZURpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZm9jdXNPbkRpcmVjdGl2ZS5qcyIsInNlcnZpY2VzL2Rpc2hTZXJ2aWNlLmpzIiwic2VydmljZXMvc29jaWFsU2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXJTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIkZCX0FQUF9JRCIsIkZBQ0VCT09LIiwiRU1BSUwiLCJTT0NJQUxfUEFTUyIsImNvbmZpZyIsIiRtZFRoZW1pbmdQcm92aWRlciIsIiRtZEljb25Qcm92aWRlciIsInByaW1hcnlPcmFuZ2UiLCJleHRlbmRQYWxldHRlIiwiNTAwIiwiZGVmaW5lUGFsZXR0ZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiaWNvbiIsInJ1biIsIiRyb290U2NvcGUiLCIkd2luZG93IiwiVXNlclNlcnZpY2UiLCJDT05TVEFOVFMiLCJ1c2VyIiwiZmJBc3luY0luaXQiLCJGQiIsImluaXQiLCJhcHBJZCIsImNvb2tpZSIsInhmYm1sIiwidmVyc2lvbiIsImQiLCJzIiwiaWQiLCJqcyIsImZqcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImRvY3VtZW50IiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJEaXNoU2VydmljZSIsIlNvY2lhbFNlcnZpY2UiLCIkbG9jYXRpb24iLCJ2bSIsInRoaXMiLCJwcm9jZXNzaW5nIiwiYWxsIiwic3VjY2VzcyIsImRhdGEiLCJkaXNoZXMiLCJkZWxldGVEaXNoIiwiYWRkRGlzaCIsImNyZWF0ZSIsIm5hbWUiLCJwYXRoIiwiZGlzaCIsIl9pZCIsImZiU2hhcmUiLCJkaXNoTGluayIsImFic1VybCIsIiRzY29wZSIsIiRyb3V0ZVBhcmFtcyIsImZvY3VzT25Db21tZW50IiwibmV3Q29tbWVudCIsImNvbnRlbnQiLCJyZXBseVRvIiwiY29tbWVudFRpdGxlIiwiZ2V0IiwiZGlzaF9pZCIsImlzQ29sbGVjdGVkIiwiZmF2b3VyaXRlRGlzaGVzIiwiaW5kZXhPZiIsImFkZENvbW1lbnQiLCJyZXR1cm5VcmwiLCJ1cmwiLCJzZWFyY2giLCJjb21tZW50IiwiY29tbWVudHMiLCJwdXNoIiwicmVwbHkiLCJ1c2VyTmFtZSIsImNvbGxlY3QiLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsInNhdmUiLCJuZXdQaG90byIsIm5ld0luc3RydWN0aW9uIiwibWVzc2FnZSIsImFkZEluc3RydWN0aW9uIiwiaW5zdHJ1Y3Rpb25zIiwicmVtb3ZlSW5zdHJ1Y3Rpb24iLCJpbmRleCIsInNwbGljZSIsImFkZFBob3RvIiwicGhvdG9zIiwicmVtb3ZlUGhvdG8iLCJ1cGRhdGUiLCJtZDUiLCJlbWFpbCIsInBhc3N3b3JkIiwic2hvd1NpZ25VcEZvcm0iLCJmYkxvZ2luIiwibG9naW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImFwaSIsImZiVXNlciIsInBob3RvVXJsIiwibGlua2VkU29jaWFsIiwic29jaWFsTG9naW4iLCJsb2dpblR5cGUiLCIkZW1pdCIsInNjb3BlIiwic2lnblVwIiwibmV3VXNlciIsImNyZWF0ZUhhc2giLCIkbWREaWFsb2ciLCJMb2dpbkNvbnRyb2xsZXIiLCJzaG93TW9iaWxlTWVudSIsInRvZ2dsZU1vYmlsZU1lbnUiLCIkb24iLCJfIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJzaG93TG9naW5EaWFsb2ciLCJldiIsInNob3ciLCJjbGlja091dHNpZGVUb0Nsb3NlIiwidGFyZ2V0RXZlbnQiLCJhbnN3ZXIiLCJhbGVydCIsImRpcmVjdGl2ZSIsInJlcXVpcmUiLCJyZXN0cmljdCIsImxpbmsiLCJlbGVtZW50IiwiYXR0cmlidXRzIiwibmdNb2RlbCIsIiRyZW5kZXIiLCJodG1sIiwiJHZpZXdWYWx1ZSIsImJpbmQiLCIkYXBwbHkiLCIkc2V0Vmlld1ZhbHVlIiwiZm9jdXNWYWx1ZSIsIiRlbGVtZW50IiwiJHdhdGNoIiwiY3VycmVudFZhbHVlIiwicHJldmlvdXNWYWx1ZSIsImZvY3VzIiwiZmFjdG9yeSIsIiRodHRwIiwiZGlzaEZhY3RvcnkiLCJwb3N0IiwicHV0Iiwic29jaWFsRmFjdG9yeSIsInVpIiwibWV0aG9kIiwiaHJlZiIsInVzZXJGYWN0b3J5Iiwic29jaWFsVXNlciIsInNlYXJjaEJ5IiwidXNlcnMiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJxdWVyeSIsImdldEJ5SWQiLCJ1c2VyX2lkIl0sIm1hcHBpbmdzIjoiQUFBQUEsUUFBQUMsT0FBQSxjQUFBLFVBQUEsY0FBQSxhQUFBLFlBQUEsZUFDQUMsU0FBQSxhQUNBQyxVQUFBLGdCQUNBQyxTQUFBLEtBQ0FDLE1BQUEsUUFDQUMsWUFBQSxhQ0xBTixRQUFBQyxPQUFBLGNBQ0FNLFFBQUEscUJBQUEsa0JBQUEsU0FBQUMsRUFBQUMsR0FFQSxHQUFBQyxHQUFBRixFQUFBRyxjQUFBLGVBQ0FDLElBQUEsVUFHQUosR0FBQUssY0FBQSxnQkFBQUgsR0FFQUYsRUFBQU0sTUFBQSxXQUNBQyxlQUFBLGlCQUNBQyxjQUFBLGVBRUFQLEVBQUFRLEtBQUEsT0FBQSwrQkFDQUEsS0FBQSxRQUFBLGdDQUNBQSxLQUFBLFFBQUEseUNBQ0FBLEtBQUEsVUFBQSxxQ0FDQUEs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R0FFQSxNQUFBb0QsR0FBQUUsS0FBQSxhQUNBdkQsTUFBQUEsRUFDQUMsU0FBQUEsSUFDQWxCLEtBQUEsU0FBQXNCLEdBR0EsTUFGQWdELEdBQUFZLFNBQUFDLFFBQUFDLE9BQUEsVUFBQTlELEVBQUF4RCxLQUVBZ0gsRUFBQTdGLFNBS0E2RixFQUFBcEMsT0FBQSxpQkFDQTRCLEdBQUFZLFNBQUFDLFFBQUFDLE9BQUEsV0FJQU4sRUFBQTdGLElBQUEsV0FDQSxNQUFBcUYsR0FBQXJGLElBQUEsaUJBQUFlLEtBQUEsU0FBQXNCLEdBQ0EsTUFBQUEsR0FBQXhELFFBS0FnSCxFQUFBRSxTQUFBLFNBQUFLLEdBQ0EsTUFBQWYsR0FBQXJGLElBQUEsY0FBQW9HLEdBQUFyRixLQUFBLFNBQUFzQixHQUNBLE1BQUFBLEdBQUF4RCxRQUtBZ0gsRUFBQVEsUUFBQSxTQUFBQyxHQUNBLE1BQUFqQixHQUFBckYsSUFBQSxjQUFBc0csR0FBQXZGLEtBQUEsU0FBQXNCLEdBQ0EsTUFBQUEsR0FBQXhELFFBS0FnSCxFQUFBNUcsT0FBQSxTQUFBdkMsR0FDQSxNQUFBMkksR0FBQUUsS0FBQSxjQUFBN0ksR0FBQXFFLEtBQUEsV0FDQSxNQUFBOEUsR0FBQXpELE1BQUExRixFQUFBc0YsTUFBQXRGLEVBQUF1RixhQUtBNEQsRUFBQS9ELE9BQUEsU0FBQXdFLEVBQUE1SixHQUNBLE1BQUEySSxHQUFBRyxJQUFBLGNBQUFjLEVBQUE1SixHQUFBcUUsS0FBQSxTQUFBc0IsR0FDQSxNQUFBQSxHQUFBeEQsUUFLQWdILEVBQUEvRSxRQUFBLFNBQUFiLEdBQ0EsTUFBQW9GLEdBQUFHLElBQUEsY0FBQWxKLEVBQUFJLEtBQUEyQyxJQUFBLFdBQUFZLEdBQUFjLEtBQUEsU0FBQXNCLEdBQ0EsTUFBQUEsR0FBQXhELFFBSUFnSCIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScsIFsnbmdSb3V0ZScsICdhbmd1bGFyLW1kNScsICduZ01hdGVyaWFsJywgJ25nQW5pbWF0ZScsICduZ01lc3NhZ2VzJ10pXG4gICAgLmNvbnN0YW50KCdDT05TVEFOVFMnLCB7XG4gICAgICAgIFwiRkJfQVBQX0lEXCI6IDE1NjM1NjczODcyNTM0NjgsXG4gICAgICAgIFwiRkFDRUJPT0tcIjogXCJGQlwiLFxuICAgICAgICBcIkVNQUlMXCI6IFwiRU1BSUxcIixcbiAgICAgICAgXCJTT0NJQUxfUEFTU1wiOiBcIlBBU1NXT1JEXCJcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRtZFRoZW1pbmdQcm92aWRlciwgJG1kSWNvblByb3ZpZGVyKSB7XG5cbiAgICAgICAgdmFyIHByaW1hcnlPcmFuZ2UgPSAkbWRUaGVtaW5nUHJvdmlkZXIuZXh0ZW5kUGFsZXR0ZSgnZGVlcC1vcmFuZ2UnLCB7XG4gICAgICAgICAgICAnNTAwJzogJ2YyNzI0MidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLmRlZmluZVBhbGV0dGUoJ3ByaW1hcnlPcmFuZ2UnLCBwcmltYXJ5T3JhbmdlKTtcblxuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgICAgICAgLnByaW1hcnlQYWxldHRlKCdwcmltYXJ5T3JhbmdlJylcbiAgICAgICAgICAgIC5hY2NlbnRQYWxldHRlKCdsaWdodC1ncmVlbicpO1xuXG4gICAgICAgICRtZEljb25Qcm92aWRlci5pY29uKCdtZW51JywgJ2Fzc2V0cy9zdmcvaWNfbWVudV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignc2hhcmUnLCAnYXNzZXRzL3N2Zy9pY19zaGFyZV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbignbG9naW4nLCAnYXNzZXRzL3N2Zy9pY19hY2NvdW50X2NpcmNsZV8yNHB4LnN2ZycpXG4gICAgICAgICAgICAuaWNvbigncmVjaXBlcycsICdhc3NldHMvc3ZnL2ljX2V2ZW50X25vdGVfNDhweC5zdmcnKVxuICAgICAgICAgICAgLmljb24oJ3Jlc3RhdXJhbnRzJywgJ2Fzc2V0cy9zdmcvaWNfcmVzdGF1cmFudF9tZW51XzQ4cHguc3ZnJyk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCBVc2VyU2VydmljZSwgQ09OU1RBTlRTKSB7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IG51bGw7XG5cbiAgICAgICAgJHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRkIuaW5pdCh7XG4gICAgICAgICAgICAgICAgYXBwSWQ6IENPTlNUQU5UUy5GQl9BUFBfSUQsXG4gICAgICAgICAgICAgICAgY29va2llOiB0cnVlLCAvLyBlbmFibGUgY29va2llcyB0byBhbGxvdyB0aGUgc2VydmVyIHRvIGFjY2VzcyB0aGUgc2Vzc2lvblxuICAgICAgICAgICAgICAgIHhmYm1sOiB0cnVlLCAvLyBwYXJzZSBzb2NpYWwgcGx1Z2lucyBvbiB0aGlzIHBhZ2VcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAndjIuMicgLy8gdXNlIHZlcnNpb24gMi4yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBMb2FkIHRoZSBTREsgYXN5bmNocm9ub3VzbHlcbiAgICAgICAgKGZ1bmN0aW9uKGQsIHMsIGlkKSB7XG4gICAgICAgICAgICB2YXIganMsIGZqcyA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUocylbMF07XG4gICAgICAgICAgICBpZiAoZC5nZXRFbGVtZW50QnlJZChpZCkpIHJldHVybjtcbiAgICAgICAgICAgIGpzID0gZC5jcmVhdGVFbGVtZW50KHMpO1xuICAgICAgICAgICAganMuaWQgPSBpZDtcbiAgICAgICAgICAgIGpzLnNyYyA9IFwiLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9zZGsuanNcIjtcbiAgICAgICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcbiAgICAgICAgfShkb2N1bWVudCwgJ3NjcmlwdCcsICdmYWNlYm9vay1qc3NkaycpKTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkcm91dGVQcm92aWRlcikge1xuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgLy9ob21lIHBhZ2VcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvaG9tZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2hvbWUnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy9zaG93IGFsbCBkaXNoZXMgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2FsbC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaExpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTGlzdCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3Nob3cgZGlzaCBkZXRhaWwgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2RldGFpbC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaERldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2RldGFpbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL2xpc3QgYWRtaW4gZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy9saXN0Jywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vY3JlYXRlIGEgbmV3IGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvY3JlYXRlJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hDcmVhdGVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vZWRpdCBhIGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaEVkaXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbG9naW4nXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy91c2VyIHByb2ZpbGVcbiAgICAgICAgICAgIC53aGVuKCcvbWUnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy91c2VyL21lLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQcm9maWxlQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbWUnXG4gICAgICAgICAgICB9KVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggbGlzdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hMaXN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlLCBTb2NpYWxTZXJ2aWNlLCAkbG9jYXRpb24pIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvL3NldCBhIHByb2Nlc3NpbmcgdmFyaWFibGUgdG8gc2hvdyBsb2FkaW5nXG4gICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgIC8vZ3JhYiBhbGwgdGhlIGRpc2hlcyBhdCBwYWdlIGxvYWRcbiAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAvL3doZW4gYWxsIGRpc2hlcyBmZXRjaGVkLCByZW1vdmUgcHJvY2Vzc2luZyB2YXJpYWJsZVxuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvL2JpbmQgdGhlIGRpc2hlc1xuICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9mdW5jdGlvbiB0byBkZWxldGUgYSBkaXNoXG4gICAgICAgIHZtLmRlbGV0ZURpc2ggPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgICAgIERpc2hTZXJ2aWNlLmRlbGV0ZShpZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgRGlzaFNlcnZpY2UuYWxsKCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFkZERpc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICduZXcgZGlzaCdcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4vZGlzaC8nICsgZGF0YS5kaXNoLl9pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmZiU2hhcmUgPSBmdW5jdGlvbihkaXNoKSB7XG4gICAgICAgICAgICB2YXIgZGlzaExpbmsgPSAkbG9jYXRpb24uYWJzVXJsKCkgKyAnLycgKyBkaXNoLl9pZDtcbiAgICAgICAgICAgIFNvY2lhbFNlcnZpY2UuZmJTaGFyZShkaXNoTGluayk7XG4gICAgICAgIH1cblxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBkZXRhaWwgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoRGV0YWlsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsIERpc2hTZXJ2aWNlLCBVc2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5kaXNoID0ge307XG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICAvL2dldCB0aGUgZGlzaCBieSBpZFxuICAgICAgICBEaXNoU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmRpc2hfaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdm0uZGlzaCA9IGRhdGE7XG4gICAgICAgICAgICBpZiAoJHJvb3RTY29wZS51c2VyICYmICRyb290U2NvcGUudXNlci5mYXZvdXJpdGVEaXNoZXMuaW5kZXhPZih2bS5kaXNoLl9pZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgIHZtLmRpc2guaXNDb2xsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNoLmlzQ29sbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0uYWRkQ29tbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuVXJsID0gJGxvY2F0aW9uLnVybCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJykuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVXJsOiByZXR1cm5VcmxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UuYWRkQ29tbWVudCh2bS5kaXNoLl9pZCwgdm0ubmV3Q29tbWVudCkuc3VjY2VzcyhmdW5jdGlvbihjb21tZW50KSB7XG4gICAgICAgICAgICAgICAgdm0uZGlzaC5jb21tZW50cy5wdXNoKGNvbW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZXBseSA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHZtLm5ld0NvbW1lbnQucmVwbHlUbyA9IHVzZXIuX2lkO1xuICAgICAgICAgICAgdm0uY29tbWVudFRpdGxlID0gJ0AnICsgdXNlci51c2VyTmFtZTtcbiAgICAgICAgICAgICRzY29wZS5mb2N1c09uQ29tbWVudCA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY29sbGVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuVXJsID0gJGxvY2F0aW9uLnVybCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJykuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVXJsOiByZXR1cm5VcmxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuY29sbGVjdCh2bS5kaXNoLl9pZCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVc2VyU2VydmljZS5jb2xsZWN0OlwiLCBkYXRhKTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzaC5pc0NvbGxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5uZXdDb21tZW50ID0ge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICAgICAgICAgIHJlcGx5VG86IG51bGwsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdm0uY29tbWVudFRpdGxlID0gJ0NvbW1lbnQnO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGNyZWF0aW9uIHBhZ2VcbiAgICAvL25vdCB1c2UgYW55bW9yZVxuICAgIC5jb250cm9sbGVyKCdEaXNoQ3JlYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgRGlzaFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5kaXNoID0ge1xuICAgICAgICAgICAgbmFtZTogJ25ldyBkaXNoJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUodm0uZGlzaCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9hZG1pbi9kaXNoLycgKyBkYXRhLmRpc2guX2lkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG5cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgdm0udHlwZSA9ICdjcmVhdGUnO1xuICAgICAgICAgICAgdm0uZGlzaCA9IHtcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnM6IFtdLFxuICAgICAgICAgICAgICAgIHBob3RvOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZtLm5ld0luc3RydWN0aW9uID0gJyc7XG4gICAgICAgICAgICB2bS5uZXdQaG90byA9ICcnO1xuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xuICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMubGVuZ3RoID0gMDtcbiAgICAgICAgICAgIHZtLmRpc2gucGhvdG9zLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICB9KVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggZWRpdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hFZGl0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRyb3V0ZVBhcmFtcywgRGlzaFNlcnZpY2UsICRsb2NhdGlvbikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgLy9nZXQgdGhlIGRpc2ggYnkgaWRcbiAgICAgICAgRGlzaFNlcnZpY2UuZ2V0KCRyb3V0ZVBhcmFtcy5kaXNoX2lkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHZtLmRpc2ggPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5hZGRJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMucHVzaCh2bS5uZXdJbnN0cnVjdGlvbik7XG4gICAgICAgICAgICB2bS5uZXdJbnN0cnVjdGlvbiA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVtb3ZlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAgICAgdm0uZGlzaC5pbnN0cnVjdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmFkZFBob3RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5ld1Bob3RvOiBcIiwgdm0ubmV3UGhvdG8pO1xuICAgICAgICAgICAgdm0uZGlzaC5waG90b3MucHVzaCh2bS5uZXdQaG90byk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImRpc2g6XCIsIHZtLmRpc2gpO1xuICAgICAgICAgICAgdm0ubmV3UGhvdG8gPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnJlbW92ZVBob3RvID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIHZtLmRpc2gucGhvdG9zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UudXBkYXRlKCRyb3V0ZVBhcmFtcy5kaXNoX2lkLCB2bS5kaXNoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpbml0KCk7XG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgdm0ubmV3UGhvdG8gPSAnJztcbiAgICAgICAgICAgIHZtLm5ld0luc3RydWN0aW9uID0gJyc7XG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSwgJGxvY2F0aW9uLCBDT05TVEFOVFMsIG1kNSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5lbWFpbCA9IFwiXCI7XG4gICAgICAgIHZtLnBhc3N3b3JkID0gXCJcIjtcbiAgICAgICAgdm0udXNlck5hbWUgPSBcIlwiO1xuICAgICAgICB2bS5zaG93U2lnblVwRm9ybSA9IGZhbHNlO1xuXG4gICAgICAgIHZtLmZiTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIEZCLmxvZ2luKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nZ2VkIGludG8geW91ciBhcHAgYW5kIEZhY2Vib29rLlxuICAgICAgICAgICAgICAgICAgICBGQi5hcGkoJy9tZScsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmIgdXNlcjogJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZiVXNlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogcmVzcG9uc2UubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogcmVzcG9uc2UuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IENPTlNUQU5UUy5TT0NJQUxfUEFTUyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG90b1VybDogJ2h0dHA6Ly9ncmFwaC5mYWNlYm9vay5jb20vJyArIHJlc3BvbnNlLmlkICsgJy9waWN0dXJlP3R5cGU9bGFyZ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkZBQ0VCT09LXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5zb2NpYWxMb2dpbihmYlVzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkZBQ0VCT09LO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdub3RfYXV0aG9yaXplZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBsb2dnZWQgaW50byBGYWNlYm9vaywgYnV0IG5vdCB5b3VyIGFwcC5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIG5vdCBsb2dnZWQgaW50byBGYWNlYm9vaywgc28gd2UncmUgbm90IHN1cmUgaWZcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhleSBhcmUgbG9nZ2VkIGludG8gdGhpcyBhcHAgb3Igbm90LlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzY29wZTogJ3B1YmxpY19wcm9maWxlLGVtYWlsJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgVXNlclNlcnZpY2UubG9naW4odm0uZW1haWwsIHZtLnBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICB1c2VyLmxvZ2luVHlwZSA9IENPTlNUQU5UUy5FTUFJTDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNpZ25VcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgICAgICAgdXNlck5hbWU6IHZtLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5lbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdm0ucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcGhvdG9Vcmw6ICdodHRwOi8vd3d3LmdyYXZhdGFyLmNvbS9hdmF0YXIvJyArIG1kNS5jcmVhdGVIYXNoKHZtLmVtYWlsKSxcbiAgICAgICAgICAgICAgICBsaW5rZWRTb2NpYWw6IENPTlNUQU5UUy5FTUFJTFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuY3JlYXRlKG5ld1VzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRtZERpYWxvZywgVXNlclNlcnZpY2UsIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5zaG93TW9iaWxlTWVudSA9IGZhbHNlO1xuXG4gICAgICAgIHZtLnRvZ2dsZU1vYmlsZU1lbnUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnNob3dNb2JpbGVNZW51ID0gIXZtLnNob3dNb2JpbGVNZW51O1xuICAgICAgICB9XG5cbiAgICAgICAgJHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbihfLCB1c2VyKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSB2bS5jdXJyZW50VXNlciA9IHVzZXI7XG5cbiAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSAkbG9jYXRpb24uc2VhcmNoKCkucmV0dXJuVXJsO1xuICAgICAgICAgICAgaWYgKHJldHVyblVybCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXR1cm4gdXJsOiAnLCByZXR1cm5VcmwpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKHJldHVyblVybCkuc2VhcmNoKHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVXJsOiBudWxsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgdm0ubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodm0uY3VycmVudFVzZXIubG9naW5UeXBlID09IENPTlNUQU5UUy5GQUNFQk9PSykge1xuICAgICAgICAgICAgICAgIEZCLmxvZ291dChmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5sb2dvdXQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zaG93TG9naW5EaWFsb2cgPSBmdW5jdGlvbihldikge1xuICAgICAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBMb2dpbkNvbnRyb2xsZXIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvZGlhbG9ncy9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RXZlbnQ6IGV2LFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdsb2dpbidcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGFuc3dlcikge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWxlcnQgPSAnWW91IHNhaWQgdGhlIGluZm9ybWF0aW9uIHdhcyBcIicgKyBhbnN3ZXIgKyAnXCIuJztcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFsZXJ0ID0gJ1lvdSBjYW5jZWxsZWQgdGhlIGRpYWxvZy4nO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIExvZ2luQ29udHJvbGxlcigpIHtcbiAgICAgICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgICAgICB2bS5lbWFpbCA9IFwiXCI7XG4gICAgICAgICAgICB2bS5wYXNzd29yZCA9IFwiXCI7XG4gICAgICAgICAgICB2bS51c2VyTmFtZSA9IFwiXCI7XG4gICAgICAgICAgICB2bS5zaG93U2lnblVwRm9ybSA9IGZhbHNlO1xuXG4gICAgICAgICAgICB2bS5mYkxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgRkIubG9naW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvZ2dlZCBpbnRvIHlvdXIgYXBwIGFuZCBGYWNlYm9vay5cbiAgICAgICAgICAgICAgICAgICAgICAgIEZCLmFwaSgnL21lJywgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmIgdXNlcjogJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYlVzZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiByZXNwb25zZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogcmVzcG9uc2UuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBDT05TVEFOVFMuU09DSUFMX1BBU1MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvVXJsOiAnaHR0cDovL2dyYXBoLmZhY2Vib29rLmNvbS8nICsgcmVzcG9uc2UuaWQgKyAnL3BpY3R1cmU/dHlwZT1sYXJnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkZBQ0VCT09LXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLnNvY2lhbExvZ2luKGZiVXNlcikudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIubG9naW5UeXBlID0gQ09OU1RBTlRTLkZBQ0VCT09LO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnbm90X2F1dGhvcml6ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcGVyc29uIGlzIGxvZ2dlZCBpbnRvIEZhY2Vib29rLCBidXQgbm90IHlvdXIgYXBwLlxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBub3QgbG9nZ2VkIGludG8gRmFjZWJvb2ssIHNvIHdlJ3JlIG5vdCBzdXJlIGlmXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGV5IGFyZSBsb2dnZWQgaW50byB0aGlzIGFwcCBvciBub3QuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiAncHVibGljX3Byb2ZpbGUsZW1haWwnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZtLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgVXNlclNlcnZpY2UubG9naW4odm0uZW1haWwsIHZtLnBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRU1BSUw7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdm0uc2lnblVwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiB2bS51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHZtLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdm0ucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgIHBob3RvVXJsOiAnaHR0cDovL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyLycgKyBtZDUuY3JlYXRlSGFzaCh2bS5lbWFpbCksXG4gICAgICAgICAgICAgICAgICAgIGxpbmtlZFNvY2lhbDogQ09OU1RBTlRTLkVNQUlMXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmNyZWF0ZShuZXdVc2VyKS50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgZnVuY3Rpb24oVXNlclNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0udXNlciA9IHt9O1xuXG4gICAgICAgIFVzZXJTZXJ2aWNlLmdldCgpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgdm0udXNlciA9IHVzZXI7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5kaXJlY3RpdmUoJ2NvbnRlbnRlZGl0YWJsZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRyaWJ1dHMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiRyZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKG5nTW9kZWwuJHZpZXdWYWx1ZSB8fCAnJyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoZWxlbWVudC5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuZGlyZWN0aXZlKCdmb2N1c09uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBmb2N1c1ZhbHVlOiBcIj1mb2N1c09uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZm9jdXNWYWx1ZScsIGZ1bmN0aW9uKGN1cnJlbnRWYWx1ZSwgcHJldmlvdXNWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlICYmICFwcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkZWxlbWVudFswXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ0Rpc2hTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHApIHtcblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyBvYmplY3RcbiAgICAgICAgdmFyIGRpc2hGYWN0b3J5ID0ge307XG5cbiAgICAgICAgLy9nZXQgYWxsIGRpc2hlc1xuICAgICAgICBkaXNoRmFjdG9yeS5hbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9jcmVhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcycsIGRpc2gpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vZ2V0IGEgc2luZ2xlIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZ2V0ID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy91cGRhdGUgYSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKGRpc2hfaWQsIGRpc2gpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkLCBkaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZGVsZXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5kZWxldGUgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2FkZCBhIGNvbW1lbnRcbiAgICAgICAgZGlzaEZhY3RvcnkuYWRkQ29tbWVudCA9IGZ1bmN0aW9uKGRpc2hfaWQsIGNvbW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCArICcvY29tbWVudHMnLCBjb21tZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlzaEZhY3Rvcnk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ1NvY2lhbFNlcnZpY2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNvY2lhbEZhY3RvcnkgPSB7fTtcblxuICAgICAgICBzb2NpYWxGYWN0b3J5LmZiU2hhcmUgPSBmdW5jdGlvbihsaW5rKSB7XG4gICAgICAgICAgICBGQi51aSh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnc2hhcmUnLFxuICAgICAgICAgICAgICAgIGhyZWY6IGxpbmssXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge30pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNvY2lhbEZhY3Rvcnk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsICRyb290U2NvcGUsIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdXNlckZhY3RvcnkgPSB7fTtcbiAgICAgICAgLy9zb2NpYWwgbG9naW5cbiAgICAgICAgdXNlckZhY3Rvcnkuc29jaWFsTG9naW4gPSBmdW5jdGlvbihzb2NpYWxVc2VyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInNvY2lhbFVzZXI6IFwiLCBzb2NpYWxVc2VyKTtcblxuICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LnNlYXJjaEJ5KCdlbWFpbD0nICsgc29jaWFsVXNlci5lbWFpbCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL25vdCBmb3VuZCwgdGhlbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmNyZWF0ZShzb2NpYWxVc2VyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL2ZvdW5kIHRoZSB1c2VyIHdpdGggZW1haWxcbiAgICAgICAgICAgICAgICAgICAgLy91cGRhdGUgdGhlIGxpbmtlZCBzb2NpYWwgaWYgbm90IGFkZGVkXG4gICAgICAgICAgICAgICAgICAgIHZhciB1c2VyID0gZGF0YS51c2Vyc1swXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIubGlua2VkU29jaWFsLmluZGV4T2Yoc29jaWFsVXNlci5saW5rZWRTb2NpYWwpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5saW5rZWRTb2NpYWwucHVzaChzb2NpYWxVc2VyLmxpbmtlZFNvY2lhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLnVzZXJOYW1lID0gc29jaWFsVXNlci51c2VyTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIucGhvdG9VcmwgPSBzb2NpYWxVc2VyLnBob3RvVXJsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkudXBkYXRlKHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5sb2dpbih1c2VyLmVtYWlsLCBDT05TVEFOVFMuU09DSUFMX1BBU1MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2xvZ2luIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9naW4gPSBmdW5jdGlvbihlbWFpbCwgcGFzc3dvcmQpIHtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvYXV0aCcsIHtcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5nZXQoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICAvL2xvZ291dCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZ2V0IGN1cnJlbnQgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5nZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvbWUnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vc2VhcmNoIHVzZXIgYnkgZmllbGRcbiAgICAgICAgdXNlckZhY3Rvcnkuc2VhcmNoQnkgPSBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycz8nICsgcXVlcnkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgdXNlciBieSBpZFxuICAgICAgICB1c2VyRmFjdG9yeS5nZXRCeUlkID0gZnVuY3Rpb24odXNlcl9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzLycsIHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIHVzZXIucGFzc3dvcmQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3VwZGF0ZSB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKHVzZXJfaWQsIHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvdXNlcnMvJyArIHVzZXJfaWQsIHVzZXIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9jb2xsZWN0IGRpc2ggYXMgZmF2b3VyaXRlXG4gICAgICAgIHVzZXJGYWN0b3J5LmNvbGxlY3QgPSBmdW5jdGlvbihkaXNoX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL3VzZXJzLycgKyAkcm9vdFNjb3BlLnVzZXIuX2lkICsgJy9kaXNoZXMvJyArIGRpc2hfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5O1xuICAgIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9