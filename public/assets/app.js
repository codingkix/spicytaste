angular.module("spicyTaste",["ngRoute","angular-md5"]).constant("CONSTANTS",{FB_APP_ID:0x58e0e66b31adc,FACEBOOK:"FB",EMAIL:"EMAIL",SOCIAL_PASS:"PASSWORD"}),angular.module("spicyTaste").run(["$rootScope","$window","UserService","CONSTANTS",function(e,n,t,o){e.user=null,n.fbAsyncInit=function(){FB.init({appId:o.FB_APP_ID,cookie:!0,xfbml:!0,version:"v2.2"})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}]),angular.module("spicyTaste").config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/",{templateUrl:"ng/views/pages/home.html",controller:"HomeController",controllerAs:"home"}).when("/dishes",{templateUrl:"ng/views/pages/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/dishes/:dish_id",{templateUrl:"ng/views/pages/dish/detail.html",controller:"DishDetailController",controllerAs:"detail"}).when("/admin/dishes/list",{templateUrl:"ng/views/pages/admin/dish/list.html",controller:"DishListController",controllerAs:"dishList"}).when("/admin/dishes/create",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishCreateController",controllerAs:"dishManage"}).when("/admin/dishes/:dish_id",{templateUrl:"ng/views/pages/admin/dish/single.html",controller:"DishEditController",controllerAs:"dishManage"}).when("/login",{templateUrl:"ng/views/pages/user/login.html",controller:"LoginController",controllerAs:"login"})}]),angular.module("spicyTaste").controller("DishListController",["DishService",function(e){var n=this;n.processing=!0,e.all().success(function(e){n.processing=!1,n.dishes=e}),n.deleteDish=function(t){n.processing=!0,e["delete"](t).success(function(){e.all().success(function(e){n.processing=!1,n.dishes=e})})}}]).controller("DishDetailController",["$scope","$location","$rootScope","$routeParams","DishService","UserService",function(e,n,t,o,i){function s(){e.focusOnComment=!1,r.newComment={content:"",replyTo:null},r.commentTitle="Comment"}var r=this;r.dish=null,s(),i.get(o.dish_id).success(function(e){r.dish=e}),r.addComment=function(){return t.user?(i.addComment(r.dish._id,r.newComment).success(function(e){r.dish.comments.push(e)}),void s()):n.path("/login")},r.reply=function(n){r.newComment.replyTo=n._id,r.commentTitle="@"+n.userName,e.focusOnComment=!0}}]).controller("DishCreateController",["DishService",function(e){var n=this;n.type="create",n.save=function(){n.processing=!0,n.message="",e.create(n.dish).success(function(e){n.processing=!1,n.dish={},n.message=e.message})}}]).controller("DishEditController",["$routeParams","DishService","$location",function(e,n){var t=this;t.type="edit",n.get(e.dish_id).success(function(e){t.dish=e}),t.save=function(){t.processing=!0,t.message="",n.update(e.dish_id,t.dish).success(function(e){t.processing=!1,t.message=e.message})}}]),angular.module("spicyTaste").controller("HomeController",function(){}),angular.module("spicyTaste").controller("LoginController",["$scope","UserService","$location","CONSTANTS","md5",function(e,n,t,o,i){var s=this;s.email="",s.password="",s.userName="",s.showSignUpForm=!1,s.fbLogin=function(){FB.login(function(i){"connected"===i.status?FB.api("/me",function(i){console.log("fb user: ",i);var s={userName:i.name,email:i.email,password:o.SOCIAL_PASS,photoUrl:"http://graph.facebook.com/"+i.id+"/picture?type=large",linkedSocial:o.FACEBOOK};n.socialLogin(s).then(function(n){n.loginType=o.FACEBOOK,e.$emit("login",n),t.path("/")})}):"not_authorized"===i.status},{scope:"public_profile,email"})},s.login=function(){n.login(s.email,s.password).then(function(n){n.loginType=o.EMAIL,e.$emit("login",n),t.path("/")})},s.signUp=function(){var r={userName:s.userName,email:s.email,password:s.password,photoUrl:"http://www.gravatar.com/avatar/"+i.createHash(s.email),linkedSocial:o.EMAIL};n.create(r).then(function(n){e.$emit("login",n),t.path("/")})}}]),angular.module("spicyTaste").controller("MainController",["$scope","$rootScope","UserService","CONSTANTS",function(e,n,t,o){var i=this;e.$on("login",function(e,t){n.user=i.currentUser=t}),i.logout=function(){i.currentUser.loginType==o.FACEBOOK&&FB.logout(function(){}),i.currentUser=null,n.user=null,t.logout()}}]),angular.module("spicyTaste").directive("focusOn",function(){return{restrict:"A",scope:{focusValue:"=focusOn"},link:function(e,n){e.$watch("focusValue",function(e,t){e&&!t&&n[0].focus()})}}}),angular.module("spicyTaste").factory("DishService",["$http",function(e){var n={};return n.all=function(){return e.get("/api/dishes")},n.create=function(n){return e.post("/api/dishes",n)},n.get=function(n){return e.get("/api/dishes/"+n)},n.update=function(n,t){return e.put("/api/dishes/"+n,t)},n["delete"]=function(n){return e["delete"]("/api/dishes/"+n)},n.addComment=function(n,t){return e.post("/api/dishes/"+n+"/comments",t)},n}]),angular.module("spicyTaste").factory("UserService",["$http","CONSTANTS",function(e,n){var t={};return t.socialLogin=function(e){return console.log("socialUser: ",e),t.searchBy("email="+e.email).then(function(o){if(o.success){var i=o.users[0];return i.linkedSocial.indexOf(e.linkedSocial)<0?(i.linkedSocial.push(e.linkedSocial),i.userName=e.userName,i.photoUrl=e.photoUrl,t.update(i).then(function(){return t.login(i.email,n.SOCIAL_PASS)})):t.login(i.email,n.SOCIAL_PASS)}return t.create(e)})},t.login=function(n,o){return e.post("/api/auth",{email:n,password:o}).then(function(n){return e.defaults.headers.common["X-Auth"]=n.data,t.get()})},t.logout=function(){delete e.defaults.headers.common["X-Auth"]},t.get=function(){return e.get("/api/users/me").then(function(e){return e.data})},t.searchBy=function(n){return e.get("/api/users?"+n).then(function(e){return e.data})},t.getById=function(n){return e.get("/api/users/"+n).then(function(e){return e.data})},t.create=function(n){return e.post("/api/users/",n).then(function(){return t.login(n.email,n.password)})},t.update=function(n,t){return e.put("/api/users/"+n,t).then(function(e){return e.data})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImZhY2Vib29rLmpzIiwicm91dGVzLmpzIiwiY29udHJvbGxlcnMvZGlzaENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9ob21lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL21haW5Db250cm9sbGVyLmpzIiwiZGlyZWN0aXZlcy9mb2N1c09uRGlyZWN0aXZlLmpzIiwic2VydmljZXMvZGlzaFNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJGQl9BUFBfSUQiLCJGQUNFQk9PSyIsIkVNQUlMIiwiU09DSUFMX1BBU1MiLCJydW4iLCIkcm9vdFNjb3BlIiwiJHdpbmRvdyIsIlVzZXJTZXJ2aWNlIiwiQ09OU1RBTlRTIiwidXNlciIsImZiQXN5bmNJbml0IiwiRkIiLCJpbml0IiwiYXBwSWQiLCJjb29raWUiLCJ4ZmJtbCIsInZlcnNpb24iLCJkIiwicyIsImlkIiwianMiLCJmanMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEVsZW1lbnRCeUlkIiwiY3JlYXRlRWxlbWVudCIsInNyYyIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJkb2N1bWVudCIsImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHJvdXRlUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiRGlzaFNlcnZpY2UiLCJ2bSIsInRoaXMiLCJwcm9jZXNzaW5nIiwiYWxsIiwic3VjY2VzcyIsImRhdGEiLCJkaXNoZXMiLCJkZWxldGVEaXNoIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiJHJvdXRlUGFyYW1zIiwiZm9jdXNPbkNvbW1lbnQiLCJuZXdDb21tZW50IiwiY29udGVudCIsInJlcGx5VG8iLCJjb21tZW50VGl0bGUiLCJkaXNoIiwiZ2V0IiwiZGlzaF9pZCIsImFkZENvbW1lbnQiLCJfaWQiLCJjb21tZW50IiwiY29tbWVudHMiLCJwdXNoIiwicGF0aCIsInJlcGx5IiwidXNlck5hbWUiLCJ0eXBlIiwic2F2ZSIsIm1lc3NhZ2UiLCJjcmVhdGUiLCJ1cGRhdGUiLCJtZDUiLCJlbWFpbCIsInBhc3N3b3JkIiwic2hvd1NpZ25VcEZvcm0iLCJmYkxvZ2luIiwibG9naW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImFwaSIsImNvbnNvbGUiLCJsb2ciLCJmYlVzZXIiLCJuYW1lIiwicGhvdG9VcmwiLCJsaW5rZWRTb2NpYWwiLCJzb2NpYWxMb2dpbiIsInRoZW4iLCJsb2dpblR5cGUiLCIkZW1pdCIsInNjb3BlIiwic2lnblVwIiwibmV3VXNlciIsImNyZWF0ZUhhc2giLCIkb24iLCJfIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImZvY3VzVmFsdWUiLCJsaW5rIiwiJGVsZW1lbnQiLCIkd2F0Y2giLCJjdXJyZW50VmFsdWUiLCJwcmV2aW91c1ZhbHVlIiwiZm9jdXMiLCJmYWN0b3J5IiwiJGh0dHAiLCJkaXNoRmFjdG9yeSIsInBvc3QiLCJwdXQiLCJ1c2VyRmFjdG9yeSIsInNvY2lhbFVzZXIiLCJzZWFyY2hCeSIsInVzZXJzIiwiaW5kZXhPZiIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsInF1ZXJ5IiwiZ2V0QnlJZCIsInVzZXJfaWQiXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFBQyxPQUFBLGNBQUEsVUFBQSxnQkFDQUMsU0FBQSxhQUNBQyxVQUFBLGdCQUNBQyxTQUFBLEtBQ0FDLE1BQUEsUUFDQUMsWUFBQSxhQ0xBTixRQUFBQyxPQUFBLGNBQ0FNLEtBQUEsYUFBQSxVQUFBLGNBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxLQUFBLEtBRUFILEVBQUFJLFlBQUEsV0FDQUMsR0FBQUMsTUFDQUMsTUFBQUwsRUFBQVIsVUFDQWMsUUFB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UyxTQUFBQyxRQUFBQyxPQUFBLFdBSUFQLEVBQUF4RCxJQUFBLFdBQ0EsTUFBQW9ELEdBQUFwRCxJQUFBLGlCQUFBK0IsS0FBQSxTQUFBVixHQUNBLE1BQUFBLEdBQUFqQyxRQUtBb0UsRUFBQUUsU0FBQSxTQUFBTSxHQUNBLE1BQUFaLEdBQUFwRCxJQUFBLGNBQUFnRSxHQUFBakMsS0FBQSxTQUFBVixHQUNBLE1BQUFBLEdBQUFqQyxRQUtBb0UsRUFBQVMsUUFBQSxTQUFBQyxHQUNBLE1BQUFkLEdBQUFwRCxJQUFBLGNBQUFrRSxHQUFBbkMsS0FBQSxTQUFBVixHQUNBLE1BQUFBLEdBQUFqQyxRQUtBb0UsRUFBQTNDLE9BQUEsU0FBQTNELEdBQ0EsTUFBQWtHLEdBQUFFLEtBQUEsY0FBQXBHLEdBQUE2RSxLQUFBLFdBQ0EsTUFBQXlCLEdBQUFwQyxNQUFBbEUsRUFBQThELE1BQUE5RCxFQUFBK0QsYUFLQXVDLEVBQUExQyxPQUFBLFNBQUFvRCxFQUFBaEgsR0FDQSxNQUFBa0csR0FBQUcsSUFBQSxjQUFBVyxFQUFBaEgsR0FBQTZFLEtBQUEsU0FBQVYsR0FDQSxNQUFBQSxHQUFBakMsUUFJQW9FIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJywgWyduZ1JvdXRlJywgJ2FuZ3VsYXItbWQ1J10pXG4gICAgLmNvbnN0YW50KCdDT05TVEFOVFMnLCB7XG4gICAgICAgIFwiRkJfQVBQX0lEXCI6IDE1NjM1NjczODcyNTM0NjgsXG4gICAgICAgIFwiRkFDRUJPT0tcIjogXCJGQlwiLFxuICAgICAgICBcIkVNQUlMXCI6IFwiRU1BSUxcIixcbiAgICAgICAgXCJTT0NJQUxfUEFTU1wiOiBcIlBBU1NXT1JEXCJcbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUsICR3aW5kb3csIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0gbnVsbDtcblxuICAgICAgICAkd2luZG93LmZiQXN5bmNJbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBGQi5pbml0KHtcbiAgICAgICAgICAgICAgICBhcHBJZDogQ09OU1RBTlRTLkZCX0FQUF9JRCxcbiAgICAgICAgICAgICAgICBjb29raWU6IHRydWUsIC8vIGVuYWJsZSBjb29raWVzIHRvIGFsbG93IHRoZSBzZXJ2ZXIgdG8gYWNjZXNzIHRoZSBzZXNzaW9uXG4gICAgICAgICAgICAgICAgeGZibWw6IHRydWUsIC8vIHBhcnNlIHNvY2lhbCBwbHVnaW5zIG9uIHRoaXMgcGFnZVxuICAgICAgICAgICAgICAgIHZlcnNpb246ICd2Mi4yJyAvLyB1c2UgdmVyc2lvbiAyLjJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIExvYWQgdGhlIFNESyBhc3luY2hyb25vdXNseVxuICAgICAgICAoZnVuY3Rpb24oZCwgcywgaWQpIHtcbiAgICAgICAgICAgIHZhciBqcywgZmpzID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZShzKVswXTtcbiAgICAgICAgICAgIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkgcmV0dXJuO1xuICAgICAgICAgICAganMgPSBkLmNyZWF0ZUVsZW1lbnQocyk7XG4gICAgICAgICAgICBqcy5pZCA9IGlkO1xuICAgICAgICAgICAganMuc3JjID0gXCIvL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL3Nkay5qc1wiO1xuICAgICAgICAgICAgZmpzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGpzLCBmanMpO1xuICAgICAgICB9KGRvY3VtZW50LCAnc2NyaXB0JywgJ2ZhY2Vib29rLWpzc2RrJykpO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAvL2hvbWUgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy8nLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9ob21lLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnaG9tZSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3Nob3cgYWxsIGRpc2hlcyBwYWdlXG4gICAgICAgICAgICAud2hlbignL2Rpc2hlcycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL2Rpc2gvbGlzdC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaExpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTGlzdCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL3Nob3cgZGlzaCBkZXRhaWwgcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9kaXNoL2RldGFpbC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaERldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2RldGFpbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL2xpc3QgYWRtaW4gZGlzaCBwYWdlXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2Rpc2hlcy9saXN0Jywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNoTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2Rpc2hMaXN0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vY3JlYXRlIGEgbmV3IGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvY3JlYXRlJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbmcvdmlld3MvcGFnZXMvYWRtaW4vZGlzaC9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rpc2hDcmVhdGVDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vZWRpdCBhIGRpc2ggcGFnZVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9kaXNoZXMvOmRpc2hfaWQnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICduZy92aWV3cy9wYWdlcy9hZG1pbi9kaXNoL3NpbmdsZS5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzaEVkaXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaXNoTWFuYWdlJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vbG9naW4gdXNlclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ25nL3ZpZXdzL3BhZ2VzL3VzZXIvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbG9naW4nXG4gICAgICAgICAgICB9KVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC8vY29udHJvbGxlciBhcHBsaWVkIHRvIGRpc2ggbGlzdCBwYWdlXG4gICAgLmNvbnRyb2xsZXIoJ0Rpc2hMaXN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKERpc2hTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgLy9zZXQgYSBwcm9jZXNzaW5nIHZhcmlhYmxlIHRvIHNob3cgbG9hZGluZ1xuICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgICAgICAvL2dyYWIgYWxsIHRoZSBkaXNoZXMgYXQgcGFnZSBsb2FkXG4gICAgICAgIERpc2hTZXJ2aWNlLmFsbCgpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgLy93aGVuIGFsbCBkaXNoZXMgZmV0Y2hlZCwgcmVtb3ZlIHByb2Nlc3NpbmcgdmFyaWFibGVcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy9iaW5kIHRoZSBkaXNoZXNcbiAgICAgICAgICAgIHZtLmRpc2hlcyA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vZnVuY3Rpb24gdG8gZGVsZXRlIGEgZGlzaFxuICAgICAgICB2bS5kZWxldGVEaXNoID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5kZWxldGUoaWQpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIERpc2hTZXJ2aWNlLmFsbCgpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZtLmRpc2hlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgIH0pXG4gICAgLy9jb250cm9sbGVyIGFwcGxpZWQgdG8gZGlzaCBkZXRhaWwgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoRGV0YWlsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsIERpc2hTZXJ2aWNlLCBVc2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5kaXNoID0gbnVsbDtcbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIC8vZ2V0IHRoZSBkaXNoIGJ5IGlkXG4gICAgICAgIERpc2hTZXJ2aWNlLmdldCgkcm91dGVQYXJhbXMuZGlzaF9pZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB2bS5kaXNoID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0uYWRkQ29tbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5hZGRDb21tZW50KHZtLmRpc2guX2lkLCB2bS5uZXdDb21tZW50KS5zdWNjZXNzKGZ1bmN0aW9uKGNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNoLmNvbW1lbnRzLnB1c2goY29tbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlcGx5ID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgdm0ubmV3Q29tbWVudC5yZXBseVRvID0gdXNlci5faWQ7XG4gICAgICAgICAgICB2bS5jb21tZW50VGl0bGUgPSAnQCcgKyB1c2VyLnVzZXJOYW1lO1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgJHNjb3BlLmZvY3VzT25Db21tZW50ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5uZXdDb21tZW50ID0ge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICAgICAgICAgIHJlcGx5VG86IG51bGwsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdm0uY29tbWVudFRpdGxlID0gJ0NvbW1lbnQnO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGNyZWF0aW9uIHBhZ2VcbiAgICAuY29udHJvbGxlcignRGlzaENyZWF0ZUNvbnRyb2xsZXInLCBmdW5jdGlvbihEaXNoU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnR5cGUgPSBcImNyZWF0ZVwiO1xuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xuXG4gICAgICAgICAgICBEaXNoU2VydmljZS5jcmVhdGUodm0uZGlzaCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0ucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZtLmRpc2ggPSB7fTtcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfSlcbiAgICAvL2NvbnRyb2xsZXIgYXBwbGllZCB0byBkaXNoIGVkaXQgcGFnZVxuICAgIC5jb250cm9sbGVyKCdEaXNoRWRpdENvbnRyb2xsZXInLCBmdW5jdGlvbigkcm91dGVQYXJhbXMsIERpc2hTZXJ2aWNlLCAkbG9jYXRpb24pIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS50eXBlID0gXCJlZGl0XCI7XG5cbiAgICAgICAgLy9nZXQgdGhlIGRpc2ggYnkgaWRcbiAgICAgICAgRGlzaFNlcnZpY2UuZ2V0KCRyb3V0ZVBhcmFtcy5kaXNoX2lkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHZtLmRpc2ggPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcblxuICAgICAgICAgICAgRGlzaFNlcnZpY2UudXBkYXRlKCRyb3V0ZVBhcmFtcy5kaXNoX2lkLCB2bS5kaXNoKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9jZXNzaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlLCAkbG9jYXRpb24sIENPTlNUQU5UUywgbWQ1KSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmVtYWlsID0gXCJcIjtcbiAgICAgICAgdm0ucGFzc3dvcmQgPSBcIlwiO1xuICAgICAgICB2bS51c2VyTmFtZSA9IFwiXCI7XG4gICAgICAgIHZtLnNob3dTaWduVXBGb3JtID0gZmFsc2U7XG5cbiAgICAgICAgdm0uZmJMb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgRkIubG9naW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnY29ubmVjdGVkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBMb2dnZWQgaW50byB5b3VyIGFwcCBhbmQgRmFjZWJvb2suXG4gICAgICAgICAgICAgICAgICAgIEZCLmFwaSgnL21lJywgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmYiB1c2VyOiAnLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmJVc2VyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiByZXNwb25zZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiByZXNwb25zZS5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogQ09OU1RBTlRTLlNPQ0lBTF9QQVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvVXJsOiAnaHR0cDovL2dyYXBoLmZhY2Vib29rLmNvbS8nICsgcmVzcG9uc2UuaWQgKyAnL3BpY3R1cmU/dHlwZT1sYXJnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua2VkU29jaWFsOiBDT05TVEFOVFMuRkFDRUJPT0tcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLnNvY2lhbExvZ2luKGZiVXNlcikudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRkFDRUJPT0s7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnbm90X2F1dGhvcml6ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwZXJzb24gaXMgbG9nZ2VkIGludG8gRmFjZWJvb2ssIGJ1dCBub3QgeW91ciBhcHAuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHBlcnNvbiBpcyBub3QgbG9nZ2VkIGludG8gRmFjZWJvb2ssIHNvIHdlJ3JlIG5vdCBzdXJlIGlmXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZXkgYXJlIGxvZ2dlZCBpbnRvIHRoaXMgYXBwIG9yIG5vdC5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2NvcGU6ICdwdWJsaWNfcHJvZmlsZSxlbWFpbCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ2luKHZtLmVtYWlsLCB2bS5wYXNzd29yZCkudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgdXNlci5sb2dpblR5cGUgPSBDT05TVEFOVFMuRU1BSUw7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNpZ25VcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgICAgICAgdXNlck5hbWU6IHZtLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5lbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdm0ucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcGhvdG9Vcmw6ICdodHRwOi8vd3d3LmdyYXZhdGFyLmNvbS9hdmF0YXIvJyArIG1kNS5jcmVhdGVIYXNoKHZtLmVtYWlsKSxcbiAgICAgICAgICAgICAgICBsaW5rZWRTb2NpYWw6IENPTlNUQU5UUy5FTUFJTFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuY3JlYXRlKG5ld1VzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdzcGljeVRhc3RlJylcbiAgICAuY29udHJvbGxlcignTWFpbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsIFVzZXJTZXJ2aWNlLCBDT05TVEFOVFMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKF8sIHVzZXIpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHZtLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgfSlcblxuICAgICAgICB2bS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh2bS5jdXJyZW50VXNlci5sb2dpblR5cGUgPT0gQ09OU1RBTlRTLkZBQ0VCT09LKSB7XG4gICAgICAgICAgICAgICAgRkIubG9nb3V0KGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IG51bGw7XG5cbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICB9O1xuXG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmRpcmVjdGl2ZSgnZm9jdXNPbicsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZm9jdXNWYWx1ZTogXCI9Zm9jdXNPblwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2ZvY3VzVmFsdWUnLCBmdW5jdGlvbihjdXJyZW50VmFsdWUsIHByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSAmJiAhcHJldmlvdXNWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnRbMF0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3NwaWN5VGFzdGUnKVxuICAgIC5mYWN0b3J5KCdEaXNoU2VydmljZScsIGZ1bmN0aW9uKCRodHRwKSB7XG5cbiAgICAgICAgLy9jcmVhdGUgYSBuZXcgb2JqZWN0XG4gICAgICAgIHZhciBkaXNoRmFjdG9yeSA9IHt9O1xuXG4gICAgICAgIC8vZ2V0IGFsbCBkaXNoZXNcbiAgICAgICAgZGlzaEZhY3RvcnkuYWxsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2Rpc2hlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vY3JlYXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS5jcmVhdGUgPSBmdW5jdGlvbihkaXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9kaXNoZXMnLCBkaXNoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2dldCBhIHNpbmdsZSBkaXNoXG4gICAgICAgIGRpc2hGYWN0b3J5LmdldCA9IGZ1bmN0aW9uKGRpc2hfaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZGlzaGVzLycgKyBkaXNoX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdXBkYXRlIGEgZGlzaFxuICAgICAgICBkaXNoRmFjdG9yeS51cGRhdGUgPSBmdW5jdGlvbihkaXNoX2lkLCBkaXNoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL2Rpc2hlcy8nICsgZGlzaF9pZCwgZGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2RlbGV0ZSBhIGRpc2hcbiAgICAgICAgZGlzaEZhY3RvcnkuZGVsZXRlID0gZnVuY3Rpb24oZGlzaF9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9hZGQgYSBjb21tZW50XG4gICAgICAgIGRpc2hGYWN0b3J5LmFkZENvbW1lbnQgPSBmdW5jdGlvbihkaXNoX2lkLCBjb21tZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9kaXNoZXMvJyArIGRpc2hfaWQgKyAnL2NvbW1lbnRzJywgY29tbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGlzaEZhY3Rvcnk7XG4gICAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3BpY3lUYXN0ZScpXG4gICAgLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsIENPTlNUQU5UUykge1xuICAgICAgICB2YXIgdXNlckZhY3RvcnkgPSB7fTtcbiAgICAgICAgLy9zb2NpYWwgbG9naW5cbiAgICAgICAgdXNlckZhY3Rvcnkuc29jaWFsTG9naW4gPSBmdW5jdGlvbihzb2NpYWxVc2VyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInNvY2lhbFVzZXI6IFwiLCBzb2NpYWxVc2VyKTtcblxuICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LnNlYXJjaEJ5KCdlbWFpbD0nICsgc29jaWFsVXNlci5lbWFpbCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL25vdCBmb3VuZCwgdGhlbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmNyZWF0ZShzb2NpYWxVc2VyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL2ZvdW5kIHRoZSB1c2VyIHdpdGggZW1haWxcbiAgICAgICAgICAgICAgICAgICAgLy91cGRhdGUgdGhlIGxpbmtlZCBzb2NpYWwgaWYgbm90IGFkZGVkXG4gICAgICAgICAgICAgICAgICAgIHZhciB1c2VyID0gZGF0YS51c2Vyc1swXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIubGlua2VkU29jaWFsLmluZGV4T2Yoc29jaWFsVXNlci5saW5rZWRTb2NpYWwpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5saW5rZWRTb2NpYWwucHVzaChzb2NpYWxVc2VyLmxpbmtlZFNvY2lhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLnVzZXJOYW1lID0gc29jaWFsVXNlci51c2VyTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIucGhvdG9VcmwgPSBzb2NpYWxVc2VyLnBob3RvVXJsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckZhY3RvcnkudXBkYXRlKHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIENPTlNUQU5UUy5TT0NJQUxfUEFTUyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5sb2dpbih1c2VyLmVtYWlsLCBDT05TVEFOVFMuU09DSUFMX1BBU1MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2xvZ2luIHVzZXJcbiAgICAgICAgdXNlckZhY3RvcnkubG9naW4gPSBmdW5jdGlvbihlbWFpbCwgcGFzc3dvcmQpIHtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvYXV0aCcsIHtcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyRmFjdG9yeS5nZXQoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICAvL2xvZ291dCB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZ2V0IGN1cnJlbnQgdXNlclxuICAgICAgICB1c2VyRmFjdG9yeS5nZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvbWUnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vc2VhcmNoIHVzZXIgYnkgZmllbGRcbiAgICAgICAgdXNlckZhY3Rvcnkuc2VhcmNoQnkgPSBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycz8nICsgcXVlcnkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgdXNlciBieSBpZFxuICAgICAgICB1c2VyRmFjdG9yeS5nZXRCeUlkID0gZnVuY3Rpb24odXNlcl9pZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy8nICsgdXNlcl9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NyZWF0ZSBhIG5ldyB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LmNyZWF0ZSA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzLycsIHVzZXIpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5LmxvZ2luKHVzZXIuZW1haWwsIHVzZXIucGFzc3dvcmQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3VwZGF0ZSB1c2VyXG4gICAgICAgIHVzZXJGYWN0b3J5LnVwZGF0ZSA9IGZ1bmN0aW9uKHVzZXJfaWQsIHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvdXNlcnMvJyArIHVzZXJfaWQsIHVzZXIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHVzZXJGYWN0b3J5O1xuICAgIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9